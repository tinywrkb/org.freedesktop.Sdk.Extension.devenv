id: org.freedesktop.Sdk.Extension.devenv
branch: '22.08'
runtime: org.freedesktop.Sdk
runtime-version: '22.08'
sdk: org.freedesktop.Sdk
build-extension: true
separate-locales: false
sdk-extensions:
  - org.freedesktop.Sdk.Extension.go-musl
  - org.freedesktop.Sdk.Extension.musl
  - org.freedesktop.Sdk.Extension.rust-musl
  - org.freedesktop.Sdk.Extension.sccache

build-options:
  cflags: -I/usr/lib/sdk/devenv/include
  cxxflags: -I/usr/lib/sdk/devenv/include
  ldflags: -L/usr/lib/sdk/devenv/lib
  prefix: /usr/lib/sdk/devenv
  libdir: /usr/lib/sdk/devenv/lib
  prepend-path: /usr/lib/sdk/devenv/bin
  prepend-ld-library-path: /usr/lib/sdk/devenv/lib
  prepend-pkg-config-path: /usr/lib/sdk/devenv/lib/pkgconfig
  append-path: /usr/lib/sdk/go-musl/bin:/usr/lib/sdk/musl/bin:/usr/lib/sdk/rust-musl/bin:/usr/lib/sdk/sccache/bin
  strip: true
  env:
    - GO111MODULE=off
    - CARGO_VARS=
      HOME=${FLATPAK_BUILDER_BUILDDIR}
      CARGO_HOME=${FLATPAK_BUILDER_BUILDDIR}/cargo
    - SCCACHE_BIN=/usr/lib/sdk/sccache/bin/sccache
    - SCCACHE_DIR=/run/ccache/sccache
    # TODO: this is cache dir specific, maybe file a ticket upstream for in-cachedir config
    # NOTE: config file documentation @ https://github.com/mozilla/sccache/blob/main/docs/Configuration.md
    - SCCACHE_CONF=/run/ccache/sccache/config
    # NOTE: gocache size cannot be capped, see https://github.com/golang/go/issues/29561
    # XDG_CACHE_HOME is set for a sane default when GOCACHE is empty
    - GOVARS=
      GOBIN=${FLATPAK_DEST}/bin
      GOPATH=${FLATPAK_BUILDER_BUILDDIR}
      XDG_CACHE_HOME=${FLATPAK_BUILDER_BUILDDIR}/cache
      GOCACHE=$(if [ -n "$CCACHE_DIR" ]; then echo /run/ccache/gocache; fi;)
    - |
      PYVARS=
      PATH=${FLATPAK_DEST}/python/bin:${PATH}
      LD_LIBRARY_PATH=${FLATPAK_DEST}/python/lib:${LD_LIBRARY_PATH}

x-musl-static-build-options: &musl-static-build-options
  cflags: -static -static-pie -fPIC
  cxxflags: -static -static-pie -fPIC
  ldflags: -static -static-pie -fPIC -Wl,-fuse-ld=mold
  env: &musl-toolchain-environment
    - AR=x86_64-linux-musl-ar
    - CC=x86_64-linux-musl-gcc
    - CXX=x86_64-linux-musl-g++
    - LD=x86_64-linux-musl-ld.mold
# TODO: consider overriding pkgconf envvars
   #- PKG_CONFIG_LIBDIR=
   #- PKG_CONFIG_PATH=/lib/pkgconfig:/share/pkgconfig
   #- PKG_CONFIG_SYSROOT_DIR=/usr/lib/sdk/devenv

x-musl-shared-build-options: &musl-shared-build-options
  cflags: -fPIC -Bstatic -Wl,--dynamic-linker=/usr/lib/sdk/devenv/lib/libc.musl-x86_64.so.1
  cxxflags: -fPIC -Bstatic -Wl,--dynamic-linker=/usr/lib/sdk/devenv/lib/libc.musl-x86_64.so.1
  ldflags: -fPIC -Bstatic -Wl,--dynamic-linker=/usr/lib/sdk/devenv/lib/libc.musl-x86_64.so.1
    -Wl,-fuse-ld=mold
  env: *musl-toolchain-environment

x-cargo-build-commands: &cargo-build-commands
  - eval ${CARGO_VARS} ${CARGO_VARS_EXTRA} cargo fetch
  - eval ${CARGO_VARS} ${CARGO_VARS_EXTRA} cargo build --release

x-golang-online-build-commands: &golang-online-build-commands
  - eval ${GOVARS} ${GOVARS_EXTRA} go get
  - exit 1
x-golang-offline-build-commands: &golang-offline-build-commands
  - eval ${GOVARS} ${GOVARS_EXTRA} go install

x-python-pip-build-commands: &python-pip-build-commands
  # TODO: maybe switch to python-installer after new release
  - eval ${PYVARS} pip3 install --exists-action=i --no-index --no-build-isolation
    --prefix=${FLATPAK_DEST}/python *.whl
x-python-setup-build-commands: &python-setup-build-commands
  - eval ${PYVARS} python3 setup.py build
  - eval ${PYVARS} python3 setup.py install --skip-build --prefix=${FLATPAK_DEST}/python
    --root=/ --optimize=1

cleanup:
  - /include
  - /lib/cmake
  - /lib/pkgconfig
  - /lib/*.a
  - /share/aclocal
  - /share/cmake
  - /share/doc
  - /share/info
  - /share/man/man3
  - /share/pkgconfig
  - '*.la'

modules:

  ############################
  ####     Categories     ####
  ############################
  #
  #   Prepare
  #   Packaging: Buildsystems
  #   Libraries
  #   Packaging: Python
  #   Packaging: Tools
  #   Archive
  #   Binary
  #   Clipboard
  #   Code: Debug
  #   Code: Editors
  #   Code: Tools
  #   Code: VCS
  #   Containers
  #   Data formats
  #   Dotfiles
  #   Files: Backup and sync
  #   Files: Filesystems
  #   Files: Folder listing
  #   Files: Managers
  #   Files: Search
  #   Files: Trashcan
  #   Images
  #   Network
  #   Processes
  #   Perl
  #   Python
  #   Security
  #   Shells
  #   Shells: Multiplexers
  #   Shells: Tools
  #   Terminal emulators
  #   FSW
  #   Polish


  ############################
  ####      Prepare       ####
  ############################

  - name: prepare-ccache
    buildsystem: simple
    build-commands:
      - |
        set -e
        if [ -n "$CCACHE_DIR" ]; then
          install -dm755 ${FLATPAK_DEST}/bin
          ln -s /usr/bin/ccache ${FLATPAK_DEST}/bin/x86_64-linux-musl-gcc
          ln -s /usr/bin/ccache ${FLATPAK_DEST}/bin/x86_64-linux-musl-g++
          install -Dm755 ${SCCACHE_BIN} ${FLATPAK_DEST}/bin/rustc
        fi
    cleanup:
      - '*'

  - name: musl-libc-shared
    buildsystem: simple
    build-commands:
      - install -Dm755 /usr/lib/sdk/musl/x86_64-linux-musl/lib/libc.so ${FLATPAK_DEST}/lib/libc.musl-x86_64.so.1


  ############################
  # Packaging: Buildsystems #
  ############################

# - name: meson
#   buildsystem: simple
#   build-commands:
#     - python setup.py build
#     - python setup.py install --skip-build --prefix=${FLATPAK_DEST} --root=/ --optimize=1
#   sources:
#     - type: archive
#       url: https://github.com/mesonbuild/meson/releases/download/0.63.1/meson-0.63.1.tar.gz
#       sha256: 06fe13297213d6ff0121c5d5aab25a56ef938ffec57414ed6086fda272cb65e9
#       x-checker-data:
#         type: anitya
#         project-id: 6472
#         stable-only: true
#         url-template: https://github.com/mesonbuild/meson/releases/download/$version/meson-$version.tar.gz
#   cleanup:
#     - '*'


  ############################
  ####     Libraries      ####
  ############################

  # Libraries: Data compression

  - name: bzip2-static
    build-options: *musl-static-build-options
    no-autogen: true
    make-install-args:
      - PREFIX=${FLATPAK_DEST}
    sources:
      - type: archive
        url: https://sourceware.org/pub/bzip2/bzip2-1.0.8.tar.gz
        sha256: ab5a03176ee106d3f0fa90e381da478ddae405918153cca248e682cd0c4a2269
        x-checker-data:
          type: anitya
          project-id: 237
          stable-only: true
          url-template: https://sourceware.org/pub/bzip2/bzip2-$version.tar.gz
      - type: shell
        commands:
          - sed -i '/^CC=/d;/^CFLAGS=/d' Makefile
          - sed -i 's#$(PREFIX)/man#$(PREFIX)/share/man#g' Makefile
    cleanup:
      - '*'

  - name: lz4-static
    build-options: *musl-static-build-options
    no-autogen: true
    subdir: lib
    make-install-args:
      - PREFIX=${FLATPAK_DEST}
    sources:
      - type: archive
        url: https://github.com/lz4/lz4/archive/v1.9.4/lz4-1.9.4.tar.gz
        sha256: 0b0e3aa07c8c063ddf40b082bdf7e37a1562bda40a0ff5272957f3e987e0e54b
        x-checker-data:
          type: anitya
          project-id: 1865
          stable-only: true
          versions:
            '>': 1.9.3
          url-template: https://github.com/lz4/lz4/archive/v$version/lz4-$version.tar.gz
      - type: shell
        commands:
          - sed -i '/^BUILD_SHARED:=/ s/yes/no/' lib/Makefile
    cleanup:
      - '*'

  - name: xz-static
    build-options: *musl-static-build-options
    config-opts:
      - --disable-shared
      - --disable-nls
      - --disable-xz
      - --disable-xzdec
      - --disable-lzmadec
      - --disable-lzmainfo
      - --disable-lzma-links
      - --disable-scripts
      - --disable-doc
    sources:
      - type: archive
        url: https://tukaani.org/xz/xz-5.2.6.tar.gz
        sha256: a2105abee17bcd2ebd15ced31b4f5eda6e17efd6b10f921a01cda4a44c91b3a0
        x-checker-data:
          type: anitya
          project-id: 5277
          stable-only: true
          url-template: https://tukaani.org/xz/xz-$version.tar.gz
    cleanup:
      - '*'

  - name: zlib-static
    build-options: *musl-static-build-options
    config-opts:
      - --static
    sources:
      - type: archive
        url: https://zlib.net/zlib-1.2.12.tar.gz
        sha256: 91844808532e5ce316b3c010929493c0244f3d37593afd6de04f71821d5136d9
        x-checker-data:
          type: anitya
          project-id: 5303
          stable-only: true
          url-template: https://zlib.net/zlib-$version.tar.gz
    cleanup:
      - '*'

  - name: zstd-static # depends on lz4 xz zlib
    build-options: *musl-static-build-options
    subdir: build/cmake
    buildsystem: cmake
    config-opts:
      - -DZSTD_BUILD_PROGRAMS=OFF
      - -DZSTD_BUILD_STATIC=ON
      - -DZSTD_BUILD_SHARED=OFF
    sources:
      - type: archive
        url: https://github.com/facebook/zstd/releases/download/v1.5.2/zstd-1.5.2.tar.gz
        sha256: 7c42d56fac126929a6a85dbc73ff1db2411d04f104fae9bdea51305663a83fd0
        x-checker-data:
          type: anitya
          project-id: 12083
          stable-only: true
          url-template: https://github.com/facebook/zstd/releases/download/v$version/zstd-$version.tar.gz
    cleanup:
      - '*'


  # Libraries: Level1

  - name: acl-static
    build-options: *musl-static-build-options
    config-opts:
      - --disable-shared
    sources:
      - type: archive
        url: https://download.savannah.gnu.org/releases/acl/acl-2.3.1.tar.gz
        sha256: 760c61c68901b37fdd5eefeeaf4c0c7a26bdfdd8ac747a1edff1ce0e243c11af
        x-checker-data:
          type: anitya
          project-id: 16
          stable-only: true
          url-template: https://download.savannah.gnu.org/releases/acl/acl-$version.tar.gz
    cleanup:
      - '*'
    modules:
      - name: attr-static
        build-options: *musl-static-build-options
        config-opts:
          - --disable-shared
        sources:
          - type: archive
            url: https://download.savannah.gnu.org/releases/attr/attr-2.5.1.tar.gz
            sha256: bae1c6949b258a0d68001367ce0c741cebdacdd3b62965d17e5eb23cd78adaf8
            x-checker-data:
              type: anitya
              project-id: 137
              stable-only: true
              url-template: https://download.savannah.gnu.org/releases/attr/attr-$version.tar.gz
        cleanup:
          - '*'

  - name: expat-static
    build-options: *musl-static-build-options
    buildsystem: cmake
    config-opts:
      - -DEXPAT_BUILD_TOOLS=OFF
      - -DEXPAT_BUILD_EXAMPLES=OFF
      - -DEXPAT_BUILD_TESTS=OFF
      - -DEXPAT_SHARED_LIBS=OFF
      - -DEXPAT_BUILD_DOCS=OFF
    sources:
      - type: archive
        url: https://github.com/libexpat/libexpat/releases/download/R_2_4_8/expat-2.4.8.tar.gz
        sha256: 398f6d95bf808d3108e27547b372cb4ac8dc2298a3c4251eb7aa3d4c6d4bb3e2
        x-checker-data:
          type: anitya
          project-id: 770
          stable-only: true
          url-template: https://github.com/libexpat/libexpat/releases/download/R_${version0}_${version1}_${version2}/expat-$version.tar.gz
    cleanup:
      - '*'

  - name: fuse3-static
    build-options: *musl-static-build-options
    buildsystem: meson
    config-opts:
      - --default-library=static
      - -Ddisable-mtab=true
      - -Dudevrulesdir=${FLATPAK_DEST}/etc/udev/rules.d
      - -Dutils=false
      - -Dexamples=false
      - -Duseroot=false
      - -Dtests=false
    sources:
      - type: archive
        url: https://github.com/libfuse/libfuse/releases/download/fuse-3.11.0/fuse-3.11.0.tar.xz
        sha256: 8982c4c521daf3974dda8a5d55d575c988da13a571970f00aea149eb54fdf14c
        x-checker-data:
          type: anitya
          project-id: 861
          stable-only: true
          url-template: https://github.com/libfuse/libfuse/releases/download/fuse-$version/fuse-$version.tar.xz
    cleanup:
      - '*'

  - name: gpgme-static
    build-options: *musl-static-build-options
    config-opts:
      - --disable-shared
    make-args:
      - CCLD=$(CC) -all-static
      - CC_FOR_BUILD=$(CC)
      - CFLAGS_FOR_BUILD=$(CFLAGS)
      - CPPFLAGS_FOR_BUILD=$(CPPFLAGS)
      - LDFLAGS_FOR_BUILD=$(LDFLAGS)
    sources:
      - type: archive
        url: https://www.gnupg.org/ftp/gcrypt/gpgme/gpgme-1.18.0.tar.bz2
        sha256: 361d4eae47ce925dba0ea569af40e7b52c645c4ae2e65e5621bf1b6cdd8b0e9e
        x-checker-data:
          type: anitya
          project-id: 1239
          stable-only: true
          url-template: https://www.gnupg.org/ftp/gcrypt/gpgme/gpgme-$version.tar.bz2
      - type: shell
        commands:
          - sed -i 's/\($(CC_FOR_BUILD)\)/\1 $(CFLAGS_FOR_BUILD)/' doc/Makefile.in
    cleanup:
      - '*'
    modules:
      - name: libassuan-static
        build-options: *musl-static-build-options
        config-opts:
          - --disable-shared
        make-args:
          - CCLD=$(CC) -all-static
          - CC_FOR_BUILD=$(CC)
          - CFLAGS_FOR_BUILD=$(CFLAGS)
          - CPPFLAGS_FOR_BUILD=$(CPPFLAGS)
          - LDFLAGS_FOR_BUILD=$(LDFLAGS)
        sources:
          - type: archive
            url: https://gnupg.org/ftp/gcrypt/libassuan/libassuan-2.5.5.tar.bz2
            sha256: 8e8c2fcc982f9ca67dcbb1d95e2dc746b1739a4668bc20b3a3c5be632edb34e4
            x-checker-data:
              type: anitya
              project-id: 1559
              stable-only: true
              url-template: https://gnupg.org/ftp/gcrypt/libassuan/libassuan-$version.tar.bz2
        cleanup:
          - '*'
        modules:
          - name: libgpg-error-static
            build-options: *musl-static-build-options
            config-opts:
              - --disable-shared
              - --disable-nls
            make-args:
              - CCLD=$(CC) -all-static
              - CC_FOR_BUILD=$(CC)
              - CFLAGS_FOR_BUILD=$(CFLAGS)
              - CPPFLAGS_FOR_BUILD=$(CPPFLAGS)
              - LDFLAGS_FOR_BUILD=$(LDFLAGS)
            sources:
              - type: archive
                url: https://www.gnupg.org/ftp/gcrypt/libgpg-error/libgpg-error-1.45.tar.bz2
                sha256: 570f8ee4fb4bff7b7495cff920c275002aea2147e9a1d220c068213267f80a26
                x-checker-data:
                  type: anitya
                  project-id: 1628
                  stable-only: true
                  url-template: https://www.gnupg.org/ftp/gcrypt/libgpg-error/libgpg-error-$version.tar.bz2
            cleanup:
              - '*'

  - name: libffi-static
    build-options: *musl-static-build-options
    config-opts:
      - --disable-shared
    sources:
      - type: archive
        url: https://github.com/libffi/libffi/releases/download/v3.4.2/libffi-3.4.2.tar.gz
        sha256: 540fb721619a6aba3bdeef7d940d8e9e0e6d2c193595bc243241b77ff9e93620
        x-checker-data:
          type: anitya
          project-id: 1611
          stable-only: true
          url-template: https://github.com/libffi/libffi/releases/download/v$version/libffi-$version.tar.gz
    cleanup:
      - '*'

  - name: libidn2-static
    # TODO: add libunistring dependency?
    build-options: *musl-static-build-options
    config-opts:
      - --disable-shared
    sources:
      - type: archive
        url: https://ftp.gnu.org/gnu/libidn/libidn2-2.3.3.tar.gz
        sha256: f3ac987522c00d33d44b323cae424e2cffcb4c63c6aa6cd1376edacbf1c36eb0
        x-checker-data:
          type: anitya
          project-id: 5597
          stable-only: true
          url-template: https://ftp.gnu.org/gnu/libidn/libidn2-$version.tar.gz
    cleanup:
      - '*'

  - name: libjpeg-turbo-static
    build-options: *musl-static-build-options
    buildsystem: cmake
    config-opts:
      - -DENABLE_SHARED=OFF
      - -DENABLE_STATIC=ON
      - -DWITH_JPEG8=ON
    sources:
      - type: archive
        url: https://downloads.sourceforge.net/sourceforge/libjpeg-turbo/libjpeg-turbo-2.1.4.tar.gz
        sha256: d3ed26a1131a13686dfca4935e520eb7c90ae76fbc45d98bb50a8dc86230342b
        x-checker-data:
          type: anitya
          project-id: 1648
          stable-only: true
          url-template: https://downloads.sourceforge.net/sourceforge/libjpeg-turbo/libjpeg-turbo-$version.tar.gz
    cleanup:
      - '*'

  - name: openssl-static
    build-options: *musl-static-build-options
    config-opts:
      - --libdir=lib
      - --openssldir=/etc/ssl
      - -static
      - no-ssl3-method
      - enable-ec_nistp_64_gcc_128
      - linux-x86_64
      - -Wa,--noexecstack
    install-rule: install_sw
    sources:
      - type: archive
        url: https://www.openssl.org/source/openssl-1.1.1q.tar.gz
        sha256: d7939ce614029cdff0b6c20f0e2e5703158a489a72b2507b8bd51bf8c8fd10ca
        x-checker-data:
          type: anitya
          project-id: 2566
          stable-only: true
          versions:
            <: 2.0.0
          version-scheme: semantic
          url-template: https://www.openssl.org/source/openssl-$version.tar.gz
      - type: patch
        # https://github.com/openssl/openssl/issues/14574
        path: openssl-static-threads.patch
        options:
          - --reverse
      - type: shell
        commands:
          - ln -s {C,c}onfigure
    cleanup:
      - '*'

  - name: popt-static
    build-options: *musl-static-build-options
    config-opts:
      - --disable-shared
    sources:
      - type: archive
        url: http://ftp.rpm.org/popt/releases/popt-1.x/popt-1.18.tar.gz
        sha256: 5159bc03a20b28ce363aa96765f37df99ea4d8850b1ece17d1e6ad5c24fdc5d1
        x-checker-data:
          type: anitya
          project-id: 3689
          stable-only: true
          url-template: http://ftp.rpm.org/popt/releases/popt-$version0.x/popt-$version.tar.gz
    cleanup:
      - '*'

  - name: readline-static
    build-options: *musl-static-build-options
    config-opts:
      - --disable-shared
      - --with-curses
    sources:
      - type: archive
        url: https://ftp.gnu.org/gnu/readline/readline-8.1.2.tar.gz
        sha256: 7589a2381a8419e68654a47623ce7dfcb756815c8fee726b98f90bf668af7bc6
        x-checker-data:
          type: anitya
          project-id: 4173
          stable-only: true
          url-template: https://ftp.gnu.org/gnu/readline/readline-$version.tar.gz
      - type: patch
        path: readline-set-devenv-defaults.patch
    cleanup:
      - '*'
    modules:
      - name: ncurses-static
        build-options: *musl-static-build-options
        config-opts:
          - --without-dlsym
          - --with-terminfo-dirs=${datadir}/share/terminfo:/var/lib/devenv/share/terminfo:/usr/share/terminfo
         #- --with-default-terminfo-dir=${datadir}/terminfo
          - --disable-db-install
          - --enable-widec
          - --enable-pc-files
          - --with-normal
          - --with-cxx
          - --with-cxx-binding
          - --without-ada
          - --without-debug
          - --without-manpages
          - --without-progs
          - --without-tests
        post-install:
          - ln -s libncursesw.a ${FLATPAK_DEST}/lib/libcurses.a
          - ln -s libncursesw.a ${FLATPAK_DEST}/lib/libncurses.a
          - ln -s ncursesw.pc ${FLATPAK_DEST}/lib/pkgconfig/tinfo.pc
          - ln -s ncursesw.pc ${FLATPAK_DEST}/lib/pkgconfig/curses.pc
          - ln -s ncursesw.pc ${FLATPAK_DEST}/lib/pkgconfig/ncurses.pc
        sources:
          - type: archive
            url: https://ftp.gnu.org/pub/gnu/ncurses/ncurses-6.3.tar.gz
            sha256: 97fc51ac2b085d4cde31ef4d2c3122c21abc217e9090a43a30fc5ec21684e059
            x-checker-data:
              type: anitya
              project-id: 234776
              stable-only: true
              url-template: https://ftp.gnu.org/pub/gnu/ncurses/ncurses-$version.tar.gz
          - type: shell
            commands:
              - install -dm755 ${FLATPAK_DEST}/lib/pkgconfig
        cleanup:
          - '*'

  - name: tcl-static # depends on zlib
    build-options: *musl-static-build-options
    subdir: unix
    config-opts:
      - --mandir=${prefix}/share/man
      - --disable-shared
      - --enable-threads
      - --enable-64bit
    post-install:
      - ln -sr ${FLATPAK_DEST}/bin/tclsh* ${FLATPAK_DEST}/bin/tclsh
        # no write permission breaks strip
      - chmod u+w ${FLATPAK_DEST}/lib/libtcl*
    sources:
      - type: archive
        url: https://downloads.sourceforge.net/sourceforge/tcl/tcl8.6.12-src.tar.gz
        sha256: 26c995dd0f167e48b11961d891ee555f680c175f7173ff8cb829f4ebcde4c1a6
        x-checker-data:
          type: anitya
          project-id: 4941
          stable-only: true
          url-template: https://downloads.sourceforge.net/sourceforge/tcl/tcl$version-src.tar.gz
      - type: shell
        commands:
          - rm -rf pkgs/sqlite3*
          - sed -i 's/enable-shared/disable-shared/' unix/Makefile.in
    cleanup:
      - '*'

  - name: xxhash-static
    build-options: *musl-static-build-options
    no-autogen: true
    make-args:
      - lib
    make-install-args:
      - prefix=${FLATPAK_DEST}
    sources:
      - type: archive
        url: https://github.com/Cyan4973/xxHash/archive/v0.8.1/xxhash-0.8.1.tar.gz
        sha256: 3bb6b7d6f30c591dd65aaaff1c8b7a5b94d81687998ca9400082c739a690436c
        x-checker-data:
          type: anitya
          project-id: 17583
          stable-only: true
          url-template: https://github.com/Cyan4973/xxHash/archive/v$version/xxhash-$version.tar.gz
      - type: shell
        commands:
          - sed -e '/$(INSTALL_PROGRAM) $(LIBXXH)/d' -e '/ln -sf $(LIBXXH)/d' -i Makefile
    cleanup:
      - '*'


  #  Libraries: Level2

  - name: gdbm-static # depends on readline
    build-options: *musl-static-build-options
    config-opts:
      - --disable-shared
      - --enable-libgdbm-compat
    sources:
      - type: archive
        url: https://ftp.gnu.org/gnu/gdbm/gdbm-1.23.tar.gz
        sha256: 74b1081d21fff13ae4bd7c16e5d6e504a4c26f7cde1dca0d963a484174bbcacd
        x-checker-data:
          type: anitya
          project-id: 882
          stable-only: true
          url-template: https://ftp.gnu.org/gnu/gdbm/gdbm-$version.tar.gz
      - type: shell
        commands:
          - sed -i '/SUBDIRS =/ s/po //' Makefile.{am,in}
    cleanup:
      - '*'

  - name: krb5-static
    build-options: *musl-static-build-options
    subdir: src
    config-opts:
      - --localstatedir=/var/lib
      - --sbindir=${prefix}/bin
      - --enable-static
      - --disable-shared
      - --disable-nls
    make-args:
      - CFLAGS+=-fcommon
    sources:
      - type: archive
        url: https://kerberos.org/dist/krb5/1.20/krb5-1.20.tar.gz
        sha256: 7e022bdd3c851830173f9faaa006a230a0e0fdad4c953e85bff4bf0da036e12f
        x-checker-data:
          type: html
          url: https://kerberos.org/dist/
          version-pattern: Kerberos V5 Release ([\d\.-]+) - current release
          url-template: https://kerberos.org/dist/krb5/$version0.$version1/krb5-$version.tar.gz
    cleanup:
      - '*'

  - name: libarchive-static # depends on acl bzip2 expat lz4 openssl xz zlib zstd
    build-options: *musl-static-build-options
    config-opts:
      - --disable-shared
      - --disable-bsdcat
      - --disable-bsdcpio
      - --disable-bsdtar
      - --without-xml2
    sources:
      - type: archive
        url: http://www.libarchive.org/downloads/libarchive-3.6.1.tar.xz
        sha256: 5a411aceb978f43e626f0c2d1812ddd8807b645ed892453acabd532376c148e6
        x-checker-data:
          type: anitya
          project-id: 1558
          stable-only: true
          url-template: http://www.libarchive.org/downloads/libarchive-$version.tar.xz
    cleanup:
      - '*'

  - name: libevent-static  # depends on openssl
    # TODO: try again to build static lib with cmake
    build-options: *musl-static-build-options
    config-opts:
      - --disable-shared
      - --enable-openssl
    sources:
      - type: archive
        url: https://github.com/libevent/libevent/releases/download/release-2.1.12-stable/libevent-2.1.12-stable.tar.gz
        sha256: 92e6de1be9ec176428fd2367677e61ceffc2ee1cb119035037a27d346b0403bb
        x-checker-data:
          type: anitya
          project-id: 1606
          stable-only: true
          url-template: https://github.com/libevent/libevent/releases/download/release-$version-stable/libevent-$version-stable.tar.gz
    cleanup:
      - '*'

  - name: libpng-static # depends on zlib
    build-options: *musl-static-build-options
    config-opts:
      - --enable-static
    make-args:
      - CPPFLAGS=-I${FLATPAK_DEST}/include
    sources:
      - type: archive
        url: http://downloads.sourceforge.net/libpng/libpng-1.6.37.tar.gz
        sha256: daeb2620d829575513e35fecc83f0d3791a620b9b93d800b763542ece9390fb4
        x-checker-data:
          type: anitya
          project-id: 1705
          stable-only: true
          url-template: http://downloads.sourceforge.net/libpng/libpng-$version.tar.gz
    cleanup:
      - '*'

  - name: libssh-static # depends on openssl zlib
    build-options: *musl-static-build-options
    buildsystem: cmake
    builddir: true
    config-opts:
      # wrong detection of zlib includedir prepend /usr/include before musl includedir
      - -DZLIB_INCLUDE_DIR=/usr/lib/sdk/devenv/include
      - -DWITH_GSSAPI=OFF
      - -DBUILD_SHARED_LIBS=OFF
      - -DUNIT_TESTING=OFF
      - -DWITH_EXAMPLES=OFF
    sources:
      - type: archive
        url: https://www.libssh.org/files/0.10/libssh-0.10.2.tar.xz
        sha256: 15b83d7b74c8c67f758fb32faf1d9a35d5f8f50db523276a419e9876530f098a
        x-checker-data:
          type: anitya
          project-id: 1729
          stable-only: true
          url-template: https://www.libssh.org/files/$version0.$version1/libssh-$version.tar.xz
    cleanup:
      - '*'

  - name: libxml2-static # depends on ncurses readline xz zlib
    # TODO: test if icu should be enabled
    build-options: *musl-static-build-options
    config-opts:
      - --enable-static
      - --without-python
    sources:
      - type: archive
        url: https://download.gnome.org/sources/libxml2/2.10/libxml2-2.10.2.tar.xz
        sha256: d240abe6da9c65cb1900dd9bf3a3501ccf88b3c2a1cb98317d03f272dda5b265
        x-checker-data:
          type: anitya
          project-id: 1783
          stable-only: true
          url-template: https://download.gnome.org/sources/libxml2/$version0.$version1/libxml2-$version.tar.xz
    cleanup:
      - '*'

  - name: pcre-static # depends on bzip2 readline zlib
    build-options: *musl-static-build-options
    config-opts:
      - --disable-shared
    sources:
      - type: archive
        url: http://ftp.cs.stanford.edu/pub/exim/pcre/pcre-8.45.tar.gz
        sha256: 4e6ce03e0336e8b4a3d6c2b70b1c5e18590a5673a98186da90d4f33c23defc09
        x-checker-data:
          type: anitya
          project-id: 2610
          stable-only: true
          url-template: http://ftp.cs.stanford.edu/pub/exim/pcre/pcre-$version.tar.gz
    cleanup:
      - '*'

  - name: pcre2-static # depends on bzip2 readline zlib
    build-options: *musl-static-build-options
    config-opts:
      - --disable-shared
      - --enable-pcre2-16
      - --enable-pcre2-32
      - --enable-jit
    post-install:
      - rm ${FLATPAK_DEST}/bin/pcre2{grep,test}
    sources:
      - type: archive
        url: https://github.com/PCRE2Project/pcre2/releases/download/pcre2-10.40/pcre2-10.40.tar.gz
        sha256: ded42661cab30ada2e72ebff9e725e745b4b16ce831993635136f2ef86177724
        x-checker-data:
          type: anitya
          project-id: 5832
          stable-only: true
          url-template: https://github.com/PCRE2Project/pcre2/releases/download/pcre2-$version/pcre2-$version.tar.gz
    cleanup:
      - '*'

  - name: sqlite-static # depends on readline tcl(util) zlib
    build-options: *musl-static-build-options
    config-opts:
      - --disable-shared
      - --disable-tcl
      - --enable-fts3
      - --enable-fts4
      - --enable-fts5
      - --enable-rtree
    make-args:
      - LTLINK_EXTRAS=-all-static
    sources:
      - type: archive
        url: https://github.com/sqlite/sqlite/archive/version-3.39.2/sqlite-version-3.39.2.tar.gz
        sha256: d981f7c1c237e34121176061e3fc5922ca85c9242c7aab0e5a2f19bd5179b5e7
        x-checker-data:
         #type: html
         #url: https://www.sqlite.org/download.html
         #version-pattern: sqlite-src-([\d]+).zip
         #url-template: https://www.sqlite.org/2022/sqlite-src-$version.zip
          type: anitya
          project-id: 4877
          stable-only: true
          url-template: https://github.com/sqlite/sqlite/archive/version-$version/sqlite-version-$version.tar.gz
    cleanup:
      - '*'


  # Libraries: Level3

  - name: glib2-static # depends on libffi pcre zlib
    # NOTE: need a recent meson version
    build-options: *musl-static-build-options
    buildsystem: meson
    config-opts:
      - --default-library=static
      - -Dselinux=disabled
      - -Dxattr=false
      - -Dlibmount=disabled
      - -Dtests=false
      - -Dnls=disabled
      - -Dglib_debug=disabled
      - -Dglib_assert=false
      - -Dglib_checks=false
      - -Dlibelf=disabled
    sources:
      - type: archive
        url: https://download.gnome.org/sources/glib/2.72/glib-2.72.3.tar.xz
        sha256: 4a39a2f624b8512d500d5840173eda7fa85f51c109052eae806acece85d345f0
        x-checker-data:
          type: gnome
          name: glib
    cleanup:
      - '*'

  - name: libsasl-static # depends on gdbm openssl
    # TODO: evaluate adding dependencies krb5 liblsap mariadb postgresql sqlite
    build-options: *musl-static-build-options
    config-opts:
      - --sbindir=${prefix}/bin
      - --disable-shared
      - --disable-sample
    make-args:
      - CCLD=$(CC) -all-static
    sources:
      - type: archive
        url: https://github.com/cyrusimap/cyrus-sasl/releases/download/cyrus-sasl-2.1.28/cyrus-sasl-2.1.28.tar.gz
        sha256: 7ccfc6abd01ed67c1a0924b353e526f1b766b21f42d4562ee635a8ebfc5bb38c
        x-checker-data:
          type: anitya
          project-id: 13280
          stable-only: true
          url-template: https://github.com/cyrusimap/cyrus-sasl/releases/download/cyrus-sasl-$version/cyrus-sasl-$version.tar.gz
      - type: shell
        commands:
          - sed -i '/LIBS=/ s/\(-lgdbm\)/\1 -lgdbm_compat/' configure
    cleanup:
      - '*'


  # Libraries: Level4

  - name: librsvg-static # depends on bzip2 glib2 expat libffi libpng libxml2 pcre
    build-options: *musl-static-build-options
    config-opts:
      - --disable-shared
      - --enable-pixbuf-loader
      - --disable-gtk-doc
      - --disable-introspection
      - --disable-vala
    make-args: &librsvg-make-args
      - HOME=$(FLATPAK_BUILDER_BUILDDIR)
      - CARGO_HOME=$(FLATPAK_BUILDER_BUILDDIR)/cargo
      - RUST_TARGET_SUBDIR=x86_64-unknown-linux-musl/release
    make-install-args: *librsvg-make-args
    sources:
      - type: archive
        url: https://download.gnome.org/sources/librsvg/2.54/librsvg-2.54.5.tar.xz
        sha256: 4f03190f45324d1fa1f52a79dfcded1f64eaf49b3ae2f88eedab0c07617cae6e
        x-checker-data:
          type: gnome
          name: librsvg
          stable-only: true
      - librsvg-cargo-sources.json # flatpak-cargo-generator.py Cargo.lock -o librsvg-cargo-sources.json
      - type: file
        dest: .cargo
        dest-filename: config
        path: librsvg-cargo-config
    cleanup:
      - '*'
    modules:
      - name: gdk-pixbuf2-static # depends on glib2 libjpeg-turbo libpng
        # TODO: add depends libtiff and enable loader
        build-options: *musl-static-build-options
        buildsystem: meson
        config-opts:
          - --default-library=static
          - -Dpng=enabled
          - -Dtiff=disabled
          - -Djpeg=enabled
         #- -Dbuiltin_loaders=png,jpeg
          - -Dbuiltin_loaders=all
          - -Dgtk_doc=false
          - -Ddocs=false
          - -Dintrospection=disabled
          - -Dman=false
         #- -Drelocatable=false
          - -Dtests=false
          - -Dinstalled_tests=false
          - -Dgio_sniffing=false
        post-install:
          - rm -f ${FLATPAK_DEST}/lib/gdk-pixbuf-2.0/2.*/loaders.cache
        sources:
          - type: archive
            url: https://download.gnome.org/sources/gdk-pixbuf/2.42/gdk-pixbuf-2.42.9.tar.xz
            sha256: 28f7958e7bf29a32d4e963556d241d0a41a6786582ff6a5ad11665e0347fc962
            x-checker-data:
              type: gnome
              name: gdk-pixbuf
              stable-only: true
          - type: shell
            commands:
              - sed -i '/subdir(.po.)/d' meson.build
        cleanup:
          - '*'
      - name: pango-static
        build-options: *musl-static-build-options
        buildsystem: meson
        config-opts:
          - --default-library=static
          - -Dgtk_doc=false
          - -Dintrospection=disabled
          - -Dfontconfig=disabled
          - -Dlibthai=disabled
          - -Dcairo=enabled
          - -Dxft=disabled
          - -Dfreetype=enabled
        sources:
          - type: archive
            url: https://download.gnome.org/sources/pango/1.50/pango-1.50.9.tar.xz
            sha256: 1b636aabf905130d806372136f5e137b6a27f26d47defd9240bf444f6a4fe610
            x-checker-data:
              type: gnome
              name: pango
              versions:
                <: '1.90'
              stable-only: true
        cleanup:
          - '*'
        modules:
          - name: cairo-static
            build-options: *musl-static-build-options
            buildsystem: meson
            config-opts:
              - --default-library=static
              - -Dfontconfig=enabled
              - -Dfreetype=enabled
              - -Dgl-backend=disabled
              - -Dpng=enabled
              - -Dxcb=disabled
              - -Dxlib=disabled
              - -Dxlib-xcb=disabled
              - -Dxml=disabled
              - -Dzlib=enabled
              - -Dtests=disabled
              - -Dglib=enabled # librsvg linked against cairo-gobject
              - -Dspectre=disabled
              - -Dsymbol-lookup=disabled
              - -Dgtk_doc=false
            sources:
              - type: archive
                url: https://gitlab.freedesktop.org/cairo/cairo/-/archive/1.17.6/cairo-1.17.6.tar.gz
                sha256: a2227afc15e616657341c42af9830c937c3a6bfa63661074eabef13600e8936f
                # TODO: enable this after https://github.com/flathub/flatpak-external-data-checker/issues/326 fixed
               #x-checker-data:
               #  type: gnome
               #  name: cairo
               #  # NOTE: 1.17.6 tarball is broken on gnome.org
               #  versions:
               #    '>': 1.17.6
               #  stable-only: true
            cleanup:
              - '*'
            modules:
              - name: fontconfig-static
                # TODO: import flatpak runtime cache patches
                buildsystem: meson
                build-options: *musl-static-build-options
                config-opts:
                  - --default-library=static
                  - -Ddoc=disabled
                  - -Dnls=disabled
                  - -Dtests=disabled
                  - -Dtools=disabled
                  - -Dcache-build=disabled
                sources:
                  - type: archive
                    url: https://gitlab.freedesktop.org/fontconfig/fontconfig/-/archive/2.14.0/fontconfig-2.14.0.tar.gz
                    sha256: 48f5ea2e5038f038adcb8b2bc9e6dd30987ccc962665092657b95f9f6d21a49a
                    x-checker-data:
                      type: anitya
                      project-id: 827
                      stable-only: true
                      url-template: https://gitlab.freedesktop.org/fontconfig/fontconfig/-/archive/$version/fontconfig-$version.tar.gz
                cleanup:
                  - '*'
                modules:
                  - name: freetype2-static
                    build-options: *musl-static-build-options
                    buildsystem: meson
                    config-opts:
                      - --default-library=static
                      - -Dbrotli=disabled
                      - -Dbzip2=enabled
                      - -Dharfbuzz=enabled
                      - -Dpng=enabled
                      - -Dtests=disabled
                      - -Dzlib=enabled
                    sources:
                      - type: archive
                        url: https://download-mirror.savannah.gnu.org/releases/freetype/freetype-2.12.1.tar.xz
                        sha256: 4766f20157cc4cf0cd292f80bf917f92d1c439b243ac3018debf6b9140c41a7f
                        x-checker-data:
                          type: anitya
                          project-id: 854
                          stable-only: true
                          url-template: https://download-mirror.savannah.gnu.org/releases/freetype/freetype-$version.tar.xz
                    cleanup:
                      - '*'
                    modules:
                      - name: harfbuzz-static
                        # TODO: use globally set build options
                       #build-options: *musl-static-build-options
                        build-options:
                          cflags: -static -fno-exceptions -fno-rtti
                          cxxflags: -static -fno-exceptions -fno-rtti
                          ldflags: -static
                          env:
                            - CC=x86_64-linux-musl-gcc
                            - CXX=x86_64-linux-musl-g++
                        buildsystem: meson
                        # TODO: add graphite2
                        config-opts:
                          - --default-library=static
                          - -Dglib=disabled
                          - -Dgobject=disabled
                          - -Dcairo=disabled
                          - -Dchafa=disabled
                          - -Dicu=disabled
                          - -Dgraphite=disabled
                          - -Dgraphite2=disabled
                          - -Dfreetype=enabled
                          - -Dtests=disabled
                          - -Dintrospection=disabled
                          - -Ddocs=disabled
                          - -Dbenchmark=disabled
                          - -Dicu_builtin=true
                        sources:
                          - type: archive
                            url: https://github.com/harfbuzz/harfbuzz/releases/download/5.1.0/harfbuzz-5.1.0.tar.xz
                            sha256: 2edb95db668781aaa8d60959d21be2ff80085f31b12053cdd660d9a50ce84f05
                            x-checker-data:
                              type: anitya
                              project-id: 1299
                              stable-only: true
                              url-template: https://github.com/harfbuzz/harfbuzz/releases/download/$version/harfbuzz-$version.tar.xz
                        cleanup:
                          - '*'
                        modules:
                          - name: freetype2-noharfbuzz-static
                            build-options: *musl-static-build-options
                            buildsystem: meson
                            config-opts:
                              - --default-library=static
                              - -Dbrotli=disabled
                              - -Dbzip2=enabled
                              - -Dharfbuzz=disabled
                              - -Dpng=enabled
                              - -Dtests=disabled
                              - -Dzlib=enabled
                            sources:
                              - type: archive
                                url: https://download-mirror.savannah.gnu.org/releases/freetype/freetype-2.12.1.tar.xz
                                sha256: 4766f20157cc4cf0cd292f80bf917f92d1c439b243ac3018debf6b9140c41a7f
                                x-checker-data:
                                  type: anitya
                                  project-id: 854
                                  stable-only: true
                                  url-template: https://download-mirror.savannah.gnu.org/releases/freetype/freetype-$version.tar.xz
                            cleanup:
                              - '*'
              - name: pixman-static
                build-options: *musl-static-build-options
                buildsystem: meson
                config-opts:
                  - --default-library=static
                  - -Dloongson-mmi=disabled
                  - -Dvmx=disabled
                  - -Darm-simd=disabled
                  - -Dneon=disabled
                  - -Diwmmxt=disabled
                  - -Diwmmxt2=false
                  - -Dmips-dspr2=disabled
                  - -Dgnu-inline-asm=disabled
                  - -Dopenmp=disabled
                  - -Dgtk=disabled
                  - -Dlibpng=enabled
                sources:
                  - type: archive
                    url: https://xorg.freedesktop.org/releases/individual/lib/pixman-0.40.0.tar.gz
                    sha256: 6d200dec3740d9ec4ec8d1180e25779c00bc749f94278c8b9021f5534db223fc
                    x-checker-data:
                      type: anitya
                      project-id: 3648
                      stable-only: true
                      url-template: https://xorg.freedesktop.org/releases/individual/lib/pixman-$version.tar.gz
                cleanup:
                  - '*'
          - name: fribidi-static
            build-options: *musl-static-build-options
            buildsystem: meson
            config-opts:
              - --default-library=static
              - -Ddocs=false
              - -Dbin=false
              - -Dtests=false
            sources:
              - type: archive
                url: https://github.com/fribidi/fribidi/releases/download/v1.0.12/fribidi-1.0.12.tar.xz
                sha256: 0cd233f97fc8c67bb3ac27ce8440def5d3ffacf516765b91c2cc654498293495
                x-checker-data:
                  type: anitya
                  project-id: 857
                  stable-only: true
                  url-template: https://github.com/fribidi/fribidi/releases/download/v$version/fribidi-$version.tar.xz
            cleanup:
              - '*'


  # Libraries: Display server

  - name: wayland-static # depends on expat liffi
    build-options: *musl-static-build-options
    buildsystem: meson
    config-opts:
      - --default-library=static
      - -Dtests=false
      - -Ddocumentation=false
      - -Ddtd_validation=false
    sources:
      - type: archive
        url: https://gitlab.freedesktop.org/wayland/wayland/-/releases/1.21.0/downloads/wayland-1.21.0.tar.xz
        sha256: 6dc64d7fc16837a693a51cfdb2e568db538bfdc9f457d4656285bb9594ef11ac
        x-checker-data:
          type: anitya
          project-id: 10061
          stable-only: true
          url-template: https://gitlab.freedesktop.org/wayland/wayland/-/releases/$version/downloads/wayland-$version.tar.xz
    cleanup:
      - '*'

  - name: wayland-protocols
    buildsystem: meson
    sources:
      - type: archive
        url: https://wayland.freedesktop.org/releases/wayland-protocols-1.26.tar.xz
        sha256: c553384c1c68afd762fa537a2569cc9074fe7600da12d3472761e77a2ba56f13
        x-checker-data:
          type: anitya
          project-id: 13997
          stable-only: true
          url-template: https://wayland.freedesktop.org/releases/wayland-protocols-$version.tar.xz
    cleanup:
      - '*'

  - name: libxmu-static
    build-options: *musl-static-build-options
    config-opts:
      - --disable-shared
      - --disable-docs
      - --enable-unix-transport # TODO: test if needed for sway/wlroots
      - --disable-tcp-transport
      - --disable-ipv6
      - --enable-local-transport # TODO: test if needed for sway/wlroots
    sources:
      - type: archive
        url: https://xorg.freedesktop.org/releases/individual/lib/libXmu-1.1.3.tar.bz2
        sha256: 9c343225e7c3dc0904f2122b562278da5fed639b1b5e880d25111561bac5b731
        x-checker-data:
          type: anitya
          project-id: 1785
          stable-only: true
          url-template: https://xorg.freedesktop.org/releases/individual/lib/libXmu-$version.tar.bz2
    cleanup:
      - '*'
    modules:
      - name: xorg-util-macros
        make-install-args:
          - pkgconfigdir=${FLATPAK_DEST}/lib/pkgconfig
        sources:
          - type: archive
            url: https://www.x.org/releases/individual/util/util-macros-1.19.3.tar.gz
            sha256: 624bb6c3a4613d18114a7e3849a3d70f2d7af9dc6eabeaba98060d87e3aef35b
            x-checker-data:
              type: anitya
              project-id: 15037
              stable-only: true
              url-template: https://www.x.org/releases/individual/util/util-macros-$version.tar.gz
        cleanup:
          - '*'
      - name: xorgproto
        # needed for correct detection of fds_bits
        build-options: *musl-static-build-options
        post-install:
          - mv ${FLATPAK_DEST}/share/pkgconfig/* ${FLATPAK_DEST}/lib/pkgconfig/
        sources:
          - type: archive
            url: https://xorg.freedesktop.org/archive/individual/proto/xorgproto-2022.2.tar.gz
            sha256: da351a403d07a7006d7bdc8dcfc14ddc1b588b38fb81adab9989a8eef605757b
            x-checker-data:
              type: anitya
              project-id: 17190
              stable-only: true
              url-template: https://xorg.freedesktop.org/archive/individual/proto/xorgproto-$version.tar.gz
        cleanup:
          - '*'
      - name: xtrans
        make-install-args:
          - pkgconfigdir=${FLATPAK_DEST}/lib/pkgconfig
        sources:
          - type: archive
            url: https://www.x.org/releases/individual/lib/xtrans-1.4.0.tar.gz
            sha256: 48ed850ce772fef1b44ca23639b0a57e38884045ed2cbb18ab137ef33ec713f9
            x-checker-data:
              type: anitya
              project-id: 13651
              stable-only: true
              url-template: https://www.x.org/releases/individual/lib/xtrans-$version.tar.gz
        cleanup:
          - '*'
      - name: libx11-static
        build-options: *musl-static-build-options
        config-opts:
          - --disable-shared
          - --disable-specs
          - --enable-unix-transport # TODO: test if needed for sway/wlroots
          - --disable-tcp-transport
          - --disable-ipv6
          - --enable-local-transport # TODO: test if needed for sway/wlroots
          - --disable-xf86bigfont
        sources:
          - type: archive
            url: https://www.x.org/releases/individual/lib/libX11-1.8.1.tar.gz
            sha256: d52f0a7c02a45449f37b0831d99ff936d92eb4ce8b4c97dc17a63cea79ce5a76
            x-checker-data:
              type: anitya
              project-id: 1764
              stable-only: true
              url-template: https://www.x.org/releases/individual/lib/libX11-$version.tar.gz
        cleanup:
          - '*'
        modules:
          - name: libxcb-static
            build-options: *musl-static-build-options
            config-opts:
              - --disable-shared
              - --enable-xinput
              - --enable-xkb
              - --disable-devel-docs
              - --disable-composite
              - --disable-damage
              - --disable-dpms
              - --enable-dri2 # needed for mesa
              - --enable-dri3 # needed for mesa
              - --enable-glx # needed for mesa
              - --enable-present # needed for wlroots
              - --disable-randr
              - --disable-record
              - --enable-render # needed for mesa
              - --disable-resource
              - --disable-screensaver
              - --enable-shape # needed for mesa
              - --enable-shm # needed for wlroots
              - --disable-sync
              - --disable-xevie
              - --enable-xfixes # needed for mesa
              - --disable-xfree86-dri
              - --disable-xinerama
              - --disable-xtest
              - --disable-xv
              - --disable-xvmc
            sources:
              - type: archive
                url: https://www.x.org/archive/individual/lib/libxcb-1.15.tar.xz
                sha256: cc38744f817cf6814c847e2df37fcb8997357d72fa4bcbc228ae0fe47219a059
                x-checker-data:
                  type: anitya
                  project-id: 1767
                  stable-only: true
                  url-template: https://www.x.org/archive/individual/lib/libxcb-$version.tar.xz
            cleanup:
              - '*'
            modules:
              - name: libxau-static
                build-options: *musl-static-build-options
                config-opts:
                  - --disable-shared
                sources:
                  - type: archive
                    url: https://www.x.org/releases/individual/lib/libXau-1.0.9.tar.gz
                    sha256: 1f123d8304b082ad63a9e89376400a3b1d4c29e67e3ea07b3f659cccca690eea
                x-checker-data:
                  type: anitya
                  project-id: 1765
                  stable-only: true
                  url-template: https://www.x.org/releases/individual/lib/libXau-$version.tar.gz
                cleanup:
                  - '*'
              - name: libxdmcp-static
                build-options: *musl-static-build-options
                config-opts:
                  - --disable-shared
                sources:
                  - type: archive
                    url: https://www.x.org/releases/individual/lib/libXdmcp-1.1.3.tar.gz
                    sha256: 2ef9653d32e09d1bf1b837d0e0311024979653fe755ad3aaada8db1aa6ea180c
                    x-checker-data:
                      type: anitya
                      project-id: 1772
                      stable-only: true
                      url-template: https://www.x.org/releases/individual/lib/libXdmcp-$version.tar.gz
                cleanup:
                  - '*'
              - name: xcb-proto
                build-options: *musl-static-build-options
                config-opts:
                  - --disable-shared
                make-install-args:
                  - pkgconfigdir=${FLATPAK_DEST}/lib/pkgconfig
                sources:
                  - type: archive
                    url: https://xorg.freedesktop.org/archive/individual/proto/xcb-proto-1.15.2.tar.gz
                    sha256: 6b1ed9cd7cf35e37913eeecca37e5b85b14903002942b3e332f321335c27a8eb
                    x-checker-data:
                      type: anitya
                      project-id: 13646
                      stable-only: true
                      url-template: https://xorg.freedesktop.org/archive/individual/proto/xcb-proto-$version.tar.gz
                cleanup:
                  - '*'
          - name: xcb-util-renderutil-static # needed for wlroots
            build-options: *musl-static-build-options
            config-opts:
              - --disable-shared
              - --disable-devel-docs
            sources:
              - type: archive
                url: https://xcb.freedesktop.org/dist/xcb-util-renderutil-0.3.9.tar.gz
                sha256: 55eee797e3214fe39d0f3f4d9448cc53cffe06706d108824ea37bb79fcedcad5
                x-checker-data:
                  type: anitya
                  project-id: 5169
                  stable-only: true
                  url-template: https://xcb.freedesktop.org/dist/xcb-util-renderutil-$version.tar.gz
            cleanup:
              - '*'
      - name: libxext-static
        build-options: *musl-static-build-options
        config-opts:
          - --disable-shared
        sources:
          - type: archive
            url: https://www.x.org/releases/individual/lib/libXext-1.3.4.tar.gz
            sha256: 8ef0789f282826661ff40a8eef22430378516ac580167da35cc948be9041aac1
            x-checker-data:
              type: anitya
              project-id: 1774
              stable-only: true
              url-template: https://www.x.org/releases/individual/lib/libXext-$version.tar.gz
        cleanup:
          - '*'
      - name: libxt-static
        build-options: *musl-static-build-options
        config-opts:
          - --disable-shared
          - --disable-specs
        sources:
          - type: archive
            url: https://www.x.org/releases/individual/lib/libXt-1.2.1.tar.gz
            sha256: 6da1bfa9dd0ed87430a5ce95b129485086394df308998ebe34d98e378e3dfb33
            x-checker-data:
              type: anitya
              project-id: 1793
              stable-only: true
              url-template: https://www.x.org/releases/individual/lib/libXt-$version.tar.gz
          - type: shell
            commands:
              - sed -e 's/\(--mode=compile $(CC)\)/\1 -all-static/' -e 's/\(--mode=link
                $(CCLD)\)/\1 -all-static/' -i util/Makefile.in
        cleanup:
          - '*'
        modules:
          - name: libsm-static
            build-options: *musl-static-build-options
            config-opts:
              - --disable-shared
              - --disable-docs
              - --enable-unix-transport # TODO: test if needed for sway/wlroots
              - --disable-tcp-transport
              - --disable-ipv6
              - --enable-local-transport # TODO: test if needed for sway/wlroots
              - --without-libuuid
            sources:
              - type: archive
                url: https://www.x.org/releases/individual/lib/libSM-1.2.3.tar.gz
                sha256: 1e92408417cb6c6c477a8a6104291001a40b3bb56a4a60608fdd9cd2c5a0f320
            x-checker-data:
              type: anitya
              project-id: 1726
              stable-only: true
              url-template: https://www.x.org/releases/individual/lib/libSM-$version.tar.gz
            cleanup:
              - '*'
            modules:
              - name: libice-static
                build-options: *musl-static-build-options
                config-opts:
                  - --disable-shared
                sources:
                  - type: archive
                    url: https://www.x.org/releases/individual/lib/libICE-1.0.10.tar.gz
                    sha256: 1116bc64c772fd127a0d0c0ffa2833479905e3d3d8197740b3abd5f292f22d2d
                x-checker-data:
                  type: anitya
                  project-id: 1638
                  stable-only: true
                  url-template: https://www.x.org/releases/individual/lib/libICE-$version.tar.gz
                cleanup:
                  - '*'

  - name: libxfixes-static # meeded for mesa wlroots
    build-options: *musl-static-build-options
    config-opts:
      - --disable-shared
    sources:
      - type: archive
        url: https://www.x.org/releases/individual/lib/libXfixes-6.0.0.tar.gz
        sha256: 82045da5625350838390c9440598b90d69c882c324ca92f73af9f0e992cb57c7
        x-checker-data:
          type: anitya
          project-id: 1792
          stable-only: true
          url-template: https://www.x.org/releases/individual/lib/libXfixes-$version.tar.gz
    cleanup:
      - '*'

  - name: libxshmfence-static # meeded for mesa wlroots
    build-options: *musl-static-build-options
    config-opts:
      - --disable-shared
    sources:
      - type: archive
        url: https://www.x.org/releases/individual/lib/libxshmfence-1.3.tar.gz
        sha256: 7eb3d46ad91bab444f121d475b11b39273142d090f7e9ac43e6a87f4ff5f902c
        x-checker-data:
          type: anitya
          project-id: 1792
          stable-only: true
          url-template: https://www.x.org/releases/individual/lib/libxshmfence-$version.tar.gz
    cleanup:
      - '*'

  - name: libxxf86vm-static # meeded for mesa
    build-options: *musl-static-build-options
    config-opts:
      - --disable-shared
    sources:
      - type: archive
        url: https://www.x.org/releases/individual/lib/libXxf86vm-1.1.4.tar.gz
        sha256: 5108553c378a25688dcb57dca383664c36e293d60b1505815f67980ba9318a99
        x-checker-data:
          type: anitya
          project-id: 1799
          stable-only: true
          url-template: https://www.x.org/releases/individual/lib/libXxf86vm-$version.tar.gz
    cleanup:
      - '*'

  - name: xorg-xhost-static
    build-options: *musl-static-build-options
    make-args:
      - LIBS+=-lxcb -lXdmcp -lXau
    sources:
      - type: archive
        url: https://www.x.org/releases/individual/app/xhost-1.0.8.tar.gz
        sha256: e5aabce1533dc778ceb5bbc207105cf3770f710629caceaad64675b00c38c3f8
        x-checker-data:
          type: anitya
          project-id: 15021
          stable-only: true
          url-template: https://www.x.org/releases/individual/app/xhost-$version.tar.gz

  - name: mesa-static
   #build-options: *musl-static-build-options
   # TODO: drop module specific build options
    build-options:
      cflags: -static -static-pie -fPIC -I/usr/lib/sdk/devenv/include/libdrm
      cxxflags: -static -static-pie -fPIC
      ldflags: -static -static-pie -fPIC -Wl,-fuse-ld=mold -Wl,-lncursesw,-lXau,-lXdmcp
      env: *musl-toolchain-environment
      prepend-path: /usr/lib/sdk/llvm-musl/bin
      prepend-ld-library-path: /usr/lib/sdk/llvm-musl/lib
    buildsystem: meson
    config-opts:
      # TODO: maybe enable dri3
      - --default-library=static
      - --prefer-static
      - -Dcpp_rtti=false
      - -Dplatforms=x11,wayland
     #- -Degl-native-platform=x11,wayland,surfaceless,drm
      - -Ddri3=disabled
     #- -Ddri-drivers-path=
     #- -Ddri-search-path=
      - -Dgallium-drivers=swrast
      - -Dgallium-extra-hud=false
      - -Dgallium-vdpau=disabled
     #- -Dvdpau-libs-path=
      - -Dgallium-xvmc=disabled
     #- -Dxvmc-libs-path=
      - -Dgallium-omx=disabled
      - -Dgallium-va=disabled
     #- -Dva-libs-path=
      - -Dgallium-xa=disabled
     #- -Dgallium-nine=disabled
     #- -Dgallium-d3d10umd=disabled
     #- -Dgallium-opencl=disabled
     #- -Dopencl-spirv=disabled
      - -Dopencl-native=false
     #- -Dstatic-libclc=
     #- -Dd3d-drivers-path=
      - -Dvulkan-drivers=
     #- -Dfreedreno-kgsl=false
     #- -Dfreedreno-virtio=false
     #- -Dimagination-srv=false
     #- -Dshader-cache=auto
     #- -Dshader-cache-default=true
     #- -Dshader-cache-max-size=
     #- -Dvulkan-icd-dir=
     #- -Dvulkan-layers=
      - -Dshared-glapi=disabled
      - -Dgles1=disabled
      - -Dgles2=enabled
      - -Dopengl=true
      - -Dgbm=enabled
     #- -Dgbm-backends-path=
      - -Dglx=dri
      - -Degl=enabled
      - -Dglvnd=false
      - -Dllvm=disabled
      - -Dshared-llvm=disabled
     #- -Ddraw-use-llvm=true
      - -Dvalgrind=disabled
      - -Dlibunwind=disabled
      - -Dlmsensors=disabled
      - -Dbuild-tests=false
     #- -Dbuild-aco-tests=false
     #- -Dinstall-intel-gpu-tests=false
     #- -Dselinux=false
     #- -Dexecmem=true
      - -Dosmesa=false
     #- -Dosmesa-bits=8
      - -Dtools=
      - -Dxlib-lease=disabled
     #- -Dglx-direct=true
     #- -Degl-lib-suffix
     #- -Dgles-lib-suffix
     #- -Dzstd=auto
     #- -Dzlib=enabled
     #- -Dsse2=true
     #- -Dperfetto=false
     #- -Ddatasources=auto
     #- -Dcustom-shader-replacement=
     #- -Dvulkan-beta=false
     #- -Dintel-clc=disabled
    post-install:
      - rm -f ${FLATPAK_DEST}/lib/dri/kms_swrast_dri.a
      - mv ${FLATPAK_DEST}/lib/libEGL{,-generic}.a
      - mv ${FLATPAK_DEST}/lib/{dri/swrast_dri,libEGL}.a
    sources:
      - type: archive
        url: https://archive.mesa3d.org//mesa-22.1.7.tar.xz
        sha256: da838eb2cf11d0e08d0e9944f6bd4d96987fdc59ea2856f8c70a31a82b355d89
        x-checker-data:
          type: anitya
          project-id: 1970
          stable-only: true
          url-template: https://archive.mesa3d.org//mesa-$version.tar.xz
      - type: patch
        path: mesa-static-libs.patch
    cleanup:
      - '*'
    modules:
      - name: eudev-static
        # TODO: maybe move up
        build-options: *musl-static-build-options
        config-opts:
          - --disable-shared
          - --disable-programs
          - --disable-blkid
          - --disable-selinux
          - --disable-manpages
          - --disable-kmod
          - --disable-mtd_probe
        sources:
          - type: archive
            url: https://github.com/eudev-project/eudev/releases/download/v3.2.11/eudev-3.2.11.tar.gz
            sha256: 19847cafec67897da855fde56f9dc7d92e21c50e450aa79068a7e704ed44558b
            x-checker-data:
              type: anitya
              project-id: 13466
              stable-only: true
              url-template: https://github.com/eudev-project/eudev/releases/download/v$version/eudev-$version.tar.gz
        cleanup:
          - '*'
      - name: libdrm-static
        build-options: *musl-static-build-options
        buildsystem: meson
        config-opts:
          - --default-library=static
          - -Dintel=false
          - -Dradeon=false
          - -Damdgpu=false
          - -Dnouveau=false
          - -Dvmwgfx=false
          - -Domap=false
          - -Dexynos=false
          - -Dfreedreno=false
          - -Dtegra=false
          - -Dvc4=false
          - -Detnaviv=false
          - -Dcairo-tests=false
          - -Dman-pages=false
          - -Dvalgrind=false
          - -Dfreedreno-kgsl=false
          - -Dinstall-test-programs=false
          - -Dudev=false
        sources:
          - type: archive
            url: https://dri.freedesktop.org/libdrm/libdrm-2.4.112.tar.xz
            sha256: 00b07710bd09b35cd8d80eaf4f4497fe27f4becf467a9830f1f5e8324f8420ff
            x-checker-data:
              type: anitya
              project-id: 1596
              stable-only: true
              url-template: https://dri.freedesktop.org/libdrm/libdrm-$version.tar.xz
        cleanup:
          - '*'

  - name: wlroots-static
    # TODO: evaluate need of seatd or polkit
    # TODO: possibly add depends xcb-util-errors xcb-util-wm xorg-xwayland glslang
    build-options: *musl-static-build-options
    buildsystem: meson
    config-opts:
      - --default-library=static
      - --auto-features=disabled
      - --libdir=lib
      - -Dxcb-errors=disabled
      - -Dxwayland=disabled
      - -Dexamples=false
      - -Drenderers=gles2
      - -Dbackends=drm,libinput,x11
     #- -Dallocators=gbm
      - -Dwerror=false
    sources:
      - type: archive
        url: https://gitlab.freedesktop.org/wlroots/wlroots/-/archive/0.15.1/wlroots-0.15.1.tar.gz
        sha256: 5b92f11a52d978919ed1306e0d54c9d59f1762b28d44f0a2da3ef3b351305373
        x-checker-data:
          type: anitya
          project-id: 18357
          stable-only: true
          url-template: https://gitlab.freedesktop.org/wlroots/wlroots/-/archive/$version/wlroots-$version.tar.gz
    cleanup:
      - '*'
    modules:
      - name: seatd-static
        build-options: *musl-static-build-options
        buildsystem: meson
        config-opts:
          - --default-library=static
          - -Dlibseat-logind=disabled
          - -Dlibseat-seatd=enabled
          - -Dlibseat-builtin=disabled
          - -Dserver=disabled
          - -Dexamples=disabled
          - -Dman-pages=disabled
        sources:
          - type: archive
            url: https://git.sr.ht/~kennylevinsen/seatd/archive/0.7.0.tar.gz
            sha256: 210ddf8efa1149cde4dd35908bef8e9e63c2edaa0cdb5435f2e6db277fafff3c
            x-checker-data:
              type: anitya
              project-id: 234932
              stable-only: true
              url-template: https://git.sr.ht/~kennylevinsen/seatd/archive/$version.tar.gz
        cleanup:
          - '*'
      - name: libxkbcommon-static
        build-options: *musl-static-build-options
        buildsystem: meson
        config-opts:
          - --default-library=static
         #- -Dxkb-config-root=
         #- -Dxkb-config-extra-path=
         #- -Dx-locale-root=
         #- -Ddefault-rules=
         #- -Ddefault-model=
         #- -Ddefault-layout=
         #- -Ddefault-variant=
         #- -Ddefault-options=
          - -Denable-tools=false
          # TODO: enable x11
          - -Denable-x11=false
          - -Denable-docs=false
          - -Denable-wayland=true
          - -Denable-xkbregistry=false
        sources:
          - type: archive
            url: https://xkbcommon.org/download/libxkbcommon-1.4.1.tar.xz
            sha256: 943c07a1e2198026d8102b17270a1f406e4d3d6bbc4ae105b9e1b82d7d136b39
            x-checker-data:
              type: anitya
              project-id: 1780
              stable-only: true
              url-template: https://xkbcommon.org/download/libxkbcommon-$version.tar.xz
        cleanup:
          - '*'
      - name: libinput-static
        build-options: *musl-static-build-options
        buildsystem: meson
        config-opts:
          - --default-library=static
          - --libexec=lib
          - -Dlibwacom=false
          - -Ddebug-gui=false
          - -Dtests=false
          - -Ddocumentation=false
          - -Dzshcompletiondir=no
        sources:
          - type: archive
            url: https://gitlab.freedesktop.org/libinput/libinput/-/archive/1.21.0/libinput-1.21.0.tar.gz
            sha256: 1b23c180f5b297303ed36f5a549910f5d320b0eb21052eac67a966d4eaa4e01d
            x-checker-data:
              type: anitya
              project-id: 5781
              stable-only: true
              url-template: https://gitlab.freedesktop.org/libinput/libinput/-/archive/$version/libinput-$version.tar.gz
          - type: shell
            commands:
              - sed -i 's/shared_library/static_library/' meson.build
              - sed -i '/^lib_libinput =/,/^)$/{ /version/d }' meson.build
        cleanup:
          - '*'
        modules:
          - name: libevdev-static
            build-options: *musl-static-build-options
            buildsystem: meson
            config-opts:
              - --default-library=static
              - -Dtests=disabled
              - -Ddocumentation=disabled
            sources:
              - type: archive
                url: https://freedesktop.org/software/libevdev/libevdev-1.12.0.tar.xz
                sha256: 2f729e3480695791f9482e8388bd723402b89f0eaf118057bbdea3cecee9b237
                x-checker-data:
                  type: anitya
                  project-id: 20540
                  stable-only: true
                  url-template: https://freedesktop.org/software/libevdev/libevdev-$version.tar.xz
            cleanup:
              - '*'
          - name: mtdev-static
            build-options: *musl-static-build-options
            config-opts:
              - --disable-shared
            sources:
              - type: archive
                url: https://bitmath.org/code/mtdev/mtdev-1.1.6.tar.bz2
                sha256: 15d7b28da8ac71d8bc8c9287c2045fd174267bc740bec10cfda332dc1204e0e0
                x-checker-data:
                  type: anitya
                  project-id: 8868
                  stable-only: true
                  url-template: https://bitmath.org/code/mtdev/mtdev-$version.tar.bz2
            cleanup:
              - '*'

  - name: sway-static
    # TODO: add setconf?
    #build-options: *musl-static-build-options
    # TODO: avoid in-module  build options
    build-options:
      cflags: -static -static-pie -fPIC
      cxxflags: -static -static-pie -fPIC
      ldflags: -static -static-pie -fPIC -Wl,-fuse-ld=mold -Wl,--allow-multiple-definition -Wl,-lEGL,-lEGL-generic,-lEGL,-lstdc++,-lXau,-lXdmcp,-lGL,-lXext,-lmesa,-lXxf86vm,-lxcb-glx,-lXfixes
      env: *musl-toolchain-environment
    buildsystem: meson
    config-opts:
      - --default-library=static
      - --auto-features=disabled
      - -Dwerror=false
      - -Ddefault-wallpaper=false
      - -Dzsh-completions=false
      - -Dbash-completions=false
      - -Dfish-completions=false
      - -Dswaybar=false
      - -Dswaynag=false
      - -Dxwayland=disabled
      - -Dtray=disabled
      - -Dgdk-pixbuf=enabled
      - -Dman-pages=disabled
      - -Dsd-bus-provider=auto
    sources:
      - type: archive
        url: https://github.com/swaywm/sway/archive/1.7/sway-1.7.tar.gz
        sha256: 0c64536fb2883ec518e75cfb119f9300115fb49b084e3fde62b794fe2c6c8d84
        x-checker-data:
           type: anitya
           project-id: 11497
           stable-only: true
           url-template: https://github.com/swaywm/sway/archive/$version/sway-$version.tar.gz
    modules:
      - name: json-c-static
        build-options: *musl-static-build-options
        buildsystem: cmake
        config-opts:
          - -DCMAKE_BUILD_TYPE=None
          - -DBUILD_SHARED_LIBS=OFF
          - -DBUILD_STATIC_LIBS=ON
          - -DBUILD_TESTING=OFF
          - -DENABLE_THREADING=ON
          - -DENABLE_RDRAND=OFF
        sources:
          - type: archive
            url: https://s3.amazonaws.com/json-c_releases/releases/json-c-0.15.tar.gz
            sha256: b8d80a1ddb718b3ba7492916237bbf86609e9709fb007e7f7d4322f02341a4c6
            x-checker-data:
              type: anitya
              project-id: 1477
              stable-only: true
              url-template: https://s3.amazonaws.com/json-c_releases/releases/json-c-$version.tar.gz
        cleanup:
          - '*'

  - name: cage-static
    #build-options: *musl-static-build-options
    # TODO: avoid in-module  build options
    build-options:
      cflags: -static -static-pie -fPIC
      cxxflags: -static -static-pie -fPIC
      ldflags: -static -static-pie -fPIC -Wl,-fuse-ld=mold -Wl,--allow-multiple-definition -Wl,-lEGL,-lEGL-generic,-lEGL,-lstdc++,-lXau,-lXdmcp,-lGL,-lXext,-lmesa,-lXxf86vm,-lxcb-glx,-lXfixes
      env: *musl-toolchain-environment
    buildsystem: meson
    config-opts:
      - --default-library=static
      - -Dman-pages=disabled
      - -Dxwayland=false
    sources:
      - type: archive
        url: https://github.com/Hjdskes/cage/archive/a81ab701d73d0f43c9bb9747e5fdf3c5e226139c/cage-a81ab701d73d0f43c9bb9747e5fdf3c5e226139c.tar.gz
        sha256: 1e5340f2b8ed283f3c4dd9e1cf9a7402b6b7fb4472ddcdb2de1147315e0fcf19
        x-checker-data:
           type: anitya
           project-id: 21171
           stable-only: true
           version:
             '>': 0.1.4
           url-template: https://github.com/Hjdskes/cage/releases/download/v$version/cage-$version.tar.gz
    modules:
      - name: scdoc
        no-autogen: true
        make-args:
          - PREFIX=${FLATPAK_DEST}
        make-install-args:
          - PREFIX=${FLATPAK_DEST}
          - PCDIR=${PREFIX}/lib/pkgconfig
        sources:
          - type: archive
            url: https://git.sr.ht/~sircmpwn/scdoc/archive/1.11.2.tar.gz
            sha256: e9ff9981b5854301789a6778ee64ef1f6d1e5f4829a9dd3e58a9a63eacc2e6f0
            x-checker-data:
              type: anitya
              project-id: 68662
              stable-only: true
              url-template: https://git.sr.ht/~sircmpwn/scdoc/archive/$version.tar.gz
        cleanup:
          - '*'


  ############################
  #### Packaging: Python  ####
  ############################

  - name: python
    # TODO: build missing modules
   #build-options: *musl-shared-build-options
    build-options:
      # TODO: maybe set rpath for shared libs
      cflags: -fPIC -Bstatic -Wl,--dynamic-linker=/usr/lib/sdk/devenv/lib/libc.musl-x86_64.so.1
      cxxflags: -fPIC -Bstatic -Wl,--dynamic-linker=/usr/lib/sdk/devenv/lib/libc.musl-x86_64.so.1
      # TODO: try getting mold to work
     #ldflags: -fPIC -Bstatic -Wl,--dynamic-linker=/usr/lib/sdk/devenv/lib/libc.musl-x86_64.so.1 -Wl,-fuse-ld=mold
      ldflags: -fPIC -Bstatic -Wl,--dynamic-linker=/usr/lib/sdk/devenv/lib/libc.musl-x86_64.so.1
      prefix: /usr/lib/sdk/devenv/python
      libdir: /usr/lib/sdk/devenv/python/lib
      prepend-path: /usr/lib/sdk/devenv/python/bin
      prepend-ld-library-path: /usr/lib/sdk/devenv/python/lib
      env:
        - AR=x86_64-linux-musl-ar
        - CC=x86_64-linux-musl-gcc
        - CXX=x86_64-linux-musl-g++
        - LD=x86_64-linux-musl-ld.mold
    config-opts:
      # TODO: disable shared libpython after adding required modules
      - --enable-shared
      - --with-static-libpython
     #- --enable-optimizations
     #- --with-computed-gotos
     #- --with-lto
      - --disable-test-modules
      - --without-doc-strings
      - --with-dbmliborder=gdbm:ndbm
      - --with-system-expat
      - --with-system-ffi
      # TODO: add libmpdec lib?
     #- --with-system-libmpdec
      - CPPFLAGS=-I/usr/lib/sdk/devenv/include -I/usr/lib/sdk/devenv/include/ncursesw
   #make-args:
   #  - LINKFORSHARED=
    sources:
      - type: archive
        url: https://www.python.org/ftp/python/3.10.6/Python-3.10.6.tar.xz
        sha256: f795ff87d11d4b0c7c33bc8851b0c28648d8a4583aa2100a98c22b4326b6d3f3
        x-checker-data:
          type: anitya
          project-id: 13254
          stable-only: true
          url-template: https://www.python.org/ftp/python/$version/Python-$version.tar.xz
     #- type: file
     #  dest: Modules
     #  dest-filename: Setup.local
     #  path: python-modules
      - type: shell
        commands:
          - sed 's|/usr/include|${prefix}/include|' -i configure
          - rm -r Modules/expat
          - rm -r Modules/_ctypes/{darwin,libffi}*
         #- rm -r Modules/_decimal/libmpdec
          - sed -i '/ndbm_libs =/ s/\('\''gdbm_compat'\''\)/\1, '\''gdbm'\''/' setup.py
    cleanup:
      - '*'

  - name: python-wheel
    build-options: *musl-shared-build-options
    buildsystem: simple
    build-commands: *python-pip-build-commands
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/27/d6/003e593296a85fd6ed616ed962795b2f87709c3eee2bca4f6d0fe55c6d00/wheel-0.37.1-py2.py3-none-any.whl
        sha256: 4bdcd7d840138086126cd09254dc6195fb4fc6f01c050a1d7236f2630db1d22a
        x-checker-data:
          type: pypi
          name: wheel
          packagetype: bdist_wheel
    cleanup:
      - '*'

  - name: pyinstaller
    build-options: *musl-shared-build-options
    buildsystem: simple
    build-commands: *python-setup-build-commands
    sources:
      - type: archive
        url: https://github.com/pyinstaller/pyinstaller/archive/v5.3/pyinstaller-5.3.tar.gz
        sha256: 5e137cf1f46fc009dc1d31037722f56552754264b2a93b7d5de192c8b0a3731a
        x-checker-data:
          type: anitya
          project-id: 122995
          stable-only: true
          url-template: https://github.com/pyinstaller/pyinstaller/archive/v$version/pyinstaller-$version.tar.gz
      - type: shell
        commands:
          - ln -s ${FLATPAK_DEST}/lib/libc.musl-x86_64.so.1 ${FLATPAK_DEST}/python/bin/ldd
    cleanup:
      - '*'

  - name: pyinstaller-hooks-contrib
    buildsystem: simple
    build-commands: *python-setup-build-commands
    sources:
      - type: archive
        url: https://github.com/pyinstaller/pyinstaller-hooks-contrib/archive/2022.10/pyinstaller-hooks-contrib-2022.10.tar.gz
        sha256: 5a4d665e3fb0df656b6f0af88427f5bdd4ed9bb6e4d2490d00637c1f809b8339
        x-checker-data:
          type: anitya
          project-id: 91839
          stable-only: true
          url-template: https://github.com/pyinstaller/pyinstaller-hooks-contrib/archive/$version/pyinstaller-hooks-contrib-$version.tar.gz
    cleanup:
      - '*'

  - name: altgraph
    buildsystem: simple
    build-commands: *python-pip-build-commands
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/84/3f/1a5c9bef54cac9bf41edd6f4aaf61cd52ed578e10ccc607e0278012cb4a5/altgraph-0.17.2-py2.py3-none-any.whl
        sha256: 743628f2ac6a7c26f5d9223c91ed8ecbba535f506f4b6f558885a8a56a105857
        x-checker-data:
          type: pypi
          name: altgraph
          packagetype: bdist_wheel
    cleanup:
      - '*'

# - name: pyoxidizer
#   buildsystem: simple
#   build-commands:
#     - install -Dm755 pyoxidizer ${FLATPAK_DEST}/bin/
#   sources:
#     - type: archive
#       url: https://github.com/indygreg/PyOxidizer/releases/download/pyoxidizer%2F0.22.0/pyoxidizer-0.22.0-x86_64-unknown-linux-musl.tar.gz
#       sha256: be8fb5d28a3b2405ed672b711199f6dad41b1293551a9023866b2f082e6decc6
#       x-checker-data:
#         type: anitya
#         project-id: 198997
#         stable-only: true
#         url-template: https://github.com/indygreg/PyOxidizer/releases/download/pyoxidizer%2F0.22.0/pyoxidizer-${version}-x86_64-unknown-linux-musl.tar.gz


  ############################
  ####  Packaging: Tools  ####
  ############################

# - name: go-md2man-static
#   # TODO: enable this after packaging is modernized and stops using GO111MODULE
#   build-options:
#    #build-args:
#    #  - --share=network
#     env:
#       - CGO_ENABLED=0
#   buildsystem: simple
#  #build-commands: *golang-online-build-commands
#   build-commands: *golang-offline-build-commands
#   post-install:
#     - mv ${FLATPAK_DEST}/bin/go-md2man{-static,}
#   sources:
#     - type: archive
#       url: https://github.com/cpuguy83/go-md2man/archive/v2.0.2/go-md2man-2.0.2.tar.gz
#       sha256: 2f52e37101ea2734b02f2b54a53c74305b95b3a9a27792fdac962b5354aa3e4a
#       x-checker-data:
#         type: anitya
#         project-id: 14461
#         stable-only: true
#         url-template: https://github.com/cpuguy83/go-md2man/archive/v$version/go-md2man-$version.tar.gz
#     - go-md2man-go-sources.json # OFFLINE-BUILD, flatpak-go-get-generator.py -o go-md2man-go-sources.json ./

  - name: md2roff-static
    build-options: *musl-static-build-options
    no-autogen: true
    make-install-args:
      - prefix=${FLATPAK_DEST}
    sources:
      - type: archive
        url: https://github.com/nereusx/md2roff/archive/55a4828ad53df974740412099dc9005c54fa18a0/md2roff-55a4828ad53df974740412099dc9005c54fa18a0.tar.gz
        sha256: 30c61087b647482a651408f94234242ebb89e415725b79d9cc7e5ff1ecc05433
        x-checker-data:
          type: json
          url: https://api.github.com/repos/nereusx/md2roff/commits?sha=master&per_page=1
          version-query: .[].sha
          timestamp-query: .[].commit.committer.date
          url-query: '"https://github.com/nereusx/md2roff/archive/" + $version + "/md2roff-"
            + $version + ".tar.gz"'


  ############################
  ####       Archive      ####
  ############################

  - name: cabextract-static
    build-options: *musl-static-build-options
    sources:
      - type: archive
        url: https://cabextract.org.uk/cabextract-1.9.1.tar.gz
        sha256: afc253673c8ef316b4d5c29cc4aa8445844bee14afffbe092ee9469405851ca7
        x-checker-data:
          type: anitya
          project-id: 245
          stable-only: true
          url-template: https://cabextract.org.uk/cabextract-$version.tar.gz

  - name: rpmextract
    buildsystem: simple
    build-commands:
      - install -Dm755 rpm2cpio rpmextract.sh -t ${FLATPAK_DEST}/bin/
    sources:
      - type: file
        url: https://github.com/archlinux/svntogit-packages/raw/packages/rpmextract/trunk/rpm2cpio
        dest-filename: rpm2cpio
        sha256: 5b9133774a969e9b2c4b18c77b340ed1e591e13ba1336fd4a4c15a96ad436dee
      - type: file
        url: https://github.com/archlinux/svntogit-packages/raw/packages/rpmextract/trunk/rpmextract.sh
        dest-filename: rpmextract.sh
        sha256: f319f14d27b909bd891adde4ccb4a8e910e15f9f4977b3e9bf78fbf7f2444866

  - name: p7zip-static
    build-options: *musl-static-build-options
    no-autogen: true
    make-args:
     # TODO: build 7z with shared musl libc, missing 7z also breaks auto-loading fish completion
     #- 7z
      - 7zr
      - 7za
      - OPTFLAGS:=${CFLAGS}
    make-install-args:
      - DEST_DIR=/
      - DEST_HOME=${FLATPAK_DEST}
      - DEST_MAN=${FLATPAK_DEST}/share/man
    sources:
      - type: archive
        url: https://github.com/jinfeihan57/p7zip/archive/eb1bbb0d0327a103850fec519015986e72a1ebf0.tar.gz
        sha256: cecdaa7e2738ad4594ddddb0c568db1750b7a7ff8433961be8595033d444e3a7
        x-checker-data:
          type: anitya
          project-id: 2583
          stable-only: true
          versions:
            '>': '17.04'
          url-template: https://github.com/jinfeihan57/p7zip/archive/v$version/p7zip-$version.tar.gz
      - type: shell
        commands:
          - sed -i '/^CC/d;/^CXX/d;/^CC_SHARED/d;/^LINK_SHARED/d' makefile.machine

  - name: unrar-static
    build-options: *musl-static-build-options
    no-autogen: true
    make-args:
      - -j1
    sources:
      - type: archive
        url: https://www.rarlab.com/rar/unrarsrc-6.1.7.tar.gz
        sha256: de75b6136958173fdfc530d38a0145b72342cf0d3842bf7bb120d336602d88ed
        x-checker-data:
          type: anitya
          project-id: 13306
          stable-only: true
          url-template: https://www.rarlab.com/rar/unrarsrc-$version.tar.gz
      - type: shell
        commands:
          - sed -i '/^CXX=/d;/^CXXFLAGS=/d;/^LDFLAGS=/d' makefile
          - sed -i 's/\($(LDFLAGS)\)/\1 -pthread/' makefile
          - sed -i '/libunrar\.so/d' makefile
          - sed -i 's/\(^DESTDIR\)=.*/\1=${FLATPAK_DEST}/' makefile

  - name: upx-static
    build-options: *musl-static-build-options
    no-autogen: true
    no-make-install: true
    make-args:
      - all
      - CHECK_WHITESPACE=/usr/bin/true
      - UPX_LZMA_VERSION=0x465
      - UPX_LZMADIR=/run/build/upx
      - CXXFLAGS_WERROR=-Wno-error=all
    build-commands:
      - install -Dm755 src/upx.out ${FLATPAK_DEST}/bin/upx
      - install -Dm644 doc/upx.1 -t ${FLATPAK_DEST}/share/man/man1/
    sources:
      - type: archive
        url: https://github.com/upx/upx/releases/download/v3.96/upx-3.96-src.tar.xz
        sha256: 47774df5c958f2868ef550fb258b97c73272cb1f44fe776b798e393465993714
        x-checker-data:
          type: anitya
          project-id: 13737
          stable-only: true
          url-template: https://github.com/upx/upx/releases/download/v$version/upx-$version-src.tar.xz
    modules:
      - name: ucl-static
        build-options: *musl-static-build-options
        config-opts:
          - --disable-shared
        make-args:
          - CFLAGS+=-std=gnu90
        sources:
          - type: archive
            url: https://www.oberhumer.com/opensource/ucl/download/ucl-1.03.tar.gz
            sha256: b865299ffd45d73412293369c9754b07637680e5c826915f097577cd27350348
            x-checker-data:
              type: anitya
              project-id: 13446
              stable-only: true
              url-template: https://www.oberhumer.com/opensource/ucl/download/ucl-$version.tar.gz
          - type: shell
            commands:
              - sed -i '/^ac_compile=/ s/\($CFLAGS\)/\1 -std=gnu90/' configure
              - sed -i '/^ac_link=/ s/\($CFLAGS\)/\1 -std=gnu90/' configure
        cleanup:
          - '*'


  ############################
  ####       Binary       ####
  ############################

  - name: bbe-static
    build-options: *musl-static-build-options
    sources:
      - type: archive
        url: http://downloads.sourceforge.net/bbe-/bbe-0.2.2.tar.gz
        sha256: baaeaf5775a6d9bceb594ea100c8f45a677a0a7d07529fa573ba0842226edddb
        x-checker-data:
          type: anitya
          project-id: 14915
          stable-only: true
          url-template: http://downloads.sourceforge.net/bbe-/bbe-$version.tar.gz

  - name: fq-static-bin
    buildsystem: simple
    build-commands:
      - install -Dm755 fq -t ${FLATPAK_DEST}/bin/
    sources:
      - type: archive
        strip-components: 0
        url: https://github.com/wader/fq/releases/download/v0.0.8/fq_0.0.8_linux_amd64.tar.gz
        sha256: ecfcde8f1b0f0d41c2b0237c4d3cd81c64fdac71cf16a299ad83d6aeb447cd15
        x-checker-data:
          type: anitya
          project-id: 279636
          stable-only: true
          url-template: https://github.com/wader/fq/releases/download/v0.0.8/fq_${version}_linux_amd64.tar.gz

  - name: hexer-static
    build-options: *musl-static-build-options
    no-autogen: true
    make-args:
      - LTERMCAP=-lncurses
      - myc
    sources:
      - type: archive
        url: https://gitlab.com/hexer/hexer/-/archive/release/1.0.6/hexer-release-1.0.6.tar.gz
        sha256: 989d04fa7eab489dc91880f64e1b9691b5e19429dc42151106b4f6969343df5d
        x-checker-data:
          type: anitya
          project-id: 10932
          stable-only: true
          url-template: https://gitlab.com/hexer/hexer/-/archive/release/$version/hexer-release-$version.tar.gz
      - type: shell
        commands:
          - sed -e '/^CPPFLAGS / s#$# -I${PREFIX}/include/ncursesw#' -e '/^PREFIX
            / s#/.*#${FLATPAK_DEST}#' -e '/^MANDIR / s#/man/#/share/man/#' -i Makefile

  - name: hexyl-static-bin
    buildsystem: simple
    build-commands:
      - install -Dm755 hexyl -t ${FLATPAK_DEST}/bin/
      - install -Dm644 hexyl.1 -t ${FLATPAK_DEST}/share/man/man1/
    sources:
      - type: archive
        url: https://github.com/sharkdp/hexyl/releases/download/v0.10.0/hexyl-v0.10.0-x86_64-unknown-linux-musl.tar.gz
        sha256: cd932438e955b6ce721b984c948a1d7d61462714f5f01f97d2df93317b63f1a8
        x-checker-data:
          type: anitya
          project-id: 18593
          stable-only: true
          url-template: https://github.com/sharkdp/hexyl/releases/download/v$version/hexyl-v$version-x86_64-unknown-linux-musl.tar.gz

  - name: patchelf-static
    build-options: *musl-static-build-options
    sources:
      - type: archive
        url: https://github.com/NixOS/patchelf/archive/0.15.0.tar.gz
        sha256: 5d1eda9bad4439bb9c0a87fcba198d7c0d372f361e77de41d68d6308062e5000
        x-checker-data:
          type: anitya
          project-id: 2598
          stable-only: true
          url-template: https://github.com/NixOS/patchelf/archive/$version.tar.gz

  - name: xdelta3-static
    build-options: *musl-static-build-options
    subdir: xdelta3
    sources:
      - type: archive
        url: https://github.com/jmacd/xdelta/archive/v3.1.0/xdelta-3.1.0.tar.gz
        sha256: 7515cf5378fca287a57f4e2fee1094aabc79569cfe60d91e06021a8fd7bae29d
        x-checker-data:
          type: anitya
          project-id: 5177
          stable-only: true
          url-template: https://github.com/jmacd/xdelta/archive/v$version/xdelta-$version.tar.gz
      - type: script
        dest: xdelta3
        dest-filename: autogen.sh
        commands:
          - autoreconf -fiv
          - sed -i 's/\(\$(CCLD)\)/\1 -all-static/' Makefile.in
    modules:
      - name: ncompress-static
        build-options: *musl-static-build-options
        no-autogen: true
        no-make-install: true
        build-commands:
          - install -Dm755 compress -t ${FLATPAK_DEST}/bin/
          - ln -s compress ${FLATPAK_DEST}/bin/uncompress.real
          - install -Dm644 {,un}compress.1 -t ${FLATPAK_DEST}/share/man/man1/
        sources:
          - type: archive
            url: https://github.com/vapier/ncompress/archive/v5.0/ncompress-5.0.tar.gz
            sha256: 96ec931d06ab827fccad377839bfb91955274568392ddecf809e443443aead46
            x-checker-data:
              type: anitya
              project-id: 2056
              stable-only: true
              url-template: https://github.com/vapier/ncompress/archive/v$version/ncompress-$version.tar.gz


  ############################
  ####     Clipboard      ####
  ############################

  - name: wl-clipboard-static
    build-options: *musl-static-build-options
    buildsystem: meson
    config-opts:
      - -Dfishcompletiondir=no
      - -Dzshcompletiondir=no
    cleanup:
      - /share/bash-completion
      - /share/zsh
    sources:
      - type: archive
        url: https://github.com/bugaevc/wl-clipboard/archive/v2.1.0/wl-clipboard-2.1.0.tar.gz
        sha256: 72dab9a7d3835c76d6ff2089f15ffec9e064a321e5f3cbbe961a8fa81aff5573
        x-checker-data:
          type: anitya
          project-id: 49082
          stable-only: true
          url-template: https://github.com/bugaevc/wl-clipboard/archive/v$version/wl-clipboard-$version.tar.gz

  - name: xclip-static
    # TODO: use globally set build options
   #build-options: *musl-static-build-options
    build-options:
      cflags: -static
      cxxflags: -static
      ldflags: -static
      env:
        - CC=x86_64-linux-musl-gcc
        - CXX=x86_64-linux-musl-g++
        - LIBS=-lX11 -lxcb -lX11-xcb -lXau -lxcb-xinput -lxcb-xkb -lXdmcp -lXext -lXmu
          -lXmuu -lXt -lSM -lICE
    sources:
      - type: archive
        url: https://github.com/astrand/xclip/archive/0.13/xclip-0.13.tar.gz
        sha256: ca5b8804e3c910a66423a882d79bf3c9450b875ac8528791fb60ec9de667f758
        x-checker-data:
          type: anitya
          project-id: 14150
          stable-only: true
          url-template: https://github.com/astrand/xclip/archive/$version/xclip-$version.tar.gz
    cleanup:
      - /bin/xclip-*file
# - name: xsel-static
#  #build-options: *musl-static-build-options
#   build-options:
#     cflags: -static
#     cxxflags: -static
#     ldflags: -static
#     env:
#       - CC=x86_64-linux-musl-gcc
#       - CXX=x86_64-linux-musl-g++
#       - LIBS=-lX11 -lxcb -lX11-xcb -lXau -lxcb-xinput -lxcb-xkb -lXdmcp -lXext -lXmu -lXmuu -lXt
#   sources:
#     - type: archive
#       url: https://github.com/kfish/xsel/archive/9fc4e3e4e3f1231cabfdc2e1438155f9390bc517/xsel-9fc4e3e4e3f1231cabfdc2e1438155f9390bc517.tar.gz
#       sha256: 6269fa7b58f157bd5796b1ce82797922fe62495a61b95f565c48708a12030443
#      #x-checker-data:
#      #  type: anitya
#      #  project-id:
#      #  stable-only: true
#      #  url-template:


  ############################
  ####    Code: Debug     ####
  ############################

  - name: lurk-static-bin
    buildsystem: simple
    build-commands:
      - install -Dm755 lurk -t ${FLATPAK_DEST}/bin/
    sources:
      - type: archive
        strip-components: 0
        url: https://github.com/JakWai01/lurk/releases/download/v0.2.9/lurk-x86_64-unknown-linux-gnu.tar.gz
        sha256: 78ce184f6c6ebbfe7a07271adbf2e28e5aeeff730844d148933a1836f744ba69
        x-checker-data:
          type: anitya
          project-id: 270853
          stable-only: true
          url-template: https://github.com/JakWai01/lurk/releases/download/v$version/lurk-x86_64-unknown-linux-gnu.tar.gz


  ############################
  ####   Code: Editors    ####
  ############################

  - name: helix-shared-bin
    buildsystem: simple
    build-commands:
      - install -Dm755 hx -t ${FLATPAK_DEST}/bin/
      - install -Dm644 contrib/completion/hx.bash ${FLATPAK_DEST}/share/bash-completion/completions/hx
      - install -Dm644 contrib/completion/hx.fish ${FLATPAK_DEST}/share/fish/vendor_completions.d/hx.fish
      - install -Dm644 contrib/completion/hx.zsh ${FLATPAK_DEST}/share/zsh/site-functions/_hex
      - install -dm755 ${FLATPAK_DEST}/share/helix
      - cp -r runtime ${FLATPAK_DEST}/share/helix/
    sources:
      - type: archive
        url: https://github.com/helix-editor/helix/releases/download/22.08.1/helix-22.08.1-x86_64-linux.tar.xz
        sha256: d587b3ca727d531146a441e5dfd6eff35592966ea3eddcef6aaf6bb5879a1b36
        x-checker-data:
          type: anitya
          project-id: 219661
          stable-only: true
          url-template: https://github.com/helix-editor/helix/releases/download/$version/helix-$version-x86_64-linux.tar.xz

  - name: kakoune-static
    build-options: *musl-static-build-options
    no-autogen: true
    make-install-args:
      - PREFIX=${FLATPAK_DEST}
      - libexecdir=${FLATPAK_DEST}/lib/kak
    sources:
      - type: archive
        url: https://github.com/mawww/kakoune/releases/download/v2021.11.08/kakoune-2021.11.08.tar.bz2
        sha256: aa30889d9da11331a243a8f40fe4f6a8619321b19217debac8f565e06eddb5f4
        x-checker-data:
          type: anitya
          project-id: 17726
          stable-only: true
          url-template: https://github.com/mawww/kakoune/releases/download/v$version/kakoune-$version.tar.bz2
      - type: patch
        path: kakoune-gcc12_2-stop-using-std_iterator.patch
      - type: patch
        path: kakoune-gcc12_2-validate-alpha-constexpr-function.patch
    modules:
      - name: kak-lsp-static-bin
        buildsystem: simple
        build-commands:
          - install -Dm755 kak-lsp -t ${FLATPAK_DEST}/bin/
          - install -Dm644 kak-lsp.toml -t ${FLATPAK_DEST}/share/kak-lsp/examples/
          - install -Dm644 rc/lsp.kak -t ${FLATPAK_DEST}/share/kak-lsp/rc/
        sources:
          - type: archive
            url: https://github.com/kak-lsp/kak-lsp/archive/v14.0.0/kak-lsp-14.0.0.tar.gz
            sha256: bd46846df0e9c587a9ea3deb1d976f4fc6ddd741061b2bdea4c1fb032e429901
            x-checker-data:
              type: anitya
              project-id: 267541
              stable-only: true
              url-template: https://github.com/kak-lsp/kak-lsp/archive/v$version/kak-lsp-$version.tar.gz
          - type: archive
            strip-components: 0
            url: https://github.com/kak-lsp/kak-lsp/releases/download/v14.0.0/kak-lsp-v14.0.0-x86_64-unknown-linux-musl.tar.gz
            sha256: 26035054d87eae4cc9989e72ff4e9dfaada0bd0308bd86caa02cb1fe5661bcb9
            x-checker-data:
              type: anitya
              project-id: 267541
              stable-only: true
              url-template: https://github.com/kak-lsp/kak-lsp/releases/download/v$version/kak-lsp-v$version-x86_64-unknown-linux-musl.tar.gz

  - name: micro-static-bin
    buildsystem: simple
    build-commands:
      - install -Dm755 micro -t ${FLATPAK_DEST}/bin/
      - install -Dm644 micro.1 -t ${FLATPAK_DEST}/share/man/man1/
    sources:
      - type: archive
        url: https://github.com/zyedidia/micro/releases/download/v2.0.11/micro-2.0.11-linux64-static.tar.gz
        sha256: e599c447289b1a44a20e8b5666b8fc58aeed8680f096bded27603a387267d55f
        x-checker-data:
          type: anitya
          project-id: 19017
          stable-only: true
          url-template: https://github.com/zyedidia/micro/releases/download/v$version/micro-$version-linux64-static.tar.gz

  - name: neovide-shared-bin
    buildsystem: simple
    build-commands:
      - install -Dm755 neovide -t ${FLATPAK_DEST}/bin/
    sources:
      - type: archive
        strip-components: 0
        url: https://github.com/neovide/neovide/releases/download/0.10.1/neovide.tar.gz
        sha256: 5c61630272bff0980c778613344fad5c50aa2c628c1cfb8a899df07fb4e6df7c
        x-checker-data:
          type: anitya
          project-id: 270207
          stable-only: true
          url-template: https://github.com/neovide/neovide/releases/download/$version/neovide.tar.gz

  - name: neovim-static
    # TODO: add python-pynvim in venv after keeping python packaged
    build-options: *musl-static-build-options
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      # wrong detection of msgpack set this to /usr/include
      - -DMSGPACK_INCLUDE_DIRS=/usr/lib/sdk/devenv/include
      - -DENABLE_LIBINTL=OFF
      - -DENABLE_LIBICONV=OFF
    buildsystem: cmake-ninja
    builddir: true
    cleanup:
      - /share/applications
      - /share/icons
      - /share/pixmaps
    sources:
      - type: archive
        url: https://github.com/neovim/neovim/archive/v0.7.2/neovim-0.7.2.tar.gz
        sha256: ccab8ca02a0c292de9ea14b39f84f90b635a69282de38a6b4ccc8565bc65d096
        x-checker-data:
          type: anitya
          project-id: 9037
          stable-only: true
          url-template: https://github.com/neovim/neovim/archive/v$version/neovim-$version.tar.gz
      - type: shell
        commands:
          # detection of runtime libs adds -I/usr/include before toolchain headers
          - sed -i '/^include_directories.*config/i include_directories("/usr/lib/sdk/musl/x86_64-linux-musl/include")'
            CMakeLists.txt
    modules:
      - name: libluv-static
        # TODO: move this to libraries section, common dependency with bind
        build-options: *musl-static-build-options
        buildsystem: cmake-ninja
        config-opts:
          - -DBUILD_MODULE=OFF
          - -DBUILD_STATIC_LIBS=ON
          - -DLUA_BUILD_TYPE=System
        sources:
          - type: archive
            url: https://github.com/luvit/luv/releases/download/1.44.2-0/luv-1.44.2-0.tar.gz
            sha256: 30639f8e0fac7fb0c3a04b94a00f73c6d218c15765347ceb0998a6b72464b6cf
            x-checker-data:
              type: anitya
              project-id: 21510
              stable-only: true
              url-template: https://github.com/luvit/luv/releases/download/$version/luv-$version.tar.gz
        modules:
          - name: libuv-static
            # TODO: evaluate adding libnsl dependency
            build-options: *musl-static-build-options
            config-opts:
              - --disable-shared
            sources:
              - type: archive
                url: https://github.com/libuv/libuv/archive/v1.44.2/libuv-1.44.2.tar.gz
                sha256: e6e2ba8b4c349a4182a33370bb9be5e23c51b32efb9b9e209d0e8556b73a48da
                x-checker-data:
                  type: anitya
                  project-id: 10784
                  stable-only: true
                  url-template: https://github.com/libuv/libuv/archive/v$version/libuv-$version.tar.gz
          - name: luajit
            build-options: *musl-shared-build-options
            no-autogen: true
            make-args:
              - PREFIX=${FLATPAK_DEST}
              - HOST_XCFLAGS=-static -I.
            make-install-args:
              - PREFIX=${FLATPAK_DEST}
            post-install:
              - ln -s luajit-2.1.0-beta3 ${FLATPAK_DEST}/bin/luajit
              - rm ${FLATPAK_DEST}/lib/libluajit-*.so*
            sources:
              - type: archive
                url: https://luajit.org/download/LuaJIT-2.1.0-beta3.tar.gz
                sha256: 1ad2e34b111c802f9d0cdf019e986909123237a28c746b21295b63c9e785d9c3
                x-checker-data:
                  type: anitya
                  project-id: 6444
                  stable-only: true
                  versions:
                    '>': 2.0.5
                  url-template: https://luajit.org/download/LuaJIT-$version.tar.gz
              - type: shell
                commands:
                  - sed -e '/^CC=/d' -i src/Makefile
            cleanup:
              - /bin
      - name: libtermkey-static
        build-options: *musl-static-build-options
        no-autogen: true
        make-install-args:
          - PREFIX=${FLATPAK_DEST}
        sources:
          - type: archive
            url: http://www.leonerd.org.uk/code/libtermkey/libtermkey-0.22.tar.gz
            sha256: 6945bd3c4aaa83da83d80a045c5563da4edd7d0374c62c0d35aec09eb3014600
            x-checker-data:
              type: anitya
              project-id: 230179
              stable-only: true
              url-template: http://www.leonerd.org.uk/code/libtermkey/libtermkey-$version.tar.gz
          - type: shell
            commands:
              - sed -e '/$(LIBTOOL)/ s/\($(CC)\)/\1 $(CFLAGS)/' -e '/^all:/ s/$(DEMOS)//'
                -i Makefile
        modules:
          - name: unibilium-static
            build-options: *musl-static-build-options
            no-autogen: true
            make-install-args:
              - PREFIX=${FLATPAK_DEST}
            sources:
              - type: archive
                url: https://github.com/neovim/unibilium/archive/v2.1.1/unibilium-2.1.1.tar.gz
                sha256: 6f0ee21c8605340cfbb458cbd195b4d074e6d16dd0c0e12f2627ca773f3cabf1
                x-checker-data:
                  type: anitya
                  project-id: 11136
                  stable-only: true
                  url-template: https://github.com/neovim/unibilium/archive/v$version/unibilium-$version.tar.gz
      - name: lua-lpeg
        build-options: *musl-shared-build-options
        no-autogen: true
        no-make-install: true
        make-args:
          - LUADIR=${FLATPAK_DEST}/include/luajit-2.1/
        post-install:
          - install -Dm755 lpeg.so -t ${FLATPAK_DEST}/lib/lua/5.1/
          - install -Dm644 re.lua -t ${FLATPAK_DEST}/share/lua/5.1/
        sources:
          - type: archive
            url: http://www.inf.puc-rio.br/~roberto/lpeg/lpeg-1.0.2.tar.gz
            sha256: 48d66576051b6c78388faad09b70493093264588fcd0f258ddaab1cdd4a15ffe
            x-checker-data:
              type: anitya
              project-id: 1852
              stable-only: true
              url-template: http://www.inf.puc-rio.br/~roberto/lpeg/lpeg-$version.tar.gz
          - type: shell
            commands:
              - sed -i '/^CC/d' makefile
        cleanup:
          - '*'
      - name: lua-mpack
        build-options: *musl-shared-build-options
        no-autogen: true
        make-args:
          - USE_SYSTEM_MPACK=yes
          - LUA_INCLUDE=-I${FLATPAK_DEST}/include/luajit-2.1/
        make-install-args:
          - USE_SYSTEM_MPACK=yes
        sources:
          - type: archive
            url: https://github.com/libmpack/libmpack-lua/archive/1.0.9/libmpack-lua-1.0.9.tar.gz
            sha256: e94d5cf95d7479dca00ff23755fe05a440f11f9d203635e862ad8842de95f40a
            x-checker-data:
              type: anitya
              project-id: 12613
              stable-only: true
              url-template: https://github.com/libmpack/libmpack-lua/archive/$version/libmpack-lua-$version.tar.gz
          - type: shell
            commands:
              - sed -i 's|/usr/lib|'${FLATPAK_DEST}'/lib|' Makefile
             #- sed -i 's|-shared|-static|' Makefile
              - sed -i 's|\($(LIBS)\)$|\1 -nostartfiles -lluajit-5.1 -lc|' Makefile
        cleanup:
          - '*'
        modules:
          - name: mpack-static
            build-options: *musl-static-build-options
            no-autogen: true
            make-install-args:
              - PREFIX=${FLATPAK_DEST}
            sources:
              - type: archive
                url: https://github.com/libmpack/libmpack/archive/1.0.5/libmpack-1.0.5.tar.gz
                sha256: 4ce91395d81ccea97d3ad4cb962f8540d166e59d3e2ddce8a22979b49f108956
                x-checker-data:
                  type: anitya
                  project-id: 12423
                  stable-only: true
                  url-template: https://github.com/libmpack/libmpack/archive/$version/libmpack-$version.tar.gz
              - type: shell
                commands:
                  - mkdir -p build/debug/{src,test{,/deps/tap}}
            cleanup:
              - '*'
      - name: libvterm-static
        build-options: *musl-static-build-options
        no-autogen: true
        make-install-args:
          - PREFIX=${FLATPAK_DEST}
        sources:
          - type: archive
            url: https://www.leonerd.org.uk/code/libvterm/libvterm-0.1.4.tar.gz
            sha256: bc70349e95559c667672fc8c55b9527d9db9ada0fb80a3beda533418d782d3dd
            x-checker-data:
              type: anitya
              project-id: 267537
              stable-only: true
              url-template: https://www.leonerd.org.uk/code/libvterm/libvterm-$version.tar.gz
              versions:
                <: '0.2'
        cleanup:
          - /bin
      - name: msgpack-c-static
        build-options: *musl-static-build-options
        buildsystem: cmake-ninja
        config-opts:
          - -DMSGPACK_ENABLE_STATIC=ON
          - -DMSGPACK_ENABLE_SHARED=OFF
        sources:
          - type: archive
            url: https://github.com/msgpack/msgpack-c/releases/download/c-4.0.0/msgpack-c-4.0.0.tar.gz
            sha256: 420fe35e7572f2a168d17e660ef981a589c9cbe77faa25eb34a520e1fcc032c8
            x-checker-data:
              type: anitya
              project-id: 235285
              stable-only: true
              url-template: https://github.com/msgpack/msgpack-c/releases/download/c-$version/msgpack-c-$version.tar.gz
        cleanup:
          - /lib/cmake
      - name: tree-sitter-static
        build-options: *musl-static-build-options
        no-autogen: true
        make-install-args:
          - PREFIX=${FLATPAK_DEST}
        post-install:
          - rm ${FLATPAK_DEST}/lib/libtree-sitter.so*
        sources:
          - type: archive
            url: https://github.com/tree-sitter/tree-sitter/archive/v0.20.6/tree-sitter-0.20.6.tar.gz
            sha256: 4d37eaef8a402a385998ff9aca3e1043b4a3bba899bceeff27a7178e1165b9de
            x-checker-data:
              type: anitya
              project-id: 142464
              stable-only: true
              url-template: https://github.com/tree-sitter/tree-sitter/archive/v$version/tree-sitter-$version.tar.gz


  ############################
  ####    Code: Tools     ####
  ############################

  # TODO: evaluate adding colordiff (perl)
  - name: bats-core
    # TODO: add more bats extensions from https://github.com/bats-core
    buildsystem: simple
    build-commands:
      - ./install.sh ${FLATPAK_DEST}
    sources:
      - type: archive
        url: https://github.com/bats-core/bats-core/archive/v1.7.0/bats-core-1.7.0.tar.gz
        sha256: ac70c2a153f108b1ac549c2eaa4154dea4a7c1cc421e3352f0ce6ea49435454e
        x-checker-data:
          type: anitya
          project-id: 10587
          stable-only: true
          url-template: https://github.com/bats-core/bats-core/archive/v$version/bats-core-$version.tar.gz
      - type: shell
        commands:
          - sed -i 's/libexec/lib/g' install.sh bin/bats

  - name: bat-static-bin
    buildsystem: simple
    build-commands:
      - install -Dm755 bat -t ${FLATPAK_DEST}/bin/
      - install -Dm644 bat.1 -t ${FLATPAK_DEST}/share/man/man1/
      - install -Dm644 autocomplete/bat.bash ${FLATPAK_DEST}/share/bash-completion/completions/bat
      - install -Dm644 autocomplete/bat.fish ${FLATPAK_DEST}/share/fish/vendor_completions.d/bat.fish
      - install -Dm644 autocomplete/bat.zsh ${FLATPAK_DEST}/share/zsh/site-functions/_bat
    sources:
      - type: archive
        url: https://github.com/sharkdp/bat/releases/download/v0.21.0/bat-v0.21.0-x86_64-unknown-linux-musl.tar.gz
        sha256: 5e6d199219578fed98483ad132f8207edc23bd072b36c22237edd51aed6b2af9
        x-checker-data:
          type: anitya
          project-id: 17642
          stable-only: true
          url-template: https://github.com/sharkdp/bat/releases/download/v$version/bat-v$version-x86_64-unknown-linux-musl.tar.gz

  - name: difftastic-shared-bin
    buildsystem: simple
    build-commands:
      - install -Dm755 difft -t ${FLATPAK_DEST}/bin/
    sources:
      - type: archive
        strip-components: 0
        url: https://github.com/Wilfred/difftastic/releases/download/0.34.0/difft-x86_64-unknown-linux-gnu.tar.gz
        sha256: 551a00663c5e43dd64193ac269945d34175e7a7a7af09026b5a539dde09c2031
        x-checker-data:
          type: anitya
          project-id: 279512
          stable-only: true
          url-template: https://github.com/Wilfred/difftastic/releases/download/$version/difft-x86_64-unknown-linux-gnu.tar.gz

  - name: highlight-static
    build-options: *musl-static-build-options
    no-autogen: true
    make-args:
      - LUA_CFLAGS=-I${FLATPAK_DEST}/include
      - LUA_LIBS=-L${FLATPAK_DEST}/lib -llua
      - cli
    make-install-args:
      - PREFIX=${FLATPAK_DEST}
    sources:
      - type: archive
        url: http://www.andre-simon.de/zip/highlight-4.2.tar.bz2
        sha256: ed3efdb9b416b236e503989f9dfebdd94bf515536cfd183aefe36cefdd0d0468
        x-checker-data:
          type: anitya
          project-id: 14752
          stable-only: true
          url-template: http://www.andre-simon.de/zip/highlight-$version.tar.bz2
      - type: shell
        commands:
          - sed -i '/^LDFLAGS.*=/d' src/makefile
    modules:
      - name: boost-headers
        buildsystem: simple
        build-commands:
          - ./bootstrap.sh
          - ./b2 --with-headers variant=release link=static runtime-link=static debug-symbols=off
            --prefix=${FLATPAK_DEST} install
        sources:
          - type: archive
            url: https://boostorg.jfrog.io/artifactory/main/release/1.80.0/source/boost_1_80_0.tar.bz2
            sha256: 1e19565d82e43bc59209a168f5ac899d3ba471d55c7610c677d4ccf2c9c500c0
            x-checker-data:
              type: anitya
              project-id: 6845
              stable-only: true
              url-template: https://boostorg.jfrog.io/artifactory/main/release/$major.$minor.$patch/source/boost_${major}_${minor}_$patch.tar.bz2
        cleanup:
          - '*'
      - name: lua-static
        build-options: *musl-static-build-options
        #cflags: -fPIC -DLUA_USE_LINUX
        no-autogen: true
        make-install-args:
          - INSTALL_TOP=${FLATPAK_DEST}
          - INSTALL_MAN=$(INSTALL_TOP)/share/man/man1
        sources:
          - type: archive
            url: https://www.lua.org/ftp/lua-5.4.4.tar.gz
            sha256: 164c7849653b80ae67bec4b7473b884bf5cc8d2dca05653475ec2ed27b9ebf61
            x-checker-data:
              type: anitya
              project-id: 1847
              stable-only: true
              url-template: https://www.lua.org/ftp/lua-$version.tar.gz
          - type: shell
            commands:
              - sed -e "s|/usr/local/|${FLATPAK_DEST}/|" -e '/^#define LUA_IDSIZE/
                s/60/512/' -i src/luaconf.h
              - sed -e "/^PLAT.*=/ s/guess/linux/" -i Makefile src/Makefile
              - sed -e "/^CC.*=/d;/^CFLAGS.*=/d" -i src/Makefile
        cleanup:
          - '*'

  - name: git-delta-static-bin
    buildsystem: simple
    build-commands:
      - install -Dm755 delta -t ${FLATPAK_DEST}/bin/
      - install -Dm644 etc/completion/completion.bash ${FLATPAK_DEST}/share/bash-completion/completions/delta
      # TODO: enable fish completion on release bump
      #- install -Dm644 etc/completion/completion.fish ${FLATPAK_DEST}/share/fish/vendor_completions.d/delta.fish
      - install -Dm644 etc/completion/completion.zsh ${FLATPAK_DEST}/share/zsh/site-functions/_delta
    sources:
      - type: archive
        url: https://github.com/dandavison/delta/releases/download/0.14.0/delta-0.14.0-x86_64-unknown-linux-musl.tar.gz
        sha256: ecfbc3e4508646ec985fbcb5a3a89480f25f0c044d02b2308c2053aba8f42ef9
        x-checker-data:
          type: anitya
          project-id: 98343
          stable-only: true
          url-template: https://github.com/dandavison/delta/releases/download/$version/delta-$version-x86_64-unknown-linux-musl.tar.gz
      - type: archive
        url: https://github.com/dandavison/delta/archive/0.14.0/delta-0.14.0.tar.gz
        sha256: 7d1ab2949d00f712ad16c8c7fc4be500d20def9ba70394182720a36d300a967c
        x-checker-data:
          type: anitya
          project-id: 98343
          stable-only: true
          url-template: https://github.com/dandavison/delta/archive/$version/delta-$version.tar.gz

  - name: patchutils-static
    build-options: *musl-static-build-options
    make-args:
      - LIBS=-lpcre2-posix -lpcre2-8 -lpcre2-16 -lpcre2-32
    sources:
      - type: archive
        url: http://cyberelk.net/tim/data/patchutils/stable/patchutils-0.4.2.tar.xz
        sha256: 8875b0965fe33de62b890f6cd793be7fafe41a4e552edbf641f1fed5ebbf45ed
        x-checker-data:
          type: anitya
          project-id: 2599
          stable-only: true
          url-template: http://cyberelk.net/tim/data/patchutils/stable/patchutils-$version.tar.xz

  - name: riff-static-bin
    buildsystem: simple
    build-commands:
      - install -Dm755 riff -t ${FLATPAK_DEST}/bin/
    sources:
      - type: file
        dest-filename: riff
        url: https://github.com/walles/riff/releases/download/2.19.0/riff-2.19.0-x86_64-linux
        sha256: 14ab9c0f9fb90e42d15b96b5d5341a522e6c19302dbca580f6bdf2f16f98f388
        x-checker-data:
          type: anitya
          project-id: 279515
          stable-only: true
          url-template: https://github.com/walles/riff/releases/download/$version/riff-$version-x86_64-linux

  - name: sccache-static
    buildsystem: simple
    build-commands:
      - install -Dm755 ${SCCACHE_BIN} -t ${FLATPAK_DEST}/bin/

  - name: stringsext-static
    build-options: *musl-static-build-options
    buildsystem: simple
    build-commands: *cargo-build-commands
    post-install:
      - install -Dm755 target/x86_64-unknown-linux-musl/release/stringsext -t ${FLATPAK_DEST}/bin/
    sources:
      - type: archive
        url: https://gitlab.com/getreu/stringsext/-/archive/v2.3.4/stringsext-v2.3.4.tar.gz
        sha256: 1555ba43db2398426daf9c670b654b2699d7476346bded5007a241db778e3471
        x-checker-data:
          type: anitya
          project-id: 284481
          stable-only: true
          url-template: https://gitlab.com/getreu/stringsext/-/archive/v$version/stringsext-v$version.tar.gz
      - stringsext-cargo-sources.json # flatpak-cargo-generator.py Cargo.lock -t -o stringsext-cargo-sources.json
      - type: file
        dest: .cargo
        dest-filename: config
        path: cargo-musl-config

  - name: tokei-static-bin
    buildsystem: simple
    build-commands:
      - install -Dm755 tokei -t ${FLATPAK_DEST}/bin/
    sources:
      - type: archive
        strip-components: 0
        url: https://github.com/XAMPPRocky/tokei/releases/download/v12.1.2/tokei-x86_64-unknown-linux-musl.tar.gz
        sha256: 331e77046935d655dce8d97ebb943fcc7e9684586dadf3d197f3df5e760cd31b
        x-checker-data:
          type: anitya
          project-id: 13727
          stable-only: true
          url-template: https://github.com/XAMPPRocky/tokei/releases/download/v$version/tokei-x86_64-unknown-linux-musl.tar.gz


  ############################
  ####     Code: VCS      ####
  ############################

  - name: gitflow-avh
    no-autogen: true
    no-make-install: true # NOTE: no default target
    make-args:
      - prefix=${FLATPAK_DEST}
      - install
    build-commands:
      # TODO: might need to create completion symlinks for executables
      - install -Dm644 git-flow-completion.bash ${FLATPAK_DEST}/share/bash-completion/completions/git-flow
      - install -Dm644 git.fish ${FLATPAK_DEST}/share/fish/vendor_completions.d/git-flow.fish
      - install -Dm644 git-flow-completion.zsh ${FLATPAK_DEST}/share/zsh/site-functions/_git-flow
    sources:
      - type: archive
        url: https://github.com/petervanderdoes/gitflow-avh/archive/1.12.3/gitflow-avh-1.12.3.tar.gz
        sha256: 54e9fd81aa1aa8215c865503dc6377da205653c784d6c97baad3dafd20728e06
        x-checker-data:
          type: anitya
          project-id: 280396
          stable-only: true
          url-template: https://github.com/petervanderdoes/gitflow-avh/archive/$version/gitflow-avh-$version.tar.gz
      - type: archive
        url: https://github.com/petervanderdoes/git-flow-completion/archive/0.6.0/git-flow-completion-0.6.0.tar.gz
        sha256: b1b78b785aa2c06f81cc29fcf03a7dfc451ad482de67ca0d89cdb0f941f5594b
        x-checker-data:
          type: anitya
          project-id: 280423
          stable-only: true
          url-template: https://github.com/petervanderdoes/git-flow-completion/archive/$version/git-flow-completion-$version.tar.gz

  - name: git-extras
    no-autogen: true
    no-make-install: true # NOTE: install is the default target
    make-args:
      - PREFIX=${FLATPAK_DEST}
    build-commands:
      # TODO: might need to create completion symlinks for executables
      - install -Dm644 etc/git-extras.fish ${FLATPAK_DEST}/share/fish/vendor_completions.d/git-extras.fish
      - install -Dm644 etc/git-extras-completion.zsh ${FLATPAK_DEST}/share/zsh/site-functions/_git-extras
    sources:
      - type: archive
        url: https://github.com/tj/git-extras/archive/6.4.0/git-extras-6.4.0.tar.gz
        sha256: d8943c0caab43e70c23890816a9775844d33261c40d5be03c1e012c276b1aa63
        x-checker-data:
          type: anitya
          project-id: 1167
          stable-only: true
          url-template: https://github.com/tj/git-extras/archive/$version/git-extras-$version.tar.gz
      - type: shell
        commands:
          - sed -i 's#$(SYSCONFDIR)/bash_completion.d#$(PREFIX)/share/bash-completion/completions#'
            Makefile

  - name: git-lfs-static-bin
    buildsystem: simple
    build-commands:
      - install -Dm755 git-lfs -t ${FLATPAK_DEST}/bin/
      - install -Dm644 man/man1/* -t ${FLATPAK_DEST}/share/man/man1/
      - install -Dm644 man/man5/* -t ${FLATPAK_DEST}/share/man/man5/
    sources:
      - type: archive
        url: https://github.com/git-lfs/git-lfs/releases/download/v3.2.0/git-lfs-linux-amd64-v3.2.0.tar.gz
        sha256: d6730b8036d9d99f872752489a331995930fec17b61c87c7af1945c65a482a50
        x-checker-data:
          type: anitya
          project-id: 11551
          stable-only: true
          url-template: https://github.com/git-lfs/git-lfs/releases/download/v$version/git-lfs-linux-amd64-v$version.tar.gz

  - name: github-cli-static-bin
    buildsystem: simple
    build-commands:
      - install -Dm755 bin/gh -t ${FLATPAK_DEST}/bin/
      - install -Dm644 share/man/man1/* -t ${FLATPAK_DEST}/share/man/man1/
      - bin/gh completion -s bash | install -Dm644 /dev/stdin ${FLATPAK_DEST}/share/bash-completion/completions/gh
      - bin/gh completion -s fish | install -Dm644 /dev/stdin ${FLATPAK_DEST}/share/fish/vendor_completions.d/gh.fish
      - bin/gh completion -s zsh | install -Dm644 /dev/stdin ${FLATPAK_DEST}/share/zsh/site-functions/_gh
    sources:
      - type: archive
        url: https://github.com/cli/cli/releases/download/v2.14.7/gh_2.14.7_linux_amd64.tar.gz
        sha256: d174d0057b72ad0427d3225225d50d4dffaa61f3c000deeaf96248ae49deb2be
        x-checker-data:
          type: anitya
          project-id: 135615
          stable-only: true
          url-template: https://github.com/cli/cli/releases/download/v$version/gh_${version}_linux_amd64.tar.gz

  - name: github-hub-static
    build-options:
     #build-args:
     #  - --share=network
      env:
        - CGO_ENABLED=0
    buildsystem: simple
   #build-commands: *golang-online-build-commands
    build-commands: *golang-offline-build-commands
   #build-commands: # binary release (dynamic)
   #  - install -Dm755 bin/hub -t ${FLATPAK_DEST}/bin/
    post-install:
      - mv ${FLATPAK_DEST}/bin/{github-hub-static,hub}
      - install -Dm644 share/man/man1/* -t ${FLATPAK_DEST}/share/man/man1/
      - install -Dm644 etc/hub.bash_completion.sh ${FLATPAK_DEST}/share/bash-completion/completions/hub
      - install -Dm644 etc/hub.fish_completion ${FLATPAK_DEST}/share/fish/vendor_completions.d/hub.fish
      - install -Dm644 etc/hub.zsh_completion ${FLATPAK_DEST}/share/zsh/site-functions/_hub
      - cp -r share/vim ${FLATPAK_DEST}/share/
    sources:
      - type: archive
        url: https://github.com/github/hub/archive/v2.14.2/hub-2.14.2.tar.gz
        sha256: e19e0fdfd1c69c401e1c24dd2d4ecf3fd9044aa4bd3f8d6fd942ed1b2b2ad21a
        x-checker-data:
          type: anitya
          project-id: 5368
          stable-only: true
          url-template: https://github.com/github/hub/archive/v$version/hub-2.14.2.tar.gz
      - github-hub-go-sources.json # OFFLINE-BUILD, flatpak-go-get-generator.py -o github-hub-go-sources.json ./
     #- type: archive # binary release (dynamic)
     #  url: https://github.com/github/hub/releases/download/v2.14.2/hub-linux-amd64-2.14.2.tgz
     #  sha256: 74d95fdfb3c78c8af4e2025b04b916ad905ab99a361778500d58269847c7922d
     #  x-checker-data:
     #    type: anitya
     #    project-id: 5368
     #    stable-only: true
     #    url-template: https://github.com/github/hub/releases/download/v$version/hub-linux-amd64-$version.tgz

  - name: gitlab-cli-static-bin
    buildsystem: simple
    build-commands:
      - bsdtar -Oxf glab.deb 'data.tar*' | bsdtar -xf - --strip-components=2
      - install -Dm755 bin/glab -t ${FLATPAK_DEST}/bin/
      - install -Dm644 share/man/man1/* -t ${FLATPAK_DEST}/share/man/man1/
      - bin/glab completion -s bash | install -Dm644 /dev/stdin ${FLATPAK_DEST}/share/bash-completion/completions/glab
      - bin/glab completion -s fish | install -Dm644 /dev/stdin ${FLATPAK_DEST}/share/fish/vendor_completions.d/glab.fish
      - bin/glab completion -s zsh | install -Dm644 /dev/stdin ${FLATPAK_DEST}/share/zsh/site-functions/_glab
    sources:
      - type: file
        dest-filename: glab.deb
        url: https://github.com/profclems/glab/releases/download/v1.22.0/glab_1.22.0_Linux_x86_64.deb
        sha256: 5761f235ee5ef358dabcb8a5d86013572eb504cc43237b84c258114ab3fd7c27
        x-checker-data:
          type: anitya
          project-id: 127208
          stable-only: true
          url-template: https://github.com/profclems/glab/releases/download/v$version/glab_${version}_Linux_x86_64.deb

  - name: gitlab-release-cli-static-bin
    buildsystem: simple
    build-commands:
      - install -Dm755 release-cli -t ${FLATPAK_DEST}/bin/
    sources:
      - type: file
        dest-filename: release-cli
        url: https://gitlab.com/gitlab-org/release-cli/-/releases/v0.13.0/downloads/bin/release-cli-linux-amd64
        sha256: 5afa1cd8d6713e15a3627d0fb53cbc5f084912c6b404507b60c175832eb9b386
        x-checker-data:
          type: anitya
          project-id: 267525
          stable-only: true
          url-template: https://gitlab.com/gitlab-org/release-cli/-/releases/v$version/downloads/bin/release-cli-linux-amd64

  - name: gitea-tea-static-bin
    buildsystem: simple
    build-commands:
      - install -Dm755 tea -t ${FLATPAK_DEST}/bin/
      - install -Dm644 contrib/autocomplete.sh ${FLATPAK_DEST}/share/bash-completion/completions/tea
      - install -Dm644 contrib/autocomplete.zsh ${FLATPAK_DEST}/share/zsh/site-functions/_tea
    sources:
      - type: file
        dest-filename: tea
        url: https://gitea.com/gitea/tea/releases/download/v0.8.0/tea-0.8.0-linux-amd64
        sha256: 8bc99e0532548365f3d86a5ec319772121a844d54a01cb51cddb030d05f27a0c
        x-checker-data:
          type: json
          url: https://gitea.com/api/v1/repos/gitea/tea/releases
          version-query: first(.[].tag_name | sub("^v"; ""))
          url-query: '"https://gitea.com/gitea/tea/releases/download/v" + $version
            + "/tea-" + $version + "-linux-amd64"'
      - type: archive
        url: https://gitea.com/gitea/tea/archive/v0.8.0.tar.gz
        sha256: 6c73c0a7b66cdfd1e5a302257d54df06a3a41eb9bdbfeb547966db431ae23b23
        x-checker-data:
          type: json
          url: https://gitea.com/api/v1/repos/gitea/tea/releases
          version-query: first(.[].tag_name | sub("^v"; ""))
          url-query: '"https://gitea.com/gitea/tea/archive/v" + $version + ".tar.gz"'

# - name: perl-authen-sasl # git-send-email
#   buildsystem: simple
#   build-commands:
#     - PERL5LIB=${FLATPAK_DEST}/lib/perl5 PERL_USE_UNSAFE_INC=1 perl Makefile.PL INSTALL_BASE=${FLATPAK_DEST}
#     - make install
#   post-install:
#     # workaround for cpanm acting silly and install files without write permission
#     - find ${FLATPAK_DEST}/lib/perl5 -type f ! -perm -0200 -exec chmod u+w '{}' \;
#     # workaround for multiple modules trying to write into perllocal.pod
#     - rm -f ${FLATPAK_DEST}/lib/perl5/x86_64-linux/perllocal.pod
#   sources:
#     - type: archive
#       url: https://cpan.metacpan.org/authors/id/G/GB/GBARR/Authen-SASL-2.16.tar.gz
#       sha256: 6614fa7518f094f853741b63c73f3627168c5d3aca89b1d02b1016dc32854e09
#       x-checker-data:
#         type: anitya
#         project-id: 6627
#         stable-only: true
#         url-template: https://cpan.metacpan.org/authors/id/G/GB/GBARR/Authen-SASL-$version.tar.gz
#   cleanup:
#     - .packlist
#     - '*.pod'

# - name: perl-io-socket-ssl # git-send-email
    # TODO: add perl?
#   buildsystem: simple
#   build-commands:
#     - PERL5LIB=${FLATPAK_DEST}/lib/perl5 perl Makefile.PL INSTALL_BASE=${FLATPAK_DEST}
#     - make install
#   post-install:
#     # workaround for cpanm acting silly and install files without write permission
#     - find ${FLATPAK_DEST}/lib/perl5 -type f ! -perm -0200 -exec chmod u+w '{}' \;
#     # workaround for multiple modules trying to write into perllocal.pod
#     - rm -f ${FLATPAK_DEST}/lib/perl5/x86_64-linux/perllocal.pod
#   sources:
#     - type: archive
#       url: https://cpan.metacpan.org/authors/id/S/SU/SULLR/IO-Socket-SSL-2.074.tar.gz
#       sha256: 36486b6be49da4d029819cf7069a7b41ed48af0c87e23be0f8e6aba23d08a832
#       x-checker-data:
#         type: anitya
#         project-id: 6569
#         stable-only: true
#         url-template: https://cpan.metacpan.org/authors/id/S/SU/SULLR/IO-Socket-SSL-$version.tar.gz
#   cleanup:
#     - .packlist
#     - '*.pod'
#   modules:
#     - name: perl-net-ssleay # depends on openssl
#       build-options: *musl-shared-build-options # NOTE: can't be built with musl without building perl
#       buildsystem: simple
#       build-commands:
#         - PERL5LIB=${FLATPAK_DEST}/lib/perl5 perl Makefile.PL INSTALL_BASE=${FLATPAK_DEST}
#         - sed -i '/^\(CC\|CFLAGS\|LDFLAGS\) =/d;s#-I"/usr/include"#-I"${FLATPAK_DEST}/include"#g' Makefile
#         - |
#           sed -i \
#             -e '/^\(CC\|CFLAGS\|LDFLAGS\) =/d' \
#             -e 's/\(^LD =\).*/\1 $(CC)/' \
#             -e 's/\(^LDDLFLAGS =\).*/\1 $(LDFLAGS)/' \
#             -e 's#-I"/usr/include"#-I"${FLATPAK_DEST}/include"#g' \
#             Makefile
#         - make install
#       post-install:
#         # workaround for cpanm acting silly and install files without write permission
#         - find ${FLATPAK_DEST}/lib/perl5 -type f ! -perm -0200 -exec chmod u+w '{}' \;
#         # workaround for multiple modules trying to write into perllocal.pod
#         - rm -f ${FLATPAK_DEST}/lib/perl5/x86_64-linux/perllocal.pod
#       sources:
#         - type: archive
#           url: https://cpan.metacpan.org/authors/id/C/CH/CHRISN/Net-SSLeay-1.92.tar.gz
#           sha256: 47c2f2b300f2e7162d71d699f633dd6a35b0625a00cbda8c50ac01144a9396a9
#           x-checker-data:
#             type: anitya
#             project-id: 6575
#             stable-only: true
#             url-template: https://cpan.metacpan.org/authors/id/C/CH/CHRISN/Net-SSLeay-$version.tar.gz
#       cleanup:
#         - .packlist
#         - '*.pod'
#     - name: perl-uri
#       buildsystem: simple
#       build-commands:
#         - PERL5LIB=${FLATPAK_DEST}/lib/perl5 perl Makefile.PL INSTALL_BASE=${FLATPAK_DEST}
#         - make install
#       post-install:
#         # workaround for cpanm acting silly and install files without write permission
#         - find ${FLATPAK_DEST}/lib/perl5 -type f ! -perm -0200 -exec chmod u+w '{}' \;
#         # workaround for multiple modules trying to write into perllocal.pod
#         - rm -f ${FLATPAK_DEST}/lib/perl5/x86_64-linux/perllocal.pod
#       sources:
#         - type: archive
#           url: https://cpan.metacpan.org/authors/id/O/OA/OALDERS/URI-5.12.tar.gz
#           sha256: 66abe0eaddd76b74801ecd28ec1411605887550fc0a45ef6aa744fdad768d9b3
#           x-checker-data:
#             type: anitya
#             project-id: 3485
#             stable-only: true
#             url-template: https://cpan.metacpan.org/authors/id/O/OA/OALDERS/URI-$version.tar.gz
#       cleanup:
#         - .packlist
#         - '*.pod'

  - name: tig-static
    build-options: *musl-static-build-options
    make-install-args:
      - install-doc-man
    post-install:
      - install -Dm755 contrib/tig-pick -t ${FLATPAK_DEST}/bin/
      - install -Dm644 contrib/tig-completion.bash ${FLATPAK_DEST}/share/bash-completion/completions/tig
      - install -Dm644 contrib/tig-completion.zsh ${FLATPAK_DEST}/share/zsh/site-functions/_tig
      - install -Dm644 contrib/vim.tigrc -t ${FLATPAK_DEST}/share/tig/
    sources:
      - type: archive
        url: https://github.com/jonas/tig/releases/download/tig-2.5.7/tig-2.5.7.tar.gz
        sha256: dbc7bac86b29098adaa005a76161e200f0734dda36de9f6bd35a861c7c29ca76
        x-checker-data:
          type: anitya
          project-id: 4969
          stable-only: true
          url-template: https://github.com/jonas/tig/releases/download/tig-$version/tig-$version.tar.gz


  ############################
  ####     Containers     ####
  ############################

  - name: host-spawn-static-bin
    buildsystem: simple
    build-commands:
      - install -Dm755 host-spawn -t ${FLATPAK_DEST}/bin/
    sources:
      - type: file
        dest-filename: host-spawn
        url: https://github.com/1player/host-spawn/releases/download/1.2.1/host-spawn-x86_64
        sha256: 49c7c1902030f7a027c94791399fe9951f3675d1c81be9c987a9f975c570255e
        x-checker-data:
          type: anitya
          project-id: 270202
          stable-only: true
          url-template: https://github.com/1player/host-spawn/releases/download/$version/host-spawn-x86_64

  - name: podman-tui-static
    build-options:
     #build-args:
     #  - --share=network
      env:
        # TODO: maybe add these as default CGO flags, maybe also dynamic link path
        - |
          GOVARS_EXTRA=
          CGO_CFLAGS=-I${FLATPAK_DEST}/include
        - CGO_LDFLAGS=-static -lgpg-error -lassuan
    buildsystem: simple
   #build-commands: *golang-online-build-commands
    build-commands: *golang-offline-build-commands
    post-install:
      - mv ${FLATPAK_DEST}/bin/podman-tui{-static,}
    sources:
      - type: archive
        url: https://github.com/containers/podman-tui/archive/v0.5.0/podman-tui-0.5.0.tar.gz
        sha256: c9f32e8a80b8fc5253cf21c289c31da42d62ca41656e491d0a6adc67a1f2f5a7
        x-checker-data:
          type: anitya
          project-id: 283927
          stable-only: true
          url-template: https://github.com/containers/podman-tui/archive/v$version/podman-tui-$version.tar.gz
      - podman-tui-go-sources.json # OFFLINE-BUILD, flatpak-go-get-generator.py -o podman-tui-go-sources.json ./
    modules:
      - name: btrfs-progs-static # depends on zstd
        build-options: *musl-static-build-options
        config-opts:
          - --disable-shared
          - --disable-programs
          - --disable-backtrace
          - --disable-documentation
          - --disable-convert
          - --disable-zoned
          - --disable-udev
          - --disable-python
          - --disable-lzo
        sources:
          - type: archive
            url: https://mirrors.edge.kernel.org/pub/linux/kernel/people/kdave/btrfs-progs/btrfs-progs-v5.19.tar.xz
            sha256: 1fbcf06e4b2f80e7a127fd687ed4625a5b74fa674fe212c836ff70e0edfcccf9
            x-checker-data:
              type: anitya
              project-id: 227
              stable-only: true
              url-template: https://mirrors.edge.kernel.org/pub/linux/kernel/people/kdave/btrfs-progs/btrfs-progs-v$version.tar.xz
        cleanup:
          - '*'
      - name: device-mapper-static
        build-options: *musl-static-build-options
        config-opts:
          - --disable-shared
          - --sbindir=${bindir}
          - --enable-static_link
          - --with-staticdir=${bindir}
        make-args:
          - libdm.device-mapper
        install-rule: install_device-mapper
        make-install-args:
          - INSTALL_TYPE=install_static install_pkgconfig
        sources:
          - type: archive
            url: http://mirrors.kernel.org/sourceware/lvm2/LVM2.2.03.16.tgz
            sha256: e661ece15b5d88d8abe39a4c1e1db2f43e1896f019948bb98b0e15d777680786
            x-checker-data:
              type: anitya
              project-id: 5354
              stable-only: true
              url-template: http://mirrors.kernel.org/sourceware/lvm2/LVM2.$version.tgz
          - type: shell
            commands:
              - sed -i '/^TARGETS =/d' libdm/Makefile.in
              - sed -i '/^LIB_SHARED =/d' libdm/Makefile.in
              - sed -i 's/$(LIBDM_SHARED)/$(LIBDM_STATIC)/' libdm/dm-tools/Makefile.in
              - sed -i '/^SUBDIRS=dm-tools/d' libdm/Makefile.in
        cleanup:
          - '*'
        modules:
          - name: libaio-static
            build-options: *musl-static-build-options
            no-autogen: true
            make-args:
              - ENABLE_SHARED=0
            make-install-args:
              - prefix=${FLATPAK_DEST}
              - ENABLE_SHARED=0
            sources:
              - type: archive
                url: https://pagure.io/libaio/archive/libaio-0.3.113/libaio-libaio-0.3.113.tar.gz
                sha256: 716c7059703247344eb066b54ecbc3ca2134f0103307192e6c2b7dab5f9528ab
                x-checker-data:
                  type: anitya
                  project-id: 1557
                  stable-only: true
                  url-template: https://pagure.io/libaio/archive/libaio-$version/libaio-libaio-$version.tar.gz
            cleanup:
              - '*'

  - name: podman-remote-static-bin
    buildsystem: simple
    build-commands:
      - install -Dm755 podman-remote-static ${FLATPAK_DEST}/bin/podman-remote
    sources:
      - type: archive
        strip-components: 0
        url: https://github.com/containers/podman/releases/download/v4.2.0/podman-remote-static.tar.gz
        sha256: 8e11b5111caa4e8d1e69e99a86644ce32b68793b78b371094b4a4632ec671047
        x-checker-data:
          type: anitya
          project-id: 93284
          stable-only: true
          url-template: https://github.com/containers/podman/releases/download/v$version/podman-remote-static.tar.gz


  ############################
  ####    Data formats    ####
  ############################

  - name: dos2unix-static
    build-options: *musl-static-build-options
    no-autogen: true
    sources:
      - type: archive
        url: https://waterlan.home.xs4all.nl/dos2unix/dos2unix-7.4.3.tar.gz
        sha256: b68db41956daf933828423aa30510e00c12d29ef5916e715e8d4e694fe66ca72
        x-checker-data:
          type: anitya
          project-id: 453
          stable-only: true
          url-template: https://waterlan.home.xs4all.nl/dos2unix/dos2unix-$version.tar.gz
      - type: shell
        commands:
          - sed -i '/^LDFLAGS .*=/d;s/\(^prefix .*=\).*/\1 ${FLATPAK_DEST}/' Makefile
          - sed -i '/^ENABLE_NLS.*=/d' Makefile

  - name: go-yq-static-bin
    buildsystem: simple
    build-commands:
      - install -Dm755 yq -t ${FLATPAK_DEST}/bin/
    sources:
      - type: file
        dest-filename: yq
        url: https://github.com/mikefarah/yq/releases/download/v4.27.3/yq_linux_amd64
        sha256: 9bef9dfdfdca811c307625b5d5ae75be07a382b5a7b9314d91918216965c3028
        x-checker-data:
          type: json
          url: https://api.github.com/repos/mikefarah/yq/releases/latest
          version-query: .tag_name | sub("^v"; "")
          url-query: '"https://github.com/mikefarah/yq/releases/download/v" + $version
            + "/yq_linux_amd64"'

  - name: jq-static
    build-options: *musl-static-build-options
    config-opts:
      - --enable-all-static
    sources:
      - type: archive
        url: https://github.com/stedolan/jq/releases/download/jq-1.6/jq-1.6.tar.gz
        sha256: 5de8c8e29aaa3fb9cc6b47bb27299f271354ebb72514e3accadc7d38b5bbaa72
        x-checker-data:
          type: anitya
          project-id: 13252
          stable-only: true
          url-template: https://github.com/stedolan/jq/releases/download/jq-$version/jq-$version.tar.gz
    modules:
      - name: oniguruma-static
        build-options: *musl-static-build-options
        config-opts:
          - --enable-posix-api
        sources:
          - type: archive
            url: https://github.com/kkos/oniguruma/releases/download/v6.9.8/onig-6.9.8.tar.gz
            sha256: 28cd62c1464623c7910565fb1ccaaa0104b2fe8b12bcd646e81f73b47535213e
            x-checker-data:
              type: anitya
              project-id: 11184
              stable-only: true
              url-template: https://github.com/kkos/oniguruma/releases/download/v$version/onig-$version.tar.gz


  ############################
  ####     Dotfiles       ####
  ############################

  - name: stow
    # TODO: replace this with binary alternative
    build-options: *musl-static-build-options
    sources:
      - type: archive
        url: https://ftp.gnu.org/gnu/stow/stow-2.3.1.tar.gz
        sha256: 09d5d99671b78537fd9b2c0b39a5e9761a7a0e979f6fdb7eabfa58ee45f03d4b
        x-checker-data:
          type: anitya
          project-id: 4900
          stable-only: true
          url-template: https://ftp.gnu.org/gnu/stow/stow-$version.tar.gz


  ############################
  ## Files: Backup and sync ##
  ############################

  - name: restic-static-bin
    buildsystem: simple
    build-commands:
      - bunzip2 restic.bz2
      - install -Dm755 restic -t ${FLATPAK_DEST}/bin/
      - install -Dm644 doc/man/*.1 -t ${FLATPAK_DEST}/share/man/man1/
      - install -Dm644 doc/bash-completion.sh ${FLATPAK_DEST}/share/bash-completion/completions/restic
      - install -Dm644 doc/fish-completion.fish ${FLATPAK_DEST}/share/fish/vendor_completions.d/restic.fish
      - install -Dm644 doc/zsh-completion.zsh ${FLATPAK_DEST}/share/zsh/site-functions/_restic
    sources:
      - type: file
        dest-filename: restic.bz2
        url: https://github.com/restic/restic/releases/download/v0.14.0/restic_0.14.0_linux_amd64.bz2
        sha256: c8da7350dc334cd5eaf13b2c9d6e689d51e7377ba1784cc6d65977bd44ee1165
        x-checker-data:
          type: anitya
          project-id: 16643
          stable-only: true
          url-template: https://github.com/restic/restic/releases/download/v$version/restic_${version}_linux_amd64.bz2
      - type: archive
        url: https://github.com/restic/restic/releases/download/v0.14.0/restic-0.14.0.tar.gz
        sha256: 78cdd8994908ebe7923188395734bb3cdc9101477e4163c67e7cc3b8fd3b4bd6
        x-checker-data:
          type: anitya
          project-id: 16643
          stable-only: true
          url-template: https://github.com/restic/restic/releases/download/v$version/restic-$version.tar.gz

  - name: rsync-static
    build-options: *musl-static-build-options
    config-opts:
      - --disable-md2man
      - --with-included-popt=no
      - --with-included-zlib=no
      - --disable-locale
    sources:
      - type: archive
        url: https://download.samba.org/pub/rsync/src/rsync-3.2.5.tar.gz
        sha256: 2ac4d21635cdf791867bc377c35ca6dda7f50d919a58be45057fd51600c69aba
        x-checker-data:
          type: anitya
          project-id: 4217
          stable-only: true
          url-template: https://download.samba.org/pub/rsync/src/rsync-$version.tar.gz


  ############################
  ###  Files: Filesystems  ###
  ############################

  - name: ostree-static
    build-options: *musl-static-build-options
    config-opts:
      - --disable-shared
      - --libexec=${prefix}/lib
      - --disable-glibtest
      - --disable-gtk-doc
      - --disable-gtk-doc-html
      - --disable-http2
      - --disable-introspection
      - --disable-rofiles-fuse
      - --enable-man
      - --with-curl
      - --without-avahi
      - --without-libmount
      - --without-libsystemd
      - --without-selinux
      - --without-soup
    make-args:
      - CCLD=$(CC) -all-static
    post-install:
      - install -Dm755 ostree-wrapper ${FLATPAK_DEST}/bin/fsw/ostree
    sources:
      - type: archive
        url: https://github.com/ostreedev/ostree/releases/download/v2022.5/libostree-2022.5.tar.xz
        sha256: 914c4d993bc111d7dd30ae9721b6ffe8ab56eb1fd6e81b097b09f400cc1b053f
        x-checker-data:
          type: anitya
          project-id: 10899
          stable-only: true
          url-template: https://github.com/ostreedev/ostree/releases/download/v$version/libostree-$version.tar.xz
      - type: script
        dest-filename: ostree-wrapper
        commands:
          - |
            if [ -n "$DEVENV_OSTREE_PREFER_HOST" ]; then
              host-spawn ostree "$@"
            else
              fsw_path="$(dirname "$(realpath "$0")")"
              exec "$(dirname "${wrapper_path}")"/ostree "$@"
            fi
    cleanup:
      - /etc
      - /lib/libostree
      - /lib/ostree
      - /share/ostree
    modules:
      - name: curl-static # depends on brotli krb5 libidn2 libnghttp2openssl zlib zstd
        build-options: *musl-static-build-options
        # TODO: add more depends brotli libpsl libssh2
        # TODO: explicit features
        # TODO: remove executables and move to libraries section
        config-opts:
          - --disable-shared
          - --disable-ldap
          - --disable-ldaps
          - --disable-manual
          - --enable-ipv6
          - --enable-threaded-resolver
         #- --with-gssapi # TODO: fix gssapi detection
          - --with-libssh # TODO: drop this after enabling libssh2
          - --with-openssl
          - --without-brotli
          - --without-libpsl
          - --without-libssh2
        sources:
          - type: archive
            url: https://curl.se/download/curl-7.85.0.tar.gz
            sha256: 78a06f918bd5fde3c4573ef4f9806f56372b32ec1829c9ec474799eeee641c27
            x-checker-data:
              type: anitya
              project-id: 381
              stable-only: true
              url-template: https://curl.se/download/curl-$version.tar.gz
        cleanup:
          - '*'
      - name: e2fsprogs-static
        # NOTE: includes linux-utils' libblkid and libuuid, can be disabled
        build-options: *musl-static-build-options
        config-opts:
          - --disable-shared
          - --sbindir=${bindir}
          - --disable-nls
          - --disable-debugfs
          - --disable-defrag
          - --disable-fsck
          - --disable-fuse2fs
          - --disable-imager
          - --disable-resizer
          - --disable-uuidd
        install-rule: install-libs
        make-install-args:
          - subs
        sources:
          - type: archive
            url: https://mirrors.edge.kernel.org/pub/linux/kernel/people/tytso/e2fsprogs/v1.46.5/e2fsprogs-1.46.5.tar.gz
            sha256: 0786fadd77421e04b21f3a79513c5d8d9232f82eb8bea68f3af46f2d98bdd889
            x-checker-data:
              type: anitya
              project-id: 646
              stable-only: true
              url-template: https://mirrors.edge.kernel.org/pub/linux/kernel/people/tytso/e2fsprogs/v$version/e2fsprogs-$version.tar.gz
        cleanup:
          - '*'

  - name: sshfs-static
    build-options: *musl-static-build-options
    buildsystem: meson
    config-opts:
      - --default-library=static
      - --sbindir=bin
    sources:
      - type: archive
        url: https://github.com/libfuse/sshfs/releases/download/sshfs-3.7.3/sshfs-3.7.3.tar.xz
        sha256: 5218ce7bdd2ce0a34137a0d7798e0f6d09f0e6d21b1e98ee730a18b0699c2e99
        x-checker-data:
          type: anitya
          project-id: 11058
          stable-only: true
          url-template: https://github.com/libfuse/sshfs/releases/download/sshfs-$version/sshfs-$version.tar.xz
    cleanup:
      - /bin/mount.*


  ############################
  ## Files: Folder listing  ##
  ############################

  - name: exa-static-bin
    buildsystem: simple
    build-commands:
      - install -Dm755 bin/exa -t ${FLATPAK_DEST}/bin/
      - install -Dm644 completions/exa.bash ${FLATPAK_DEST}/share/bash-completion/completions/exa
      - install -Dm644 completions/exa.fish ${FLATPAK_DEST}/share/fish/vendor_completions.d/exa.fish
      - install -Dm644 completions/exa.zsh ${FLATPAK_DEST}/share/zsh/site-functions/_exa
      - install -Dm644 man/exa.1 -t ${FLATPAK_DEST}/share/man/man1/
      - install -Dm644 man/exa_colors.5 -t ${FLATPAK_DEST}/share/man/man5/
    sources:
      - type: archive
        strip-components: 0
        url: https://github.com/ogham/exa/releases/download/v0.10.1/exa-linux-x86_64-musl-v0.10.1.zip
        sha256: 790311d6167c2b439dee253d548c8fcb67809aa6704bc2c4f2b8dd25cf6fdd31
        x-checker-data:
          type: anitya
          project-id: 16575
          stable-only: true
          url-template: https://github.com/ogham/exa/releases/download/v$version/exa-linux-x86_64-musl-v$version.zip

  - name: lsd-static-bin
    buildsystem: simple
    build-commands:
      - install -Dm755 lsd -t ${FLATPAK_DEST}/bin/
      - install -Dm644 autocomplete/lsd.bash-completion ${FLATPAK_DEST}/share/bash-completion/completions/lsd
      - install -Dm644 autocomplete/lsd.fish -t ${FLATPAK_DEST}/share/fish/vendor_completions.d/
      - install -Dm644 autocomplete/_lsd -t ${FLATPAK_DEST}/share/zsh/site-functions/
      - install -Dm644 lsd.1 -t ${FLATPAK_DEST}/share/man/man1/
    sources:
      - type: archive
        url: https://github.com/Peltoche/lsd/releases/download/0.22.0/lsd-0.22.0-x86_64-unknown-linux-musl.tar.gz
        sha256: 0adadefe27ea59cee0de226849d21dee4009064c431eca125b93995289f9ffbc
        x-checker-data:
          type: anitya
          project-id: 20242
          stable-only: true
          url-template: https://github.com/Peltoche/lsd/releases/download/$version/lsd-$version-x86_64-unknown-linux-musl.tar.gz

  - name: ncdu-static-bin
    # TODO: generate static build with zig
    buildsystem: simple
    build-commands:
      - install -Dm755 ncdu -t ${FLATPAK_DEST}/bin/
      - install -Dm644 ncdu.1 -t ${FLATPAK_DEST}/share/man/man1/
    sources:
      - type: archive
        strip-components: 0
        url: https://dev.yorhel.nl/download/ncdu-2.1.2-linux-x86_64.tar.gz
        sha256: c837b535a5b42b5c9813bc5719358d6fc84ded3c4d477e779edd0f4ca88b2b60
        x-checker-data:
          type: anitya
          project-id: 6045
          stable-only: true
          url-template: https://dev.yorhel.nl/download/ncdu-$version-linux-x86_64.tar.gz
      - type: archive
        url: https://dev.yorhel.nl/download/ncdu-2.1.2.tar.gz
        sha256: 9e0d6ef03618a3c316726bf49217b7efe45cec758b2c917ce892ded74332c6dc
        x-checker-data:
          type: anitya
          project-id: 6045
          stable-only: true
          url-template: https://dev.yorhel.nl/download/ncdu-$version.tar.gz

  - name: tree-static
    build-options: *musl-static-build-options
    no-autogen: true
    make-install-args:
      - PREFIX=${FLATPAK_DEST}
      - MANDIR=${PREFIX}/share/man
    sources:
      - type: archive
        url: http://mama.indstate.edu/users/ice/tree/src/tree-2.0.3.tgz
        sha256: ba14e77b5f9dc7f8250c3f702ec5b6be2f93cd0fa87311bab3239676866a3b1d
        x-checker-data:
          type: anitya
          project-id: 5006
          stable-only: true
          url-template: http://mama.indstate.edu/users/ice/tree/src/tree-$version.tgz
      - type: shell
        commands:
          - sed -i '/^CC=/d;/^CFLAGS=/d;/^LDFLAGS=/d' Makefile


  ############################
  ####  Files: Managers   ####
  ############################

  - name: ranger
    buildsystem: simple
    build-commands: *python-setup-build-commands
    sources:
      - type: archive
        url: https://ranger.github.io/ranger-1.9.3.tar.gz
        sha256: ce088a04c91c25263a9675dc5c43514b7ec1b38c8ea43d9a9d00923ff6cdd251
        x-checker-data:
          type: html
          url: https://ranger.github.io/download.html
          version-pattern: ranger-([\d\.-]+).tar.gz
          url-template: https://ranger.github.io/ranger-$version.tar.gz
      - type: patch
        path: ranger-sixel.patch
      - type: patch
        path: ranger-tmux-fixes.patch
    cleanup:
      - '*'
    modules:
      - name: python-bidi
        buildsystem: simple
        build-commands: *python-pip-build-commands
        sources:
          - type: file
            url: https://files.pythonhosted.org/packages/33/b0/f942d146a2f457233baaafd6bdf624eba8e0f665045b4abd69d1b62d097d/python_bidi-0.4.2-py2.py3-none-any.whl
            sha256: 50eef6f6a0bbdd685f9e8c207f3c9050f5b578d0a46e37c76a9c4baea2cc2e13
            x-checker-data:
              type: pypi
              name: python-bidi
              packagetype: bdist_wheel
        cleanup:
          - '*'
        modules:
          - name: python-six
            buildsystem: simple
            build-commands: *python-pip-build-commands
            sources:
              - type: file
                url: https://files.pythonhosted.org/packages/d9/5a/e7c31adbe875f2abbb91bd84cf2dc52d792b5a01506781dbcf25c91daf11/six-1.16.0-py2.py3-none-any.whl
                sha256: 8abb2f1d86890a2dfb989f9a77cfcfd3e47c2a354b01111771326f8aa26e0254
                x-checker-data:
                  type: pypi
                  name: six
                  packagetype: bdist_wheel
            cleanup:
              - '*'
      - name: python-chardet
        buildsystem: simple
        build-commands: *python-pip-build-commands
        sources:
          - type: file
            url: https://files.pythonhosted.org/packages/4c/d1/1b96dd69fa42f20b70701b5cd42a75dd5f0c7a24dc0abfef35cc146210dc/chardet-5.0.0-py3-none-any.whl
            sha256: d3e64f022d254183001eccc5db4040520c0f23b1a3f33d6413e099eb7f126557
            x-checker-data:
              type: pypi
              name: chardet
              packagetype: bdist_wheel
        cleanup:
          - '*'

  - name: ranger-portable
    build-options: *musl-shared-build-options
    buildsystem: simple
    build-commands:
      - ln -s ${FLATPAK_DEST}/python/bin/ranger ranger-portable
      - |
        eval ${PYVARS} \
        pyinstaller --onedir \
          --collect-all ranger \
          --collect-all bidi \
          --collect-all chardet \
          --collect-all six \
          ranger-portable
      - cp -r dist/ranger-portable ${FLATPAK_DEST}/lib/
      - ln -s ../lib/ranger-portable/ranger-portable ${FLATPAK_DEST}/bin/ranger
    cleanup:
      - /python/lib/python*

  - name: vifm-static
    build-options: *musl-static-build-options
    config-opts:
      # actually used to set -I${vifm_cv_curses}/include/${curses_lib_name}
      - --with-curses=/usr/lib/sdk/devenv
    sources:
      - type: archive
        url: https://prdownloads.sourceforge.net/vifm/vifm-0.12.tar.bz2
        sha256: 33a9618f32b35b5b8c64483884f9ad09963ca8465b2935def79159028e27b2c0
        x-checker-data:
          type: html
          url: https://vifm.info/downloads.shtml
          version-pattern: vifm-([\d\.-]*).tar.bz2
          url-template: https://prdownloads.sourceforge.net/vifm/vifm-$version.tar.bz2
    cleanup:
      - /share/applications
      - /share/pixmaps


  ############################
  ####   Files: Search    ####
  ############################

  - name: broot-static-bin
    buildsystem: simple
    build-commands:
      - install -Dm755 x86_64-unknown-linux-musl/broot -t ${FLATPAK_DEST}/bin/
      - install -Dm644 broot.1 -t ${FLATPAK_DEST}/share/man/man1/
      - install -Dm644 completion/broot.bash ${FLATPAK_DEST}/share/bash-completion/completions/broot
      - install -Dm644 completion/broot.fish ${FLATPAK_DEST}/share/fish/vendor_completions.d/broot.fish
      - install -Dm644 completion/_broot ${FLATPAK_DEST}/share/zsh/site-functions/_broot
      - install -Dm644 resources/vscode.ttf -t ${FLATPAK_DEST}/share/fonts/vscode/
    sources:
      - type: archive
        strip-components: 0
        url: https://github.com/Canop/broot/releases/download/v1.14.2/broot_1.14.2.zip
        sha256: 4e9bc7d5bc793deec387700c2258339b51e2dd499b41c010f8e0027e6a5d854c
        x-checker-data:
          type: anitya
          project-id: 141357
          stable-only: true
          url-template: https://github.com/Canop/broot/releases/download/v$version/broot_$version.zip

  - name: fd-static-bin
    buildsystem: simple
    build-commands:
      - install -Dm755 fd -t ${FLATPAK_DEST}/bin/
      - install -Dm644 fd.1 -t ${FLATPAK_DEST}/share/man/man1/
      - install -Dm644 autocomplete/fd.bash ${FLATPAK_DEST}/share/bash-completion/completions/fd
      - install -Dm644 autocomplete/fd.fish ${FLATPAK_DEST}/share/fish/vendor_completions.d/fd.fish
      - install -Dm644 autocomplete/_fd ${FLATPAK_DEST}/share/zsh/site-functions/_fd
    sources:
      - type: archive
        url: https://github.com/sharkdp/fd/releases/download/v8.4.0/fd-v8.4.0-x86_64-unknown-linux-musl.tar.gz
        sha256: c27a193f8a7ad18c385bcea13e2a8764c8716a1d7fd89cbbdbd65212596fe5f8
        x-checker-data:
          type: anitya
          project-id: 16524
          stable-only: true
          url-template: https://github.com/sharkdp/fd/releases/download/v$version/fd-v$version-x86_64-unknown-linux-musl.tar.gz

  - name: fzf-static-bin
    buildsystem: simple
    build-commands:
      - install -Dm755 fzf bin/fzf-tmux -t ${FLATPAK_DEST}/bin/
      - install -Dm644 man/man1/* -t ${FLATPAK_DEST}/share/man/man1/
      - install -Dm644 shell/completion.bash ${FLATPAK_DEST}/share/bash-completion/completions/fzf
     #- install -Dm644 shell/completion.fish ${FLATPAK_DEST}/share/fish/vendor_completions.d/fzf.fish
      - install -Dm644 shell/completion.zsh ${FLATPAK_DEST}/share/zsh/site-functions/_fzf
      - install -Dm644 shell/key-bindings.{bash,zsh} -t ${FLATPAK_DEST}/share/fzf/
      - install -Dm644 shell/key-bindings.fish ${FLATPAK_DEST}/share/fish/vendor_functions.d/fzf_key_bindings.fish
      - install -Dm644 doc/fzf.txt -t ${FLATPAK_DEST}/share/vim/vimfiles/doc/
      - install -Dm644 plugin/fzf.vim -t ${FLATPAK_DEST}/share/vim/vimfiles/plugin/
    sources:
      - type: archive
        strip-components: 0
        url: https://github.com/junegunn/fzf/releases/download/0.33.0/fzf-0.33.0-linux_amd64.tar.gz
        sha256: bcf2f4ba957cce15cea1546f48cdd3bfe9b5dc9a6e80ccc400314bda171466f3
        x-checker-data:
          type: anitya
          project-id: 15856
          stable-only: true
          url-template: https://github.com/junegunn/fzf/releases/download/$version/fzf-$version-linux_amd64.tar.gz
      - type: archive
        url: https://github.com/junegunn/fzf/archive/0.33.0/fzf-0.33.0.tar.gz
        sha256: 136ddddfdb229631b08ea7e67be965bcf9c95f5fe1360b80b11f81aa64ba19ad
        x-checker-data:
          type: anitya
          project-id: 15856
          stable-only: true
          url-template: https://github.com/junegunn/fzf/archive/$version/fzf-$version.tar.gz

  - name: fzy-static
    build-options: *musl-static-build-options
    no-autogen: true
    make-install-args:
      - PREFIX=${FLATPAK_DEST}
    sources:
      - type: archive
        url: https://github.com/jhawthorn/fzy/archive/1.0/fzy-1.0.tar.gz
        sha256: 80257fd74579e13438b05edf50dcdc8cf0cdb1870b4a2bc5967bd1fdbed1facf
        x-checker-data:
          type: anitya
          project-id: 267539
          stable-only: true
          url-template: https://github.com/jhawthorn/fzy/archive/$version/fzy-$version.tar.gz

  - name: ripgrep-static-bin
    buildsystem: simple
    build-commands:
      - install -Dm755 rg -t ${FLATPAK_DEST}/bin/
      - install -Dm644 doc/rg.1 -t ${FLATPAK_DEST}/share/man/man1/
      - install -Dm644 complete/rg.bash ${FLATPAK_DEST}/share/bash-completion/completions/rg
      - install -Dm644 complete/rg.fish ${FLATPAK_DEST}/share/fish/vendor_completions.d/rg.fish
      - install -Dm644 complete/_rg ${FLATPAK_DEST}/share/zsh/site-functions/_rg
    sources:
      - type: archive
        url: https://github.com/BurntSushi/ripgrep/releases/download/13.0.0/ripgrep-13.0.0-x86_64-unknown-linux-musl.tar.gz
        sha256: ee4e0751ab108b6da4f47c52da187d5177dc371f0f512a7caaec5434e711c091
        x-checker-data:
          type: anitya
          project-id: 15461
          stable-only: true
          url-template: https://github.com/BurntSushi/ripgrep/releases/download/$version/ripgrep-$version-x86_64-unknown-linux-musl.tar.gz

  - name: skim-static-bin
    buildsystem: simple
    build-commands:
      - install -Dm755 sk bin/sk-tmux -t ${FLATPAK_DEST}/bin/
      - install -Dm644 man/man1/* -t ${FLATPAK_DEST}/share/man/man1/
      - install -Dm644 shell/completion.bash ${FLATPAK_DEST}/share/bash-completion/completions/sk
      - install -Dm644 shell/completion.zsh ${FLATPAK_DEST}/share/zsh/site-functions/_sk
      - install -Dm644 shell/key-bindings.{bash,zsh} -t ${FLATPAK_DEST}/share/skim/
      - install -Dm644 shell/key-bindings.fish ${FLATPAK_DEST}/share/fish/vendor_functions.d/skim_key_bindings.fish
      - install -Dm644 plugin/skim.vim -t ${FLATPAK_DEST}/share/vim/vimfiles/plugin/
    sources:
      - type: archive
        url: https://github.com/lotabout/skim/archive/v0.9.4/skim-0.9.4.tar.gz
        sha256: 5ec639c34c7657be4f7f990e9ad0d8d0a7a979eba68daa7c100126ce06702a1b
        x-checker-data:
          type: anitya
          project-id: 16131
          stable-only: true
          url-template: https://github.com/lotabout/skim/archive/v$version/skim-$version.tar.gz
      - type: archive
        strip-components: 0
        url: https://github.com/lotabout/skim/releases/download/v0.9.4/skim-v0.9.4-x86_64-unknown-linux-musl.tar.gz
        sha256: a73c94622d9aaab18f9a03a9bf7af0ca2f7059280ea3df24c09c1e7e0b359c32
        x-checker-data:
          type: anitya
          project-id: 16131
          stable-only: true
          url-template: https://github.com/lotabout/skim/releases/download/v$version/skim-v$version-x86_64-unknown-linux-musl.tar.gz

  - name: ugrep-static
    build-options: *musl-static-build-options
    config-opts:
      - --with-bzlib=/usr/lib/sdk/devenv
      - --with-lz4=/usr/lib/sdk/devenv
      - --with-lzma=/usr/lib/sdk/devenv
      - --with-pcre2=/usr/lib/sdk/devenv
      - --with-zlib=/usr/lib/sdk/devenv
      - --with-zstd=/usr/lib/sdk/devenv
    sources:
      - type: archive
        url: https://github.com/Genivia/ugrep/archive/v3.9.2/ugrep-3.9.2.tar.gz
        sha256: 3416267ac5a4dd2938ca91e7bd91db958d65510c9fd33b221f067bd3c6b3fc6a
        x-checker-data:
          type: anitya
          project-id: 187554
          stable-only: true
          url-template: https://github.com/Genivia/ugrep/archive/v$version/ugrep-$version.tar.gz

  - name: vgrep-static-bin
    buildsystem: simple
    build-commands:
      - install -Dm755 vgrep -t ${FLATPAK_DEST}/bin/
     #- go-md2man docs/vgrep.1.md docs/vgrep.1
      - md2roff docs/vgrep.1.md > docs/vgrep.1
      - install -Dm755 docs/vgrep.1 -t ${FLATPAK_DEST}/share/man/man1/
    sources:
      - type: file
        dest-filename: vgrep
        url: https://github.com/vrothberg/vgrep/releases/download/v2.6.1/vgrep_2.6.1_Linux_x86_64
        sha256: f5b42491d27e972f57a81295cf6ccf86b8e2bd28799271e6ee0fbceb46911875
        x-checker-data:
          type: anitya
          project-id: 106097
          stable-only: true
          url-template: https://github.com/vrothberg/vgrep/releases/download/v$version/vgrep_${version}_Linux_x86_64
      - type: archive
        url: https://github.com/vrothberg/vgrep/archive/v2.6.1/vgrep-2.6.1.tar.gz
        sha256: 61ffc1dc7445bd890a25a8bb733f7b33dc4de45388ae51c87db484def1c6f391
        x-checker-data:
          type: anitya
          project-id: 106097
          stable-only: true
          url-template: https://github.com/vrothberg/vgrep/archive/v$version/vgrep-$version.tar.gz


  ############################
  ####  Files: Trashcan   ####
  ############################

  # TODO: evaluate garbage @ https://git.sr.ht/~mzhang/garbage
  # NOTE: trash-cli is disabled as it's paritally broken
  # TODO: implement something better than trash-cli
# - name: rmtrash
#   buildsystem: simple
#   build-commands:
#     - install -Dm755 rmtrash rmdirtrash -t ${FLATPAK_DEST}/bin/
#   sources:
#     - type: archive
#       url: https://github.com/PhrozenByte/rmtrash/archive/v1.14/rmtrash-1.14.tar.gz
#       sha256: 119cf1a5e9c5ecadb95cfcc46999a5db6d55e0bb822f411c9a1b9c7d0cdf76b7
#       x-checker-data:
#         type: anitya
#         project-id: 267500
#         stable-only: true
#         url-template: https://github.com/PhrozenByte/rmtrash/archive/v$version/rmtrash-$version.tar.gz
#   modules:
#     - name: trash-cli
#       # TODO: patch to ignore XDG_DATA_HOME, might also need a workaround for not checking same fs in home
#       build-options: *musl-shared-build-options
#       buildsystem: simple
#       build-commands:
#         - eval ${PYVARS} pip3 install --exists-action=i --no-index --find-links=file://${PWD} --no-build-isolation
#           --prefix=${FLATPAK_DEST}/python trash-cli
#       sources:
#         - type: file
#           url: https://files.pythonhosted.org/packages/36/d2/6415cda6cdd81ee0eb07b357e96a03c96a78af324d7eb2c52ff51d080210/trash-cli-0.22.4.16.tar.gz
#           sha256: ec60ff1a038402f4b1e7360b32707bc36dc275fa32e512bb81274c0375d20003
#           x-checker-data:
#             type: pypi
#             name: trash-cli
#         - type: file
#           url: https://files.pythonhosted.org/packages/d6/de/0999ea2562b96d7165812606b18f7169307b60cd378bc29cf3673322c7e9/psutil-5.9.1.tar.gz
#           sha256: 57f1819b5d9e95cdfb0c881a8a5b7d542ed0b7c522d575706a80bedc848c8954
#           x-checker-data:
#             type: pypi
#             name: psutil
#       cleanup:
#         - '*'

# - name: trash-cli-portable
#   build-options: *musl-shared-build-options
#   buildsystem: simple
#   build-commands:
#     - |
#       for app in trash{,-empty,-list,-put,-restore,-rm}; do
#         ln -s ${FLATPAK_DEST}/python/bin/${app} ${app}
#       done
#    #- |
#    #  for app in trash{,-empty,-list,-put,-restore,-rm}; do
#    #    pyi-makespec ${app}
#    #  done
#     - eval ${PYVARS} pyinstaller trashcli.spec
#     - install -dm755 ${FLATPAK_DEST}/lib/trash-cli-portable
#     - |
#       for app in trash{,-empty,-list,-put,-restore,-rm}; do
#         cp -r dist/${app}/* ${FLATPAK_DEST}/lib/trash-cli-portable/
#       done
#     - |
#       for app in trash{,-empty,-list,-put,-restore,-rm}; do
#         ln -s ../lib/trash-cli-portable/${app} ${FLATPAK_DEST}/bin/${app}
#       done
#   sources:
#     - type: file
#       path: trashcli.spec
#   cleanup:
#     - /python/lib/python*


  ############################
  ####      Images        ####
  ############################

  - name: chafa-shared-bin
    buildsystem: simple
    no-make-install: true
    make-args:
      - chafa.1
    build-commands:
      - install -Dm755 bin/chafa -t ${FLATPAK_DEST}/bin/
      - install -Dm644 docs/chafa.1 -t ${FLATPAK_DEST}/share/man/man1/
    sources:
      - type: archive
        url: https://github.com/hpjansson/chafa/releases/download/1.12.3/chafa-1.12.3.tar.xz
        sha256: 2456a0b6c1150e25b64cd6a92810d59bed3f061f8b86f91aba5a77bc7cc76cfa
        x-checker-data:
          type: anitya
          project-id: 17542
          stable-only: true
          url-template: https://github.com/hpjansson/chafa/releases/download/$version/chafa-$version.tar.xz
      - type: archive
        dest: bin
        url: https://hpjansson.org/chafa/releases/static/chafa-1.12.3-1-x86_64-linux-gnu.tar.gz
        sha256: dba44781ff83bffb0eaaaf4a72381d956f52137d11e108b438da3a6ed7c9c668
        x-checker-data:
          type: anitya
          project-id: 17542
          stable-only: true
          url-template: https://hpjansson.org/chafa/releases/static/chafa-$version-1-x86_64-linux-gnu.tar.gz

  - name: gnome-epub-thumbnailer-static
    # TODO: should the gdk-pixbuf librsvg loader be statically linked?
    build-options: *musl-static-build-options
    # TODO: try droping libs after libarchive change
    make-args:
      - LIBS+=-llzma -lz -lssl -lcrypto -lzstd -lbz2
    sources:
      - type: archive
        url: https://download.gnome.org/sources/gnome-epub-thumbnailer/1.6/gnome-epub-thumbnailer-1.6.tar.xz
        sha256: b502420d9b02ea0b0fc7986ef5a091a12b2286be14fed9e47594fe9fa0c5898e
        x-checker-data:
          type: gnome
          name: gnome-epub-thumbnailer
          stable-only: true
    cleanup:
      - /share/thumbnailers

  - name: libsixel-static
    build-options: *musl-static-build-options
    buildsystem: meson
    config-opts:
      - --default-library=static
      - -Dimg2sixel=enabled
      - -Dsixel2png=disabled
      - -Dgdk-pixbuf2=disabled
      - -Dgd=disabled
      - -Dlibcurl=disabled
      - -Djpeg=disabled
      - -Dpng=disabled
    sources:
      - type: archive
        url: https://github.com/libsixel/libsixel/archive/2855eea71effe4d09890f4633f7dd568dbdfae3f/lixsixel-2855eea71effe4d09890f4633f7dd568dbdfae3f.zip
        sha256: 717be779849010e0a9d0d8e1057c4838978857113ce1487086c8204a79edccfa
        x-checker-data:
          type: anitya
          project-id: 243242
          stable-only: true
          versions:
            '>': 1.10.3
          url-template: https://github.com/libsixel/libsixel/archive/v$version/lixsixel-$version.zip
    cleanup:
      - /bin/libsixel-config

  - name: sic-static
    build-options: *musl-static-build-options
    buildsystem: simple
    build-commands: *cargo-build-commands
   #build-commands: # binary release (dynamic)
   #  - install -Dm755 sic -t ${FLATPAK_DEST}/bin/
    post-install:
      - install -Dm755 target/x86_64-unknown-linux-musl/release/sic -t ${FLATPAK_DEST}/bin/
      - install -Dm755 convert -t ${FLATPAK_DEST}/bin/
      - install -Dm644 sic.bash ${FLATPAK_DEST}/share/bash-completion/completions/sic
      - install -Dm644 sic.fish ${FLATPAK_DEST}/share/fish/vendor_completions.d/sic.fish
      - install -Dm644 _sic ${FLATPAK_DEST}/share/zsh/site-functions/_sic
    sources:
      - type: archive
        url: https://github.com/foresterre/sic/archive/v0.20.0/sic-0.20.0.tar.gz
        sha256: 77f2dca3788eeedbfd0af67e0e0ac78b6cddfe3f826075cbeaf30b60019fb09b
        x-checker-data:
          type: anitya
          project-id: 268144
          stable-only: true
          url-template: https://github.com/foresterre/sic/archive/v$version/sic-$version.tar.gz
      - type: archive
        strip-components: 0
        url: https://github.com/foresterre/sic/releases/download/v0.20.0/shell_completions.zip
        sha256: 45dbbc2af3eb18ae05d8aeeff748a15a052fb2fc3b4ca703c193df8aa0b0ee0b
        x-checker-data:
          type: anitya
          project-id: 268144
          stable-only: true
          url-template: https://github.com/foresterre/sic/releases/download/v$version/shell_completions.zip
      - sic-cargo-sources.json # flatpak-cargo-generator.py Cargo.lock -t -o sic-cargo-sources.json
      - type: file
        dest: .cargo
        dest-filename: config
        path: cargo-musl-config
      - type: script
        # get ranger-sixel working without imagemagick
        dest-filename: convert
        commands:
          # infile -geometry wxh sixel:-
          - exec sic --input "${1%\[0\]}" --resize "${3%x*}" "${3#*x}" --output-format
            BMP 2>/dev/null | img2sixel -
     #- type: archive # binary release (dynamic)
     #  strip-components: 0
     #  url: https://github.com/foresterre/sic/releases/download/v0.20.0/sic-0.20.0-x86_64-unknown-linux-gnu.zip
     #  sha256: dd75ef69e5495939ac81af93a29aea9228eb09f7f0c7757c1cf501ec0eb92f30
     #  x-checker-data:
     #    type: anitya
     #    project-id: 268144
     #    stable-only: true
     #    url-template: https://github.com/foresterre/sic/releases/download/v$version/sic-$version-x86_64-unknown-linux-gnu.zip


  ############################
  ####      Network       ####
  ############################

  - name: axel-static
    build-options: *musl-static-build-options
    config-opts:
      - --disable-nls
    sources:
      - type: archive
        url: https://github.com/axel-download-accelerator/axel/releases/download/v2.17.11/axel-2.17.11.tar.gz
        sha256: f12682f981c83f374b82b0668f25f694a2042b617b236ee6fb057e5473c54e31
        x-checker-data:
          type: anitya
          project-id: 9344
          stable-only: true
          url-template: https://github.com/axel-download-accelerator/axel/releases/download/v$version/axel-$version.tar.gz

  - name: bind-static
    # TODO: fix symlink creation in /bin
    # TODO: binaries are broken
    build-options: *musl-static-build-options
    config-opts:
      - --sbindir=${prefix}/bin
      - --enable-static
      - --disable-shared
      - --enable-developer
      - --disable-warn-error
    # TODO: enable more features
     #- --with-jemalloc
     #- --with-json-c
     #- --with-libidn2
     #- --with-lmdb
     #- --with-maxminddb
      - --disable-chroot
      - --disable-linux-caps
      - --enable-geoip
      - --enable-doh
      - --enable-fixed-rrset
      - --enable-full-report
      - --with-gssapi
      - --with-libnghttp2
      - --with-libxml2
      - --with-openssl
      - --with-readline
      - --with-zlib
      - --without-cmocka
    make-args:
      - CCLD=$(CC) -all-static
    make-install-args:
      # workaround for buildsystem making unneeded filesystem changes after install and breaking rofiles
      - DESTDIR=${FLATPAK_BUILDER_BUILDDIR}/target
    post-install:
      - cp -r target/${FLATPAK_DEST}/* ${FLATPAK_DEST}/
    sources:
      - type: archive
        url: https://downloads.isc.org/isc/bind9/9.18.6/bind-9.18.6.tar.xz
        sha256: d43a0fed03c774d1685d203598218c0b7774a88fcc390a0170710d5feb7fbff1
        x-checker-data:
          type: anitya
          project-id: 14923
          stable-only: true
          url-template: https://downloads.isc.org/isc/bind9/$version/bind-$version.tar.xz
      - type: shell
        commands:
          - sed -i 's/\(^READLINE_LIBS.*=.*\)/\1 -lncursesw/' $(find . -name Makefile.in)
          - sed -i '/GSSAPI_LIBS=/ s/\(`.*--libs gssapi`\)/"\1 -lkrb5support -lkrb5_spake
            -lkrb5_pkinit"/' configure
          - sed -i '/KRB5_LIBS=/ s/\(`.*--libs krb5`\)/"\1 -lkrb5support -lkrb5_spake
            -lkrb5_pkinit"/' configure
    cleanup:
      - /lib
      - '*' # TODO: remove after fixing the module
    modules:
      - name: libnghttp2-static
        build-options: *musl-static-build-options
        config-opts:
          - --disable-shared
          - --enable-lib-only
        sources:
          - type: archive
            url: https://github.com/nghttp2/nghttp2/releases/download/v1.49.0/nghttp2-1.49.0.tar.gz
            sha256: 14dd5654e369227afebfba5198793a1788a0af9d30cddb19af3ec275d110a7a6
            x-checker-data:
              type: anitya
              project-id: 8651
              stable-only: true
              url-template: https://github.com/nghttp2/nghttp2/releases/download/v$version/nghttp2-$version.tar.gz
        cleanup:
          - '*'

  - name: lynx-static
    build-options: *musl-static-build-options
    config-opts:
      - --disable-nls
      - --with-screen=ncursesw
      - --with-curses-dir=${prefix}
      - --enable-widec
    sources:
      - type: archive
        url: https://invisible-mirror.net/archives/lynx/tarballs/lynx2.8.9rel.1.tar.gz
        sha256: a46e4167b8f02c066d2fe2eafcc5603367be0e3fe2e59e9fc4eb016f306afc8e
        x-checker-data:
          type: html
          url: https://lynx.invisible-island.net
          # TODO: improve matching pattern
          version-pattern: lynx([\d.]+)
          url-template: https://invisible-mirror.net/archives/lynx/tarballs/lynx${version}rel.1.tar.gz
    cleanup:
      - '*'

  - name: mutt-static
    build-options: *musl-static-build-options
    config-opts:
      # TODO: move mail folder to home
      - --disable-nls
      - --enable-autocrypt
      - --enable-gpgme
      - --enable-sidebar
      - --enable-compressed
      - --enable-pop
      - --enable-imap
      - --enable-smtp
      - --enable-debug
      - --enable-flock
      - --enable-mailtool
      - --enable-hcache
      - --with-sqlite3
      - --with-mixmaster
      - --with-curses=ncursesw
     #- --with-homespool=
      - --with-mailpath=/var/mail
      - --with-gss
      - --with-zlib
      - --with-ssl
      - --with-sasl
      - --with-gdbm
      - --with-idn2
    post-install:
      - rm -f ${FLATPAK_DEST}/include/ncurses
    sources:
      - type: archive
        url: http://ftp.mutt.org/pub/mutt/mutt-2.2.7.tar.gz
        sha256: eb13858f58bb369f477bf652d90e9b6aaddd0d610acbea3455049e5efad36df1
        x-checker-data:
          type: anitya
          project-id: 2035
          stable-only: true
          url-template: http://ftp.mutt.org/pub/mutt/mutt-$version.tar.gz
      - type: shell
        commands:
          - ln -s ncursesw ${FLATPAK_DEST}/include/ncurses
          - |
            sed -i '/^for ac_lib in .* $sasl_libs/,/^done/{ s/\(="-l$ac_lib\)/\1 -lssl -lcrypto -lgdbm -lgdbm_compat/;'\
            's/=\(-l$ac_lib.*\)/="\1 -lssl -lcrypto -lgdbm -lgdbm_compat"/ }' \
            configure
          - sed -i '/GSSAPI_LIBS=/ s/\(--libs gssapi`\)/\1 -lkrb5support -lkrb5_spake
            -lkrb5_pkinit/' configure

  - name: openbsd-netcat-static
    build-options: *musl-static-build-options
    no-autogen: true
    no-make-install: true
    make-args:
      - CFLAGS+=-I${FLATPAK_DEST}/include -I${FLATPAK_DEST}/include/libbsd
      - LIBS+=-L${FLATPAK_DEST}/lib -lbsd -lmd
    build-commands:
      - install -Dm755 nc -t ${FLATPAK_DEST}/bin/
      - install -Dm644 nc.1 -t ${FLATPAK_DEST}/share/man/man1/
    sources:
      - type: archive
        url: https://salsa.debian.org/debian/netcat-openbsd/-/archive/debian/1.218-5/netcat-openbsd-debian-1.218-5.tar.gz
        sha256: e966b598e8af34141e9993c0434cafc83fb707f8ace900fb7c4e758889653c08
        x-checker-data:
          type: anitya
          project-id: 279972
          stable-only: true
          url-template: https://salsa.debian.org/debian/netcat-openbsd/-/archive/debian/$version/netcat-openbsd-debian-$version.tar.gz
      - type: shell
        commands:
          - |
            while read -r line; do
              patch -Np1 -i "debian/patches/${line}"
            done < debian/patches/series
      - type: patch
        # NOTE: missing non-standard glibc's b64_ntop in libc
        # https://gitweb.gentoo.org/repo/gentoo.git/tree/net-analyzer/openbsd-netcat
        path: openbsd-netcat-1.105-musl-b64_ntop.patch
    modules:
      - name: libbsd-static
        build-options: *musl-static-build-options
        config-opts:
          - --disable-shared
        sources:
          - type: archive
            url: https://libbsd.freedesktop.org/releases/libbsd-0.11.6.tar.xz
            sha256: 19b38f3172eaf693e6e1c68714636190c7e48851e45224d720b3b5bc0499b5df
            x-checker-data:
              type: anitya
              project-id: 1567
              stable-only: true
              url-template: https://libbsd.freedesktop.org/releases/libbsd-$version.tar.xz
        cleanup:
          - '*'
        modules:
          - name: libmd-static
            build-options: *musl-static-build-options
            config-opts:
              - --disable-shared
            sources:
              - type: archive
                url: https://libbsd.freedesktop.org/releases/libmd-1.0.4.tar.xz
                sha256: f51c921042e34beddeded4b75557656559cf5b1f2448033b4c1eec11c07e530f
                x-checker-data:
                  type: anitya
                  project-id: 15525
                  stable-only: true
                  url-template: https://libbsd.freedesktop.org/releases/libmd-$version.tar.xz
            cleanup:
              - '*'

  - name: socat-static
    build-options: *musl-static-build-options
    sources:
      - type: archive
        url: http://www.dest-unreach.org/socat/download/socat-1.7.4.3.tar.gz
        sha256: d697245144731423ddbbceacabbd29447089ea223e9a439b28f9ff90d0dd216e
        x-checker-data:
          type: anitya
          project-id: 4848
          stable-only: true
          url-template: http://www.dest-unreach.org/socat/download/socat-$version.tar.gz
      - type: shell
        commands:
          - sed -i '/HAVE_GETPROTOBYNUMBER_R/d' config.h.in

  - name: traceroute-static
    build-options: *musl-static-build-options
    no-autogen: true
    make-install-args:
      - prefix=${FLATPAK_DEST}
    sources:
      - type: archive
        url: https://downloads.sourceforge.net/traceroute/traceroute-2.1.0.tar.gz
        sha256: 3669d22a34d3f38ed50caba18cd525ba55c5c00d5465f2d20d7472e5d81603b6
        x-checker-data:
          type: anitya
          project-id: 14877
          stable-only: true
          url-template: https://downloads.sourceforge.net/traceroute/traceroute-$version.tar.gz
      - type: shell
        commands:
          - sed -i '/call set, \(CC\|CFLAGS\|CPPFLAGS\|LDFLAGS\),/d' Make.rules

  - name: whois-static
    build-options: *musl-static-build-options
    no-autogen: true
    make-install-args:
      - prefix=${FLATPAK_DEST}
    sources:
      - type: archive
        url: https://github.com/rfc1036/whois/archive/v5.5.13/who-is-5.5.13.tar.gz
        sha256: a96cf60722e5c3962f8abef36184a101011447d3fe5fa053ea97f593826568fb
        x-checker-data:
          type: anitya
          project-id: 5128
          stable-only: true
          url-template: https://github.com/rfc1036/whois/archive/v$version/who-is-$version.tar.gz
      - type: shell
        commands:
          - sed -i '/install:/ s/ install-pos//' Makefile

  - name: wol-static
    build-options: *musl-static-build-options
    config-opts:
      - --infodir=${prefix}/share/info
      - --mandir=${prefix}/share/man
      - --disable-nls
    sources:
      - type: archive
        url: https://downloads.sourceforge.net/ahh/wol-0.7.1.tar.gz
        sha256: e0086c9b9811df2bdf763ec9016dfb1bcb7dba9fa6d7858725b0929069a12622
        x-checker-data:
          type: anitya
          project-id: 5139
          stable-only: true
          url-template: https://downloads.sourceforge.net/ahh/wol-$version.tar.gz
      - type: shell
        commands:
          - sed -i 's/\(# if __GLIBC__ .*\)/\1 \&\& defined __GNU_LIBRARY__/' lib/getline.h

  - name: websocat-static-bin
    buildsystem: simple
    build-commands:
      - install -Dm755 websocat -t ${FLATPAK_DEST}/bin/
    sources:
      - type: file
        dest-filename: websocat
        url: https://github.com/vi/websocat/releases/download/v1.10.0/websocat.x86_64-unknown-linux-musl
        sha256: b3dd771cf71a74e732ff99cf397b4cc62fc000e989d46c4dfbec1b86cc051896
        x-checker-data:
          type: anitya
          project-id: 280067
          stable-only: true
          url-template: https://github.com/vi/websocat/releases/download/v$version/websocat.x86_64-unknown-linux-musl


  ############################
  ####     Processes      ####
  ############################

  - name: btop-static
    build-options: *musl-static-build-options
    no-autogen: true
    make-args:
      - CXX:=$(CXX)
      - STATIC=true
    make-install-args:
      - PREFIX=${FLATPAK_DEST}
    post-install:
      - mv ${FLATPAK_DEST}/bin/btop{,-sandbox}
    sources:
      - type: archive
        url: https://github.com/aristocratos/btop/archive/v1.2.9/btop-1.2.9.tar.gz
        sha256: 0f8c3434a9c4c132a34415a9cc4f048595b8a4d1a94e94223ac3a795e1c16531
        x-checker-data:
          type: anitya
          project-id: 253331
          stable-only: true
          url-template: https://github.com/aristocratos/btop/archive/v$version/btop-$version.tar.gz
    cleanup:
      - /share/applications
      - /share/icons

  - name: htop-static
    build-options: *musl-static-build-options
    config-opts:
      # TODO: revisit features
      - --enable-static
      - --enable-unicode
      - --enable-affinity
      - --disable-unwind
      - --disable-hwloc
      - --disable-capabilities
      - --disable-delayacct
      - --disable-sensors
    post-install:
      - mv ${FLATPAK_DEST}/bin/htop{,-sandbox}
    sources:
      - type: archive
        url: https://github.com/htop-dev/htop/releases/download/3.2.1/htop-3.2.1.tar.xz
        sha256: 5a17121cf1c69d2f2e557c0b29d45a2c353ab983f644742e1c2e4ece15aa6cbb
        x-checker-data:
          type: anitya
          project-id: 1332
          stable-only: true
          url-template: https://github.com/htop-dev/htop/releases/download/$version/htop-$version.tar.xz
    cleanup:
      - /share/applications
      - /share/icons
      - /share/pixmaps

  - name: psmisc-static
    build-options: *musl-static-build-options
    config-opts:
      - --disable-nls
    make-args:
      - CFLAGS+=-I${FLATPAK_DEST}/include/ncursesw
    sources:
      - type: archive
        url: https://downloads.sourceforge.net/psmisc/psmisc-23.5.tar.xz
        sha256: dc37ecc2f7e4a90a94956accc6e1c77adb71316b7c9cbd39b26738db0c3ae58b
        x-checker-data:
          type: anitya
          project-id: 3721
          stable-only: true
          url-template: https://downloads.sourceforge.net/psmisc/psmisc-$version.tar.xz
      - type: shell
        commands:
          - sed -i '/^install-data-am/ s/install-data-local //' man-po/Makefile.in


  ############################
  ####        Perl        ####
  ############################

  - name: plenv
    buildsystem: simple
    build-commands:
      - install -dm755 ${FLATPAK_DEST}/{bin,lib/plenv/hooks}
      - ln -s ../lib/plenv/plenv ${FLATPAK_DEST}/bin/plenv
      - install -Dm755 libexec/* ${FLATPAK_DEST}/lib/plenv/
      - install -Dm644 completions/plenv.bash ${FLATPAK_DEST}/share/bash-completion/completions/plenv
      - install -Dm644 completions/plenv.fish ${FLATPAK_DEST}/share/fish/vendor_completions.d/plenv.fish
      - install -Dm644 completions/plenv.zsh ${FLATPAK_DEST}/share/zsh/site-functions/_plenv
      - cp -r plenv.d/* ${FLATPAK_DEST}/lib/plenv/hooks/
    sources:
      - type: archive
        url: https://github.com/tokuhirom/plenv/archive/2.3.1/plenv-2.3.1.tar.gz
        sha256: 12004cfed7ed083911dbda3228a9fb9ce6e40e259b34e791d970c4f335935fa3
        x-checker-data:
          type: anitya
          project-id: 283242
          stable-only: true
          url-template: https://github.com/tokuhirom/plenv/archive/$version/plenv-$version.tar.gz
      - type: shell
        commands:
          # TODO: /var/lib/devenv should be added conditionally
          - sed -i '/^hook_path=/ s#/usr\(/lib/plenv/hooks\)#/var/lib/devenv\1:'${FLATPAK_DEST}'\1#'
            libexec/plenv


  ############################
  ####      Python        ####
  ############################

# - name: miniconda
#   buildsystem: simple
#   build-commands:
#     - bash ./miniconda-installer.sh -b -p ${FLATPAK_DEST}/lib/miniconda -f
#     - ln -s ../lib/miniconda/conda ${FLATPAK_DEST}/bin/conda
#   sources:
#     - type: file
#       dest-filename: miniconda-installer.sh
#       url: https://repo.anaconda.com/miniconda/Miniconda3-py39_4.12.0-Linux-x86_64.sh
#       sha256: 78f39f9bae971ec1ae7969f0516017f2413f17796670f7040725dd83fcff5689
#       x-checker-data:
#         type: html
#         url: https://repo.anaconda.com/miniconda/
#         version-pattern: Miniconda3-py([\d\._]+)-Linux-x86_64.sh
#         url-template: https://repo.anaconda.com/miniconda/Miniconda3-py$version-Linux-x86_64.sh

  - name: pyenv
    # TODO: consider adding more plugins https://github.com/pyenv/pyenv/wiki/Plugins
    buildsystem: simple
    build-commands:
      - install -dm755 ${FLATPAK_DEST}/share/pyenv
      - cp -a libexec plugins pyenv.d ${FLATPAK_DEST}/share/pyenv/
      - ln -sr ${FLATPAK_DEST}/share/pyenv/{libexec/pyenv,plugins/python-build/bin/*}
        -t ${FLATPAK_DEST}/bin/
      - install -Dm644 completions/pyenv.bash ${FLATPAK_DEST}/share/bash-completion/completions/pyenv
      - install -Dm644 completions/pyenv.fish -t ${FLATPAK_DEST}/share/fish/vendor_completions.d/
      - install -Dm644 completions/pyenv.zsh ${FLATPAK_DEST}/share/zsh/site-functions/_pyenv
      - install -Dm644 man/man1/pyenv.1 -t ${FLATPAK_DEST}/share/man/man1/
    sources:
      - type: archive
        url: https://github.com/pyenv/pyenv/archive/v2.3.3/pyenv-2.3.3.tar.gz
        sha256: 2a6093c922d2a420b5ae45143ab973b0a85ee486c408cb487188b64edadfab35
        x-checker-data:
          type: json
          url: https://api.github.com/repos/pyenv/pyenv/releases/latest
          version-query: .tag_name | sub("^v"; "")
          url-query: '"https://github.com/pyenv/pyenv/archive/v" + $version + "/pyenv-"
            + $version + ".tar.gz"'
    cleanup:
      - /share/pyenv/pyenv.d/install
      - /share/pyenv/plugins/python-build/scripts
      - /share/pyenv/plugins/python-build/test
      - .gitignore
      - LICENSE
      - README.md
      - install.sh

  - name: pyenv-virtualenv
    buildsystem: simple
    build-commands:
      - PREFIX=${FLATPAK_DEST}/share/pyenv/plugins/pyenv-virtualenv ./install.sh
    sources:
      - type: archive
        url: https://github.com/pyenv/pyenv-virtualenv/archive/c6ff093344a3823d8b07c90a6478942d44d0392e/pyenv-virtualenv-c6ff093344a3823d8b07c90a6478942d44d0392e.tar.gz
        sha256: 7973aa557072a437415cd4151eafaba1587d505725d185892b6a7db7103b561c
        x-checker-data:
          type: json
          url: https://api.github.com/repos/pyenv/pyenv-virtualenv/commits?sha=master&per_page=1
          version-query: .[].sha
          timestamp-query: .[].commit.committer.date
          url-query: '"https://github.com/pyenv/pyenv-virtualenv/archive/" + $version
            + "/pyenv-virtualenv-" + $version + ".tar.gz"'

  - name: pyflow-static
    build-options: *musl-static-build-options
    buildsystem: simple
    build-commands: *cargo-build-commands
   #build-commands: # binary release (dynamic)
   #  - install pyflow -Dm755 -t ${FLATPAK_DEST}/bin/
    post-install:
      - install -Dm755 target/x86_64-unknown-linux-musl/release/pyflow -t ${FLATPAK_DEST}/bin/
    sources:
      - type: archive
        url: https://github.com/David-OConnor/pyflow/archive/0.3.1/pyflow-0.3.1.tar.gz
        sha256: 36be46aaebf7bc77d2f250b3646024fb1f2f04d92113d3ce46ea5846f7e4c4f4
        x-checker-data:
          type: anitya
          project-id: 47970
          stable-only: true
          url-template: https://github.com/David-OConnor/pyflow/archive/$version/pyflow-$version.tar.gz
      - pyflow-cargo-sources.json # flatpak-cargo-generator.py Cargo.lock -t -o pyflow-cargo-sources.json
      - type: file
        dest: .cargo
        dest-filename: config
        path: cargo-musl-config
     #- type: file # binary release (dynamic)
     #  url: https://github.com/David-OConnor/pyflow/releases/download/0.3.1/pyflow
     #  sha256: 0f1bc273af07fb7a3c46ca84302403b41b8ea6787e62c79adb04a4674b87edf5
     #  x-checker-data:
     #    type: anitya
     #    project-id: 47970
     #    stable-only: true
     #    url-template: https://github.com/David-OConnor/pyflow/releases/download/$version/pyflow


  ############################
  ####      Security      ####
  ############################

  - name: gocryptfs-static-bin
    buildsystem: simple
    build-commands:
      - install -Dm755 gocryptfs{,-xray} -t ${FLATPAK_DEST}/bin/
      - install -Dm644 gocryptfs{,-xray}.1 -t ${FLATPAK_DEST}/share/man/man1/
    sources:
      - type: archive
        strip-components: 0
        url: https://github.com/rfjakob/gocryptfs/releases/download/v2.3/gocryptfs_v2.3_linux-static_amd64.tar.gz
        sha256: 7721032d941c798d26c86fe58348701ce2f8fbda7a25061d28c2a031444cca1e
        x-checker-data:
          type: anitya
          project-id: 21085
          stable-only: true
          url-template: https://github.com/rfjakob/gocryptfs/releases/download/v$version/gocryptfs_v${version}_linux-static_amd64.tar.gz

  - name: gpg-tui-static
    build-options: *musl-static-build-options
    buildsystem: simple
    build-commands: *cargo-build-commands
   #build-commands: # binary release (dynamic)
   #  - install -Dm755 gpg-tui -t ${FLATPAK_DEST}/bin/
    post-install:
      - install -Dm755 target/x86_64-unknown-linux-musl/release/gpg-tui -t ${FLATPAK_DEST}/bin/
      - install -Dm644 man/*.1 -t ${FLATPAK_DEST}/share/man/man1/
      - install -Dm644 man/*.5 -t ${FLATPAK_DEST}/share/man/man5/
      - mkdir completions && OUT_DIR=completions target/x86_64-unknown-linux-musl/release/gpg-tui-completions
      - install -Dm644 completions/gpg-tui.bash ${FLATPAK_DEST}/share/bash-completion/completions/gpg-tui
      - install -Dm644 completions/gpg-tui.fish ${FLATPAK_DEST}/share/fish/vendor_completions.d/gpg-tui.fish
      - install -Dm644 completions/_gpg-tui ${FLATPAK_DEST}/share/zsh/site-functions/_gpg-tui
    sources:
      - type: archive
        url: https://github.com/orhun/gpg-tui/archive/v0.9.1/gpg-tui-0.9.1.tar.gz
        sha256: 876d9dd34e575c230fc63558e5974830b71a4c092a885526dfdbc19aba31c610
        x-checker-data:
          type: anitya
          project-id: 236270
          stable-only: true
          url-template: https://github.com/orhun/gpg-tui/archive/v$version/gpg-tui-$version.tar.gz
      - gpg-tui-cargo-sources.json # flatpak-cargo-generator.py Cargo.lock -t -o gpg-tui-cargo-sources.json
      - type: file
        dest: .cargo
        dest-filename: config
        path: gpg-tui-cargo-config
     #- type: archiv # binary release (dynamic)e
     #  url: https://github.com/orhun/gpg-tui/releases/download/v0.9.1/gpg-tui-0.9.1-x86_64-unknown-linux-gnu.tar.gz
     #  sha256: 6a2dec4cc19a374d8d0742af709cf92153766383778a1e207d139427ae29e96c
     #  x-checker-data:
     #    type: anitya
     #    project-id: 236270
     #    stable-only: true
     #    url-template: https://github.com/orhun/gpg-tui/releases/download/v$version/gpg-tui-$version-x86_64-unknown-linux-gnu.tar.gz

  - name: paperkey-static
    build-options: *musl-static-build-options
    sources:
      - type: archive
        url: https://www.jabberwocky.com/software/paperkey/paperkey-1.6.tar.gz
        sha256: a245fd13271a8d2afa03dde979af3a29eb3d4ebb1fbcad4a9b52cf67a27d05f7
        x-checker-data:
          type: anitya
          project-id: 8571
          stable-only: true
          url-template: https://www.jabberwocky.com/software/paperkey/paperkey-$version.tar.gz

  - name: pwgen-static
    build-options: *musl-static-build-options
    sources:
      - type: archive
        url: http://downloads.sourceforge.net/pwgen/pwgen-2.08.tar.gz
        sha256: dab03dd30ad5a58e578c5581241a6e87e184a18eb2c3b2e0fffa8a9cf105c97b
        x-checker-data:
          type: anitya
          project-id: 3738
          stable-only: true
          url-template: http://downloads.sourceforge.net/pwgen/pwgen-$version.tar.gz

  - name: qrencode-static
    build-options: *musl-static-build-options
    config-opts:
      - --enable-static
      - --disable-shared
    sources:
      - type: archive
        url: https://fukuchi.org/works/qrencode/qrencode-4.1.1.tar.gz
        sha256: da448ed4f52aba6bcb0cd48cac0dd51b8692bccc4cd127431402fca6f8171e8e
        x-checker-data:
          type: anitya
          project-id: 12834
          stable-only: true
          url-template: https://fukuchi.org/works/qrencode/qrencode-$version.tar.gz
      - type: shell
        commands:
          - sed -i 's/\($(CCLD)\)/\1 -all-static/' Makefile.in


  ############################
  ####       Shells       ####
  ############################

  - name: bash-static
    build-options: *musl-static-build-options
    config-opts:
      - --enable-static-link
      - --enable-readline
      - --disable-nls
      - --with-curses
      - --with-installed-readline
      - --without-bash-malloc
    make-args:
      - TERMCAP_LIB=-lncursesw
    sources:
      - type: archive
        url: https://ftp.gnu.org/gnu/bash/bash-5.1.16.tar.gz
        sha256: 5bac17218d3911834520dad13cd1f85ab944e1c09ae1aba55906be1f8192f558
        x-checker-data:
          type: anitya
          project-id: 166
          stable-only: true
          url-template: https://ftp.gnu.org/gnu/bash/bash-$version.tar.gz
      - type: patch
        path: bash-config-top.h-set-devenv-defaults.patch
      - type: patch
        path: bash-add-localstatedir-bashrc-support.patch
      - type: shell
        commands:
          # never build these libs
          - rm -r lib/{readline,termcap}/*.c

  - name: bash-completion
    sources:
      - type: archive
        url: https://github.com/scop/bash-completion/releases/download/2.11/bash-completion-2.11.tar.xz
        sha256: 73a8894bad94dee83ab468fa09f628daffd567e8bef1a24277f1e9a0daf911ac
        x-checker-data:
          type: anitya
          project-id: 5667
          stable-only: true
          url-template: https://github.com/scop/bash-completion/releases/download/$version/bash-completion-$version.tar.xz
      - type: shell
        commands:
          - sed -i '/^pkgconfigdir.*=/ s/datadir/libdir/' Makefile.in

  - name: bash-complete-alias
    buildsystem: simple
    build-commands:
      - install -Dm644 complete_alias -t ${FLATPAK_DEST}/share/bash-complete-alias/
    sources:
      - type: archive
        url: https://github.com/cykerway/complete-alias/archive/1.18.0/complete-alias-1.18.0.tar.gz
        sha256: c34b85c2729650415d97280afeeed6aa29a9e318a8a39061722493cacb927445
        x-checker-data:
          type: anitya
          project-id: 267535
          stable-only: true
          url-template: https://github.com/cykerway/complete-alias/archive/$version/complete-alias-$version.tar.gz

  - name: fish-static
    # TODO: fix ncurses detection to avoid cxxflags definition
   #build-options: *musl-static-build-options
    build-options:
      cflags: -static -static-pie -fPIC
      cxxflags: -static -static-pie -fPIC -DHAVE_NCURSES_H -DHAVE_TERM_H
      ldflags: -static -static-pie -fPIC -Wl,-fuse-ld=mold
      env: *musl-toolchain-environment
    buildsystem: cmake
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -Wno-dev
      - -DWITH_GETTEXT=OFF
      - -DSYS_PCRE2_INCLUDE_DIR=/usr/lib/sdk/devenv/include
      - -DSYS_PCRE2_LIB=/usr/lib/sdk/devenv/lib/libpcre2-32.a
      - -DNCURSES_INCLUDE_DIRS=/usr/lib/sdk/devenv/include/ncursesw
      - -DTPARM_INCLUDES=/usr/lib/sdk/devenv/include/ncursesw/term.h
      - -DNCURSES_LIBRARY=/usr/lib/sdk/devenv/lib/libncursesw.a
      - -DCURSES_TINFO=/usr/lib/sdk/devenv/lib/libncursesw.a
     #- -DCMAKE_CXX_FLAGS=-DHAVE_NCURSES_H -DHAVE_TERM_H
      - -DTPUTS_USES_INT_ARG=1
    sources:
      - type: archive
        url: https://github.com/fish-shell/fish-shell/releases/download/3.5.1/fish-3.5.1.tar.xz
        sha256: a6d45b3dc5a45dd31772e7f8dfdfecabc063986e8f67d60bd7ca60cc81db6928
        x-checker-data:
          type: anitya
          project-id: 815
          stable-only: true
          url-template: https://github.com/fish-shell/fish-shell/releases/download/$version/fish-$version.tar.xz
      - type: shell
        commands:
          - sed -i '/Fish does not support static linking/ s/FATAL_ERROR/WARNING/'
            CMakeLists.txt
    cleanup:
      - /etc
      - /share/applications
      - /share/pixmaps

  - name: zsh-static
    # TODO: check ncurses detection in configure
    build-options: *musl-static-build-options
    config-opts:
      # TODO: edit config.modules to compile modules
      # sed_i 's/link=no/link=static/' config.modules
      - --enable-libc-musl
      - --disable-dynamic
      - --docdir=${FLATPAK_DEST}/share/doc/zsh
      - --htmldir=${FLATPAK_DEST}/share/doc/zsh/html
      - --enable-etcdir=${FLATPAK_DEST}/etc/zsh
      - --enable-zshenv=${FLATPAK_DEST}/etc/zsh/zshenv
      - --enable-zlogin=${FLATPAK_DEST}/etc/zsh/zlogin
      - --enable-zlogout=${FLATPAK_DEST}/etc/zsh/zlogout
      - --enable-zprofile=${FLATPAK_DEST}/etc/zsh/zprofile
      - --enable-zshrc=${FLATPAK_DEST}/etc/zsh/zshrc
      - --enable-maildir-support
      - --enable-multibyte
      - --enable-function-subdirs
      - --enable-fndir=${FLATPAK_DEST}/share/zsh/functions
      - --enable-scriptdir=${FLATPAK_DEST}/share/zsh/scripts
      - --with-tcsetpgrp
#     - --enable-pcre
#     - --enable-cap
#     - --enable-zsh-secure-free
    post-install:
     # unneeded filesystem (mv) operations on ${FLATPAK_DEST}/bin/zsh breaks rofiles, overwriting the file fix this
      - install -Dm755 ${FLATPAK_DEST}/bin/zsh{-*,}
    sources:
      - type: archive
        url: https://www.zsh.org/pub/zsh-5.9.tar.xz
        sha256: 9b8d1ecedd5b5e81fbf1918e876752a7dd948e05c1a0dba10ab863842d45acd5
        x-checker-data:
          type: anitya
          project-id: 5307
          stable-only: true
          url-template: https://www.zsh.org/pub/zsh-$version.tar.xz
    modules:
      - name: libcap-static
        build-options: *musl-static-build-options
        no-autogen: true
        subdir: libcap
        make-args:
          - SHARED=no
          - prefix=${FLATPAK_DEST}
          - lib=lib
        make-install-args:
          - SHARED=no
          - prefix=${FLATPAK_DEST}
          - lib=lib
        sources:
          - type: archive
            url: https://kernel.org/pub/linux/libs/security/linux-privs/libcap2/libcap-2.65.tar.xz
            sha256: 73e350020cc31fe15360879d19384ffa3395a825f065fcf6bda3a5cdf965bebd
            x-checker-data:
              type: anitya
              project-id: 1569
              stable-only: true
              url-template: https://kernel.org/pub/linux/libs/security/linux-privs/libcap2/libcap-$version.tar.xz

  - name: powerline-fonts
    # TODO: generate updated patched fonts with https://github.com/powerline/fontpatcher
    buildsystem: simple
    build-commands:
      # fc-match: Noto Mono for Powerline
      - install -Dm644 NotoMono/Noto\ Mono\ for\ Powerline.ttf ${FLATPAK_DEST}/share/fonts/powerline/NotoSansMonoPowerline.ttf
    sources:
      - type: archive
        url: https://github.com/powerline/fonts/archive/4622ed562eb077e502524c8a1add6d5454a057b7/powerline-4622ed562eb077e502524c8a1add6d5454a057b7.tar.gz
        sha256: 7f98d7e313d44f49c7637ce43469918cf6ba1fae1398ff5603392f7d2bc916c0
        x-checker-data:
          type: json
          url: https://api.github.com/repos/powerline/fonts/commits?sha=master&path=NotoMono&per_page=1
          version-query: .[].sha
          timestamp-query: .[].commit.committer.date
          url-query: '"https://github.com/powerline/fonts/archive/" + $version + "/powerline-"
            + $version + ".tar.gz"'

  - name: powerline-go-static-bin
    buildsystem: simple
    build-commands:
      - install -Dm755 powerline-go -t ${FLATPAK_DEST}/bin/
    sources:
      - type: file
        dest-filename: powerline-go
        url: https://github.com/justjanne/powerline-go/releases/download/v1.22.1/powerline-go-linux-amd64
        sha256: 1cdd4fdb5dea23fc25d59e4cc845960c60bf8ead0e9b004351ee3479d805ecb4
        x-checker-data:
          type: anitya
          project-id: 16076
          stable-only: true
          url-template: https://github.com/justjanne/powerline-go/releases/download/v$version/powerline-go-linux-amd64


  ############################
  ### Shells: Multiplexers ###
  ############################

  - name: libutempter-static
    build-options: *musl-static-build-options
    no-autogen: true
    make-install-args:
      - libdir=${FLATPAK_DEST}/lib
      - libexecdir=${FLATPAK_DEST}/lib
      - includedir=${FLATPAK_DEST}/include
      - mandir=${FLATPAK_DEST}/share/man
    sources:
      - type: archive
        url: http://ftp.altlinux.org/pub/people/ldv/utempter/libutempter-1.2.1.tar.gz
        sha256: 967fef372f391de501843ad87570c6cf5dabd9651f00f1783090fbc12b2a34cb
        x-checker-data:
          type: anitya
          project-id: 1751
          stable-only: true
          url-template: http://ftp.altlinux.org/pub/people/ldv/utempter/libutempter-$version.tar.gz
      - type: shell
        commands:
          - sed -e '/^TARGETS/ s/$(SHAREDLIB)//' -e '/$(INSTALL).*$(SHAREDLIB)/d'
            -e '/ln -s.*$(SHAREDLIB)/d' -e '/$(LINK.c)/ s/COMPILE_PIE/COMPILE_PIC/'
            -e '/$(LINK.c)/ s/LINK_PIE/LINK_PIC/' -i Makefile

  - name: libxcrypt-static
    build-options: *musl-static-build-options
    config-opts:
      - --disable-shared
      - --disable-failure-tokens
      - --enable-hashes=strong,glibc
      - --enable-obsolete-api=no
    sources:
      - type: archive
        url: https://github.com/besser82/libxcrypt/archive/v4.4.28.tar.gz
        sha256: db7e37901969cb1d1e8020cb73a991ef81e48e31ea5b76a101862c806426b457
        x-checker-data:
          type: anitya
          project-id: 16436
          stable-only: true
          url-template: https://github.com/besser82/libxcrypt/archive/v$version.tar.gz
    cleanup:
      - '*'

  - name: byobu
    sources:
      - type: archive
        url: https://launchpad.net/byobu/trunk/5.133/+download/byobu_5.133.orig.tar.gz
        sha256: 4d8ea48f8c059e56f7174df89b04a08c32286bae5a21562c5c6f61be6dab7563
        x-checker-data:
          type: anitya
          project-id: 236
          stable-only: true
          url-template: https://launchpad.net/byobu/trunk/$version/+download/byobu_$version.orig.tar.gz
      - type: shell
        commands:
          - sed -i 's#^\(SOCKETDIR\)=.*#\1=/tmp/screens#' etc/byobu/socketdir
    cleanup:
      - /share/byobu/desktop
      - /share/byobu/pixmaps
      - /share/dbus-1
    modules:
      - name: libnewt-static
        build-options: *musl-static-build-options
        config-opts:
          - --without-tcl
          - --without-python
        sources:
          - type: archive
            url: https://releases.pagure.org/newt/newt-0.52.21.tar.gz
            sha256: 265eb46b55d7eaeb887fca7a1d51fe115658882dfe148164b6c49fccac5abb31
            x-checker-data:
              type: anitya
              project-id: 15129
              stable-only: true
              url-template: https://releases.pagure.org/newt/newt-$version.tar.gz
          - type: shell
            commands:
              - |
                sed -i \
                -e '/^whiptail:/ s/LIBNEWTSH/LIBNEWT/' \
                -e '/^all:/ s/_snack.$(SOEXT)//' \
                -e '/^install:/ s/install-sh//' \
                -e '/make -C po/d' \
                Makefile.in
        cleanup:
          - /share/locale
        modules:
          - name: gpm-static
            build-options: *musl-static-build-options
            config-opts:
              - --enable-static
              - --sbindir=${prefix}/bin
              - --sysconfdir=${prefix}/etc
            post-install:
              - rm ${FLATPAK_DEST}/lib/libgpm.so*
            sources:
              - type: archive
                url: https://github.com/telmich/gpm/archive/e82d1a653ca94aa4ed12441424da6ce780b1e530/gpm-e82d1a653ca94aa4ed12441424da6ce780b1e530.tar.gz
                sha256: 570e6fcf0d9312f76aad7edfa8fc8bf90ae714ebe5ee444faece7ed7bf270939
                x-checker-data:
                  type: json
                  url: https://api.github.com/repos/telmich/gpm/commits?sha=master&per_page=1
                  version-query: .[].sha
                  timestamp-query: .[].commit.committer.date
                  url-query: '"https://github.com/telmich/gpm/archive/" + $version
                    + "/gpm-" + $version + ".tar.gz"'
              - type: shell
                commands:
                  - sed -e '\|prog/gpm-root| s/libgpm.so.@abi_lev@/libgpm.a/' -e '\|$(PROG)|
                    s/libgpm.so.@abi_lev@/libgpm.a/' -e '\|$(LIBS) lib/libgpm.so.@abi_lev@|
                    s/libgpm.so.@abi_lev@/libgpm.a/' -e '\|^all:| s/libgpm.so//' -e
                    '\|$(CC) @LDFLAGS@| s/\($(CC)\)/\1 @CFLAGS@ $(CFLAGS)/' -i src/Makefile.in
          - name: slang-static
            build-options: *musl-static-build-options
            no-parallel-make: true
            no-make-install: true
            make-args:
              - static
            build-commands:
              - make install-static
            sources:
              - type: archive
                url: https://www.jedsoft.org/releases/slang/slang-2.3.3.tar.bz2
                sha256: f9145054ae131973c61208ea82486d5dd10e3c5cdad23b7c4a0617743c8f5a18
                x-checker-data:
                  type: anitya
                  project-id: 4829
                  stable-only: true
                  url-template: https://www.jedsoft.org/releases/slang/slang-$version.tar.bz2
            cleanup:
              - '*'

  - name: mosh-static
    # TODO: test if client is working without perl module
    build-options: *musl-static-build-options
    config-opts:
      - --enable-static
      - --enable-completion
      - --with-ncurses
    sources:
      - type: archive
        url: https://github.com/mobile-shell/mosh/releases/download/mosh-1.3.2/mosh-1.3.2.tar.gz
        sha256: da600573dfa827d88ce114e0fed30210689381bbdcff543c931e4d6a2e851216
        x-checker-data:
          type: anitya
          project-id: 7269
          stable-only: true
          url-template: https://github.com/mobile-shell/mosh/releases/download/mosh-$version/mosh-$version.tar.gz
    modules:
#     - name: perl-io-tty-shared
#       # only needed for mosh-client
#       # can't be built with musl without building perl
#       build-options: *musl-shared-build-options
#       buildsystem: simple
#       build-commands:
#         - perl Makefile.PL INSTALL_BASE=${FLATPAK_DEST}
#         - make install
#       post-install:
#         # workaround for cpanm acting silly and install files without write permission
#         - find /app -type f ! -perm -0200 -exec chmod u+w '{}' \;
#       sources:
#         - type: archive
#           url: https://search.cpan.org/CPAN/authors/id/T/TO/TODDR/IO-Tty-1.16.tar.gz
#           sha256: 8f1a09c070738adc695df903f2e7f74308dd8d991b914c0bc390a0e6021294dd
#           x-checker-data:
#             type: anitya
#             project-id: 7281
#             stable-only: true
#             url-template: https://search.cpan.org/CPAN/authors/id/T/TO/TODDR/IO-Tty-$version.tar.gz
#       cleanup:
#         - .packlist
#         - '*.pod'
      - name: protobuf-static
        build-options: *musl-static-build-options
        config-opts:
          - --enable-static
        make-args:
          # debug output for libtool
          - AM_LIBTOOLFLAGS=--verbose
          - V=1
        sources:
          - type: archive
            url: https://github.com/protocolbuffers/protobuf/releases/download/v21.5/protobuf-all-21.5.tar.gz
            sha256: 7ba0cb2ecfd9e5d44a6fa9ce05f254b7e5cd70ec89fafba0b07448f3e258310c
            x-checker-data:
              type: anitya
              project-id: 3715
              stable-only: true
              url-template: https://github.com/protocolbuffers/protobuf/releases/download/v$version/protobuf-all-$version.tar.gz
          - type: shell
            commands:
              # libtool workaround to generate statically linked protoc
              - sed -e 's/$(CXXLD)/$(CXXLD) -all-static/' -i src/Makefile.in
        cleanup:
          - '*'

  - name: screen-static
    # TODO: buildsystem tries to install into /usr
    build-options: *musl-static-build-options
    config-opts:
      # TODO: set pty group?
      - --enable-static
      - --enable-use-locale
      - --enable-telnet
      - --enable-colors256
      - --enable-rxvt_osc
    sources:
      - type: archive
        url: https://ftp.gnu.org/gnu/screen/screen-4.9.0.tar.gz
        sha256: f9335281bb4d1538ed078df78a20c2f39d3af9a4e91c57d084271e0289c730f4
        x-checker-data:
          type: anitya
          project-id: 4772
          stable-only: true
          url-template: https://ftp.gnu.org/gnu/screen/screen-$version.tar.gz

  - name: tmate-static
    build-options: *musl-static-build-options
    config-opts:
      - --enable-static
    make-args:
      - V=1
      # workaround for tmate not using pkgconfig
      - LIBNCURSES_CFLAGS=-I/usr/lib/sdk/devenv/include/ncursesw
      - LIBNCURSES_LIBS=-lncursesw
    sources:
      - type: archive
        url: https://github.com/tmate-io/tmate/archive/2.4.0/tmate-2.4.0.tar.gz
        sha256: 62b61eb12ab394012c861f6b48ba0bc04ac8765abca13bdde5a4d9105cb16138
        x-checker-data:
          type: anitya
          project-id: 10245
          stable-only: true
          url-template: https://github.com/tmate-io/tmate/archive/$version/tmate-$version.tar.gz
      - type: shell
        commands:
          # workaround for tmate not using pkgconfig
          - sed -i '/^#if defined(HAVE_CURSES_H)/i \#define HAVE_NCURSES_H' tty-term.c

  - name: tmux-static
    build-options: *musl-static-build-options
    config-opts:
      - --enable-static
      - --enable-utempter
    sources:
      - type: archive
        url: https://github.com/tmux/tmux/releases/download/3.3a/tmux-3.3a.tar.gz
        sha256: e4fd347843bd0772c4f48d6dde625b0b109b7a380ff15db21e97c11a4dcdf93f
        x-checker-data:
          type: anitya
          project-id: 4980
          stable-only: true
          url-template: https://github.com/tmux/tmux/releases/download/$version/tmux-$version.tar.gz


  ############################
  ####  Shells: Tools    ####
  ############################

  - name: moar-static
   #build-options:
   #  build-args:
   #    - --share=network
    buildsystem: simple
   #build-commands: *golang-online-build-commands
    build-commands: *golang-offline-build-commands
    post-install:
      - mv ${FLATPAK_DEST}/bin/moar{-static,}
      - install -Dm644 moar.1 -t ${FLATPAK_DEST}/share/man/man1/
    sources:
      - type: archive
        url: https://github.com/walles/moar/archive/v1.9.7/moar-1.9.7.tar.gz
        sha256: c296a7c5a2a9c84bd5de7a08134af98e1c8065de6ee82e7da5206aa11285bb96
        x-checker-data:
          type: anitya
          project-id: 283347
          stable-only: true
          url-template: https://github.com/walles/moar/archive/v$version/moar-$version.tar.gz
      - moar-go-sources.json # OFFLINE-BUILD, flatpak-go-get-generator.py -o moar-go-sources.json ./

  - name: reptyr-static
    build-options: *musl-static-build-options
    no-autogen: true
    make-install-args:
      - PREFIX=${FLATPAK_DEST}
    sources:
      - type: archive
        url: https://github.com/nelhage/reptyr/archive/reptyr-0.9.0/reptyr-0.9.0.tar.gz
        sha256: b442fbb80a1003b1985974c6fc9eeb8124a43a9bf014ae6af8cde0ca5e587731
        x-checker-data:
          type: anitya
          project-id: 4192
          stable-only: true
          url-template: https://github.com/nelhage/reptyr/archive/reptyr-$version/reptyr-$version.tar.gz
      - type: shell
        commands:
          - sed -i '/install .*reptyr\..*\.1/d;/(MANDIR)\/.*\/man/d' Makefile

  - name: rush-static-bin
    buildsystem: simple
    build-commands:
      - install -Dm755 rush -t ${FLATPAK_DEST}/bin/
    sources:
      - type: archive
        strip-components: 0
        url: https://github.com/shenwei356/rush/releases/download/v0.5.0/rush_linux_amd64.tar.gz
        sha256: 1bf305c320791c42282146ad8697d8e370d3d02b9c4c22b9d74982e0bbd8ecfa
        x-checker-data:
          type: anitya
          project-id: 280055
          stable-only: true
          url-template: https://github.com/shenwei356/rush/releases/download/v$version/rush_linux_amd64.tar.gz


  ############################
  #### Terminal emulators ####
  ############################

  # TODO: patch minicom to use flock, and add it here
  - name: terminfo-db
    config-opts:
      - --bindir=/var/bin
      - --includedir=/var/include
      - --libdir=/var/lib
      - --enable-db-install
      - --without-ada
      - --without-curses-h
      - --without-cxx
      - --without-cxx-binding
      - --without-debug
      - --without-manpages
      - --without-normal
      - --without-progs
      - --without-tests
    make-install-args:
      - tabsetdir=/var/share/tabset
    sources:
      - type: archive
        url: https://ftp.gnu.org/pub/gnu/ncurses/ncurses-6.3.tar.gz
        sha256: 97fc51ac2b085d4cde31ef4d2c3122c21abc217e9090a43a30fc5ec21684e059
        x-checker-data:
          type: anitya
          project-id: 234776
          stable-only: true
          url-template: https://ftp.gnu.org/pub/gnu/ncurses/ncurses-$version.tar.gz

  - name: foot-static
    # TODO: add notify-send
    build-options: *musl-static-build-options
    buildsystem: meson
    config-opts:
      - --default-library=static
      - -Ddocs=enabled
      - -Dthemes=true
      - -Dime=true
      - -Dgrapheme-clustering=enabled
      - -Dtests=false
      - -Dterminfo=enabled
    post-install:
      - install -Dm755 ../foot-x11 -t ${FLATPAK_DEST}/bin/
      - ln -s foot-x11 ${FLATPAK_DEST}/bin/xfoot
    sources:
      - type: archive
        url: https://codeberg.org/dnkl/foot/archive/1.13.1.tar.gz
        sha256: 604f777fdaccfc1ee2d20376cc5688a819dcd6b7113725880cc973194fd6c737
        x-checker-data:
          type: anitya
          project-id: 141611
          stable-only: true
          url-template: https://codeberg.org/dnkl/foot/archive/$version.tar.gz
      - type: script
        dest-filename: foot-x11
        commands:
          - |
            unset WAYLAND_DISPLAY
            export LIBGL_ALWAYS_SOFTWARE=1 __GLX_VENDOR_LIBRARY_NAME=mesa
            export WLR_RENDERER=pixman
            export XCURSOR_THEME=${XCURSOR_THEME:-Adwaita}
            exec cage -- foot "$@"
    modules:
      - name: ncurses-progs-static # foot terminfo generation doesn't work with runtime's tic
        # TODO: try patching foot buildsystem instead of this
        build-options: *musl-static-build-options
        no-make-install: true
        config-opts:
          - --without-dlsym
          - --with-progs
          - --enable-widec
          - --disable-db-install
          - --disable-pc-files
          - --without-normal
          - --without-cxx
          - --without-cxx-binding
          - --without-ada
          - --without-debug
          - --without-manpages
          - --without-tests
        build-commands:
          - install -Dm755 progs/{infocmp,tic} -t ${FLATPAK_DEST}/bin/
        sources:
          - type: archive
            url: https://ftp.gnu.org/pub/gnu/ncurses/ncurses-6.3.tar.gz
            sha256: 97fc51ac2b085d4cde31ef4d2c3122c21abc217e9090a43a30fc5ec21684e059
            x-checker-data:
              type: anitya
              project-id: 234776
              stable-only: true
              url-template: https://ftp.gnu.org/pub/gnu/ncurses/ncurses-$version.tar.gz
        cleanup:
          - '*'
      - name: fcft-static
        build-options: *musl-static-build-options
        buildsystem: meson
        config-opts:
          - --default-library=static
        sources:
          - type: archive
            url: https://codeberg.org/dnkl/fcft/archive/3.1.2.tar.gz
            sha256: f571afe693d3fa11fe36e97c7a2ecbbf9313755ee31c1ec3dcc648796b8e6db0
            x-checker-data:
              type: anitya
              project-id: 143240
              stable-only: true
              url-template: https://codeberg.org/dnkl/fcft/archive/$version.tar.gz
        cleanup:
          - '*'
        modules:
          - name: tllist
            buildsystem: meson
            sources:
              - type: archive
                url: https://codeberg.org/dnkl/tllist/archive/1.1.0.tar.gz
                sha256: 0e7b7094a02550dd80b7243bcffc3671550b0f1d8ba625e4dff52517827d5d23
                x-checker-data:
                  type: anitya
                  project-id: 141661
                  stable-only: true
                  url-template: https://codeberg.org/dnkl/tllist/archive/$version.tar.gz
            cleanup:
              - '*'
      - name: libutf8proc-static
        build-options: *musl-static-build-options
        buildsystem: cmake
        builddir: true
        sources:
          - type: archive
            url: https://github.com/JuliaStrings/utf8proc/archive/v2.7.0/utf8proc-2.7.0.tar.gz
            sha256: 4bb121e297293c0fd55f08f83afab6d35d48f0af4ecc07523ad8ec99aa2b12a1
            x-checker-data:
              type: anitya
              project-id: 7455
              stable-only: true
              url-template: https://github.com/JuliaStrings/utf8proc/archive/v$version/utf8proc-$version.tar.gz
        cleanup:
          - '*'

  - name: picocom-static
    build-options: *musl-static-build-options
    no-autogen: true
    no-make-install: true
    build-commands:
      - install -Dm755 picocom pc{asc,xm,ym,zm} -t ${FLATPAK_DEST}/bin/
      - install -Dm644 picocom.1 -t ${FLATPAK_DEST}/share/man/man1/
      - install -Dm644 -t ${FLATPAK_DEST}/share/doc/picocom/ lowerrts.md picocom.1.{md,pdf}
        README.md termios2.txt
      - install -Dm644 bash_completion/picocom -t ${FLATPAK_DEST}/share/bash-completion/
    sources:
      - type: archive
        url: https://github.com/npat-efault/picocom/archive/1acf1ddabaf3576b4023c4f6f09c5a3e4b086fb8/picocom-1acf1ddabaf3576b4023c4f6f09c5a3e4b086fb8.tar.gz
        sha256: 4ce6bd7ff0307166e7e06d570df854ff6eab3718728cc3c4612716c9aa01477a
        x-checker-data:
          type: anitya
          project-id: 3634
          stable-only: true
          versions:
            '>': '3.1'
          url-template: https://github.com/npat-efault/picocom/archive/$version/picocom-$version.tar.gz


  ############################
  ####        FSW         ####
  ############################

  - name: flatpak-spawn-wrappers
    buildsystem: simple
    build-commands:
      - install -dm755 ${FLATPAK_DEST}/bin/fsw
      - |
        cmds=(buildah flatpak lxc podman skopeo
              rm{,dir}trash trash{,-{empty,list,put,restore,rm}}
              pacman sudo
              amixer aplay ncpamixer njconnect playerctl
              btop htop)
        for cmd in ${cmds[@]}; do
          ln -s ../host-spawn ${FLATPAK_DEST}/bin/fsw/${cmd}
        done
      - install -Dm755 fusermount3 -t ${FLATPAK_DEST}/bin/fsw/
      - ln -s fusermount3 ${FLATPAK_DEST}/bin/fsw/fusermount
    sources:
      - type: script
        dest-filename: fusermount3
        commands:
          - |
            # source: https://github.com/flathub/org.flatpak.Builder/blob/master/fusermount-wrapper.sh
            # workaround for gocryptfs unsetting environment variables
            export DBUS_SESSION_BUS_ADDRESS="unix:path=/run/flatpak/bus"
            if [ -z "$_FUSE_COMMFD" ]; then
                FD_ARGS=
            else
                FD_ARGS="--env=_FUSE_COMMFD=${_FUSE_COMMFD}"
                [ "$_FUSE_COMMFD" -gt 2 ] && FD_ARGS+=" --forward-fd=${_FUSE_COMMFD}"
            fi
            exec flatpak-spawn --host $FD_ARGS fusermount3 "$@"


  ############################
  ####       Polish       ####
  ############################

  - name: packaging
    buildsystem: simple
    build-commands:
      - install -Dm755 enable.sh -t ${FLATPAK_DEST}/
      - |
        install -Dm755 -t ${FLATPAK_DEST}/bin/ \
        enable-development-environment ssh
      - ln -s nvim ${FLATPAK_DEST}/bin/vim
      - install -Dm644 bash.bashrc python.startup -t ${FLATPAK_DEST}/etc/
    sources:
      - type: script
        dest-filename: enable.sh
        commands:
          - |
            if [ -z "$FLATPAK_DEVELOPMENT_ENVIRONMENT" ]; then
              export FLATPAK_DEVELOPMENT_ENVIRONMENT=1
              SDKPATH=/usr/lib/sdk/devenv
              export PATH=${SDKPATH}/bin:$PATH
              if [ -f "/.flatpak-info" ]; then
                export PATH=${SDKPATH}/bin/fsw:$PATH
              fi
              export XDG_DATA_DIRS=$XDG_DATA_DIRS:${SDKPATH}/share
              #if [ -z "$LD_LIBRARY_PATH" ]; then
              #  export LD_LIBRARY_PATH=${SDKPATH}/lib
              #else
              #  export LD_LIBRARY_PATH+=:${SDKPATH}/lib
              #fi
              #if [ -z "$PYTHONPATH" ]; then
              #  export PYTHONPATH=${SDKPATH}/lib/python/site-packages
              #else
              #  export PYTHONPATH+=:${SDKPATH}/lib/python/site-packages
              #fi
              if [[ ":$TERMINFO_DIRS:" != *":${SDKPATH}/share/terminfo:"* ]]; then
                if [[ "$TERMINFO_DIRS" != *":" ]] && [ -n "$TERMINFO_DIRS" ]; then
                  export TERMINFO_DIRS+=":${SDKPATH}/share/terminfo:"
                else
                  export TERMINFO_DIRS+="${SDKPATH}/share/terminfo:"
                fi
              fi
              # symlinks adjustments for xdg user dirs locations
              if [ -n "$FLATPAK_ID" ] &&
                [ -e "/.flatpak-info" ]; then
                  # single level xdg-dir
                  # target: .user/dots
                  # source: xdg-config/symlink
                  # test from sandbox: $ readlink -m $XDG_CONFIG_HOME/symlink
                  if [ -d "$HOME/.var/app/${FLATPAK_ID}" ] &&
                    [ ! -e "$HOME/.var/app/${FLATPAK_ID}/.user" ]; then
                    ln -s ../../../.user "$HOME/.var/app/${FLATPAK_ID}/.user"
                  fi
                  # two levels xdg-dir (just xdg-data)
                  # target: .user/bin/flatpak-run-cli
                  # symlink: xdg-data/flatpak-run-cli/exports/bin/symlink
                  # test from sandbox: $ readlink -m $XDG_DATA_HOME/flatpak-run-cli/exports/bin/symlink
                  if [ -d "$HOME/.var/app" ] &&
                    [ ! -e "$HOME/.var/app/.user" ]; then
                    ln -s ../../.user "$HOME/.var/app/.user"
                  fi
              fi
            fi
            # workaround for badly implemented /etc/shells creation in vscode app
            if [ ! -f '/etc/shells' ]; then
              touch '/etc/shells'
            fi
      - type: script
        dest-filename: enable-development-environment
        commands:
          - |
            if [ -z "$FLATPAK_DEVELOPMENT_ENVIRONMENT" ]; then
              source /usr/lib/sdk/devenv/enable.sh
              # workaround for not running as login shell
              SHELL=$(which bash) exec bash -i
            fi
      - type: script
        dest-filename: ssh
        commands:
          - |
            # using /home as this needs to work even if HOME is being overridden, for example for caching and state in
            # project folder
            /usr/bin/ssh \
            -F /home/${USER}/.config/ssh/config \
            -o "UserKnownHostsFile /home/${USER}/.config/ssh/known_hosts" \
            "$@"
      - type: file
        path: bash.bashrc
      - type: file
        path: inputrc
      - type: file
        path: python.startup
